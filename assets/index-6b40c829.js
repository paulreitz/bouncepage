var Hh=Object.defineProperty;var Xh=(e,t,i)=>t in e?Hh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var ut=(e,t,i)=>(Xh(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();var Ge=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(Ge||{}),Bs=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(Bs||{}),X=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(X||{}),ae=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(ae||{}),P=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(P||{}),ei=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(ei||{}),H=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(H||{}),Fs=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(Fs||{}),fe=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(fe||{}),be=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(be||{}),le=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))(le||{}),Qt=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(Qt||{}),re=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(re||{}),_n=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(_n||{}),kt=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(kt||{}),yt=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(yt||{}),gt=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(gt||{}),oe=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(oe||{});const jh={createCanvas:(e,t)=>{const i=document.createElement("canvas");return i.width=e,i.height=t,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},N={ADAPTER:jh,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var rs=/iPhone/i,On=/iPod/i,Ln=/iPad/i,Un=/\biOS-universal(?:.+)Mac\b/i,ss=/\bAndroid(?:.+)Mobile\b/i,kn=/Android/i,Xe=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,$i=/Silk/i,ue=/Windows Phone/i,Gn=/\bWindows(?:.+)ARM\b/i,Hn=/BlackBerry/i,Xn=/BB10/i,jn=/Opera Mini/i,zn=/\b(CriOS|Chrome)(?:.+)Mobile/i,Vn=/Mobile(?:.+)Firefox\b/i,$n=function(e){return typeof e<"u"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream>"u"};function zh(e){return function(t){return t.test(e)}}function Vh(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var i=t.userAgent,r=i.split("[FBAN");typeof r[1]<"u"&&(i=r[0]),r=i.split("Twitter"),typeof r[1]<"u"&&(i=r[0]);var s=zh(i),n={apple:{phone:s(rs)&&!s(ue),ipod:s(On),tablet:!s(rs)&&(s(Ln)||$n(t))&&!s(ue),universal:s(Un),device:(s(rs)||s(On)||s(Ln)||s(Un)||$n(t))&&!s(ue)},amazon:{phone:s(Xe),tablet:!s(Xe)&&s($i),device:s(Xe)||s($i)},android:{phone:!s(ue)&&s(Xe)||!s(ue)&&s(ss),tablet:!s(ue)&&!s(Xe)&&!s(ss)&&(s($i)||s(kn)),device:!s(ue)&&(s(Xe)||s($i)||s(ss)||s(kn))||s(/\bokhttp\b/i)},windows:{phone:s(ue),tablet:s(Gn),device:s(ue)||s(Gn)},other:{blackberry:s(Hn),blackberry10:s(Xn),opera:s(jn),firefox:s(Vn),chrome:s(zn),device:s(Hn)||s(Xn)||s(jn)||s(Vn)||s(zn)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const pe=Vh(globalThis.navigator);N.RETINA_PREFIX=/@([0-9\.]+)x/;N.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var _t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $h(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function r(){if(this instanceof r){var s=[null];s.push.apply(s,arguments);var n=Function.bind.apply(t,s);return new n}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),i}var Oe={},Wh={get exports(){return Oe},set exports(e){Oe=e}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function s(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,u||h,d),p=i?i+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(i?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=i?i+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},o.prototype.listenerCount=function(l){var c=i?i+l:l,u=this._events[c];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,c,u,d,f,p){var m=i?i+l:l;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,_,v;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,d),!0;case 5:return g.fn.call(g.context,c,u,d,f),!0;case 6:return g.fn.call(g.context,c,u,d,f,p),!0}for(v=1,_=new Array(y-1);v<y;v++)_[v-1]=arguments[v];g.fn.apply(g.context,_)}else{var x=g.length,T;for(v=0;v<x;v++)switch(g[v].once&&this.removeListener(l,g[v].fn,void 0,!0),y){case 1:g[v].fn.call(g[v].context);break;case 2:g[v].fn.call(g[v].context,c);break;case 3:g[v].fn.call(g[v].context,c,u);break;case 4:g[v].fn.call(g[v].context,c,u,d);break;default:if(!_)for(T=1,_=new Array(y-1);T<y;T++)_[T-1]=arguments[T];g[v].fn.apply(g[v].context,_)}}return!0},o.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},o.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},o.prototype.removeListener=function(l,c,u,d){var f=i?i+l:l;if(!this._events[f])return this;if(!c)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&a(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==c||d&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=i?i+l:l,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o})(Wh);var Ar={},Yh={get exports(){return Ar},set exports(e){Ar=e}};Yh.exports=zr;Ar.default=zr;function zr(e,t,i){i=i||2;var r=t&&t.length,s=r?t[0]*i:e.length,n=Ja(e,0,s,i,!0),a=[];if(!n||n.next===n.prev)return a;var o,h,l,c,u,d,f;if(r&&(n=Qh(e,t,n,i)),e.length>80*i){o=l=e[0],h=c=e[1];for(var p=i;p<s;p+=i)u=e[p],d=e[p+1],u<o&&(o=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);f=Math.max(l-o,c-h),f=f!==0?32767/f:0}return Pi(n,a,i,o,h,f,0),a}function Ja(e,t,i,r,s){var n,a;if(s===Ls(e,t,i,r)>0)for(n=t;n<i;n+=r)a=Wn(n,e[n],e[n+1],a);else for(n=i-r;n>=t;n-=r)a=Wn(n,e[n],e[n+1],a);return a&&Vr(a,a.next)&&(Di(a),a=a.next),a}function Le(e,t){if(!e)return e;t||(t=e);var i=e,r;do if(r=!1,!i.steiner&&(Vr(i,i.next)||lt(i.prev,i,i.next)===0)){if(Di(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Pi(e,t,i,r,s,n,a){if(e){!a&&n&&sl(e,r,s,n);for(var o=e,h,l;e.prev!==e.next;){if(h=e.prev,l=e.next,n?Kh(e,r,s,n):qh(e)){t.push(h.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Di(e),e=l.next,o=l.next;continue}if(e=l,e===o){a?a===1?(e=Zh(Le(e),t,i),Pi(e,t,i,r,s,n,2)):a===2&&Jh(e,t,i,r,s,n):Pi(Le(e),t,i,r,s,n,1);break}}}}function qh(e){var t=e.prev,i=e,r=e.next;if(lt(t,i,r)>=0)return!1;for(var s=t.x,n=i.x,a=r.x,o=t.y,h=i.y,l=r.y,c=s<n?s<a?s:a:n<a?n:a,u=o<h?o<l?o:l:h<l?h:l,d=s>n?s>a?s:a:n>a?n:a,f=o>h?o>l?o:l:h>l?h:l,p=r.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Ze(s,o,n,h,a,l,p.x,p.y)&&lt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Kh(e,t,i,r){var s=e.prev,n=e,a=e.next;if(lt(s,n,a)>=0)return!1;for(var o=s.x,h=n.x,l=a.x,c=s.y,u=n.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,m=o>h?o>l?o:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,y=Ns(f,p,t,i,r),_=Ns(m,g,t,i,r),v=e.prevZ,x=e.nextZ;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==a&&Ze(o,c,h,u,l,d,v.x,v.y)&&lt(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==a&&Ze(o,c,h,u,l,d,x.x,x.y)&&lt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=g&&v!==s&&v!==a&&Ze(o,c,h,u,l,d,v.x,v.y)&&lt(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==a&&Ze(o,c,h,u,l,d,x.x,x.y)&&lt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Zh(e,t,i){var r=e;do{var s=r.prev,n=r.next.next;!Vr(s,n)&&Qa(s,r,r.next,n)&&Mi(s,n)&&Mi(n,s)&&(t.push(s.i/i|0),t.push(r.i/i|0),t.push(n.i/i|0),Di(r),Di(r.next),r=e=n),r=r.next}while(r!==e);return Le(r)}function Jh(e,t,i,r,s,n){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&ol(a,o)){var h=to(a,o);a=Le(a,a.next),h=Le(h,h.next),Pi(a,t,i,r,s,n,0),Pi(h,t,i,r,s,n,0);return}o=o.next}a=a.next}while(a!==e)}function Qh(e,t,i,r){var s=[],n,a,o,h,l;for(n=0,a=t.length;n<a;n++)o=t[n]*r,h=n<a-1?t[n+1]*r:e.length,l=Ja(e,o,h,r,!1),l===l.next&&(l.steiner=!0),s.push(al(l));for(s.sort(tl),n=0;n<s.length;n++)i=el(s[n],i);return i}function tl(e,t){return e.x-t.x}function el(e,t){var i=il(e,t);if(!i)return t;var r=to(i,e);return Le(r,r.next),Le(i,i.next)}function il(e,t){var i=t,r=e.x,s=e.y,n=-1/0,a;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>n&&(n=o,a=i.x<i.next.x?i:i.next,o===r))return a}i=i.next}while(i!==t);if(!a)return null;var h=a,l=a.x,c=a.y,u=1/0,d;i=a;do r>=i.x&&i.x>=l&&r!==i.x&&Ze(s<c?r:n,s,l,c,s<c?n:r,s,i.x,i.y)&&(d=Math.abs(s-i.y)/(r-i.x),Mi(i,e)&&(d<u||d===u&&(i.x>a.x||i.x===a.x&&rl(a,i)))&&(a=i,u=d)),i=i.next;while(i!==h);return a}function rl(e,t){return lt(e.prev,e,t.prev)<0&&lt(t.next,e,e.next)<0}function sl(e,t,i,r){var s=e;do s.z===0&&(s.z=Ns(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,nl(s)}function nl(e){var t,i,r,s,n,a,o,h,l=1;do{for(i=e,e=null,n=null,a=0;i;){for(a++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ,!!r);t++);for(h=l;o>0||h>0&&r;)o!==0&&(h===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,h--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,l*=2}while(a>1);return e}function Ns(e,t,i,r,s){return e=(e-i)*s|0,t=(t-r)*s|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function al(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Ze(e,t,i,r,s,n,a,o){return(s-a)*(t-o)>=(e-a)*(n-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(n-o)>=(s-a)*(r-o)}function ol(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!hl(e,t)&&(Mi(e,t)&&Mi(t,e)&&ll(e,t)&&(lt(e.prev,e,t.prev)||lt(e,t.prev,t))||Vr(e,t)&&lt(e.prev,e,e.next)>0&&lt(t.prev,t,t.next)>0)}function lt(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Vr(e,t){return e.x===t.x&&e.y===t.y}function Qa(e,t,i,r){var s=Yi(lt(e,t,i)),n=Yi(lt(e,t,r)),a=Yi(lt(i,r,e)),o=Yi(lt(i,r,t));return!!(s!==n&&a!==o||s===0&&Wi(e,i,t)||n===0&&Wi(e,r,t)||a===0&&Wi(i,e,r)||o===0&&Wi(i,t,r))}function Wi(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Yi(e){return e>0?1:e<0?-1:0}function hl(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Qa(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Mi(e,t){return lt(e.prev,e,e.next)<0?lt(e,t,e.next)>=0&&lt(e,e.prev,t)>=0:lt(e,t,e.prev)<0||lt(e,e.next,t)<0}function ll(e,t){var i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function to(e,t){var i=new Os(e.i,e.x,e.y),r=new Os(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function Wn(e,t,i,r){var s=new Os(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Di(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Os(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}zr.deviation=function(e,t,i,r){var s=t&&t.length,n=s?t[0]*i:e.length,a=Math.abs(Ls(e,0,n,i));if(s)for(var o=0,h=t.length;o<h;o++){var l=t[o]*i,c=o<h-1?t[o+1]*i:e.length;a-=Math.abs(Ls(e,l,c,i))}var u=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,f=r[o+1]*i,p=r[o+2]*i;u+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function Ls(e,t,i,r){for(var s=0,n=t,a=i-r;n<i;n+=r)s+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return s}zr.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,s=0;s<e.length;s++){for(var n=0;n<e[s].length;n++)for(var a=0;a<t;a++)i.vertices.push(e[s][n][a]);s>0&&(r+=e[s-1].length,i.holes.push(r))}return i};var Cr={},cl={get exports(){return Cr},set exports(e){Cr=e}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(e,t){(function(i){var r=t&&!t.nodeType&&t,s=e&&!e.nodeType&&e,n=typeof _t=="object"&&_t;(n.global===n||n.window===n||n.self===n)&&(i=n);var a,o=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-l,T=Math.floor,C=String.fromCharCode,A;function w(I){throw RangeError(v[I])}function M(I,L){for(var W=I.length,J=[];W--;)J[W]=L(I[W]);return J}function F(I,L){var W=I.split("@"),J="";W.length>1&&(J=W[0]+"@",I=W[1]),I=I.replace(_,".");var V=I.split("."),rt=M(V,L).join(".");return J+rt}function b(I){for(var L=[],W=0,J=I.length,V,rt;W<J;)V=I.charCodeAt(W++),V>=55296&&V<=56319&&W<J?(rt=I.charCodeAt(W++),(rt&64512)==56320?L.push(((V&1023)<<10)+(rt&1023)+65536):(L.push(V),W--)):L.push(V);return L}function R(I){return M(I,function(L){var W="";return L>65535&&(L-=65536,W+=C(L>>>10&1023|55296),L=56320|L&1023),W+=C(L),W}).join("")}function S(I){return I-48<10?I-22:I-65<26?I-65:I-97<26?I-97:h}function E(I,L){return I+22+75*(I<26)-((L!=0)<<5)}function j(I,L,W){var J=0;for(I=W?T(I/d):I>>1,I+=T(I/L);I>x*c>>1;J+=h)I=T(I/x);return T(J+(x+1)*I/(I+u))}function $(I){var L=[],W=I.length,J,V=0,rt=p,pt=f,bt,It,Bt,Et,st,mt,vt,te,ee;for(bt=I.lastIndexOf(m),bt<0&&(bt=0),It=0;It<bt;++It)I.charCodeAt(It)>=128&&w("not-basic"),L.push(I.charCodeAt(It));for(Bt=bt>0?bt+1:0;Bt<W;){for(Et=V,st=1,mt=h;Bt>=W&&w("invalid-input"),vt=S(I.charCodeAt(Bt++)),(vt>=h||vt>T((o-V)/st))&&w("overflow"),V+=vt*st,te=mt<=pt?l:mt>=pt+c?c:mt-pt,!(vt<te);mt+=h)ee=h-te,st>T(o/ee)&&w("overflow"),st*=ee;J=L.length+1,pt=j(V-Et,J,Et==0),T(V/J)>o-rt&&w("overflow"),rt+=T(V/J),V%=J,L.splice(V++,0,rt)}return R(L)}function D(I){var L,W,J,V,rt,pt,bt,It,Bt,Et,st,mt=[],vt,te,ee,ui;for(I=b(I),vt=I.length,L=p,W=0,rt=f,pt=0;pt<vt;++pt)st=I[pt],st<128&&mt.push(C(st));for(J=V=mt.length,V&&mt.push(m);J<vt;){for(bt=o,pt=0;pt<vt;++pt)st=I[pt],st>=L&&st<bt&&(bt=st);for(te=J+1,bt-L>T((o-W)/te)&&w("overflow"),W+=(bt-L)*te,L=bt,pt=0;pt<vt;++pt)if(st=I[pt],st<L&&++W>o&&w("overflow"),st==L){for(It=W,Bt=h;Et=Bt<=rt?l:Bt>=rt+c?c:Bt-rt,!(It<Et);Bt+=h)ui=It-Et,ee=h-Et,mt.push(C(E(Et+ui%ee,0))),It=T(ui/ee);mt.push(C(E(It,0))),rt=j(W,te,J==V),W=0,++J}++W,++L}return mt.join("")}function Z(I){return F(I,function(L){return g.test(L)?$(L.slice(4).toLowerCase()):L})}function Q(I){return F(I,function(L){return y.test(L)?"xn--"+D(L):L})}if(a={version:"1.3.2",ucs2:{decode:b,encode:R},decode:$,encode:D,toASCII:Q,toUnicode:Z},r&&s)if(e.exports==r)s.exports=a;else for(A in a)a.hasOwnProperty(A)&&(r[A]=a[A]);else i.punycode=a})(_t)})(cl,Cr);var ul={isString:function(e){return typeof e=="string"},isObject:function(e){return typeof e=="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}},Bi={};function dl(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var fl=function(e,t,i,r){t=t||"&",i=i||"=";var s={};if(typeof e!="string"||e.length===0)return s;var n=/\+/g;e=e.split(t);var a=1e3;r&&typeof r.maxKeys=="number"&&(a=r.maxKeys);var o=e.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l=e[h].replace(n,"%20"),c=l.indexOf(i),u,d,f,p;c>=0?(u=l.substr(0,c),d=l.substr(c+1)):(u=l,d=""),f=decodeURIComponent(u),p=decodeURIComponent(d),dl(s,f)?Array.isArray(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s},di=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},pl=function(e,t,i,r){return t=t||"&",i=i||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(s){var n=encodeURIComponent(di(s))+i;return Array.isArray(e[s])?e[s].map(function(a){return n+encodeURIComponent(di(a))}).join(t):n+encodeURIComponent(di(e[s]))}).join(t):r?encodeURIComponent(di(r))+i+encodeURIComponent(di(e)):""};Bi.decode=Bi.parse=fl;Bi.encode=Bi.stringify=pl;var ml=Cr,se=ul,gl=$r,vl=Il,yl=Cl;function Kt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var _l=/^([a-z0-9.+-]+:)/i,xl=/:[0-9]*$/,bl=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,El=["<",">",'"',"`"," ","\r",`
`,"	"],Tl=["{","}","|","\\","^","`"].concat(El),Us=["'"].concat(Tl),Yn=["%","/","?",";","#"].concat(Us),qn=["/","?","#"],wl=255,Kn=/^[+a-z0-9A-Z_-]{0,63}$/,Sl=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Al={javascript:!0,"javascript:":!0},ks={javascript:!0,"javascript:":!0},ii={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Gs=Bi;function $r(e,t,i){if(e&&se.isObject(e)&&e instanceof Kt)return e;var r=new Kt;return r.parse(e,t,i),r}Kt.prototype.parse=function(e,t,i){if(!se.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),s=r!==-1&&r<e.indexOf("#")?"?":"#",n=e.split(s),a=/\\/g;n[0]=n[0].replace(a,"/"),e=n.join(s);var o=e;if(o=o.trim(),!i&&e.split("#").length===1){var h=bl.exec(o);if(h)return this.path=o,this.href=o,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Gs.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=_l.exec(o);if(l){l=l[0];var c=l.toLowerCase();this.protocol=c,o=o.substr(l.length)}if(i||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var u=o.substr(0,2)==="//";u&&!(l&&ks[l])&&(o=o.substr(2),this.slashes=!0)}if(!ks[l]&&(u||l&&!ii[l])){for(var d=-1,f=0;f<qn.length;f++){var p=o.indexOf(qn[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=o.lastIndexOf("@"):g=o.lastIndexOf("@",d),g!==-1&&(m=o.slice(0,g),o=o.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<Yn.length;f++){var p=o.indexOf(Yn[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=o.length),this.host=o.slice(0,d),o=o.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var _=this.hostname.split(/\./),f=0,v=_.length;f<v;f++){var x=_[f];if(x&&!x.match(Kn)){for(var T="",C=0,A=x.length;C<A;C++)x.charCodeAt(C)>127?T+="x":T+=x[C];if(!T.match(Kn)){var w=_.slice(0,f),M=_.slice(f+1),F=x.match(Sl);F&&(w.push(F[1]),M.unshift(F[2])),M.length&&(o="/"+M.join(".")+o),this.hostname=w.join(".");break}}}this.hostname.length>wl?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=ml.toASCII(this.hostname));var b=this.port?":"+this.port:"",R=this.hostname||"";this.host=R+b,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!Al[c])for(var f=0,v=Us.length;f<v;f++){var S=Us[f];if(o.indexOf(S)!==-1){var E=encodeURIComponent(S);E===S&&(E=escape(S)),o=o.split(S).join(E)}}var j=o.indexOf("#");j!==-1&&(this.hash=o.substr(j),o=o.slice(0,j));var $=o.indexOf("?");if($!==-1?(this.search=o.substr($),this.query=o.substr($+1),t&&(this.query=Gs.parse(this.query)),o=o.slice(0,$)):t&&(this.search="",this.query={}),o&&(this.pathname=o),ii[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var b=this.pathname||"",D=this.search||"";this.path=b+D}return this.href=this.format(),this};function Cl(e){return se.isString(e)&&(e=$r(e)),e instanceof Kt?e.format():Kt.prototype.format.call(e)}Kt.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=e+this.host:this.hostname&&(s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&se.isObject(this.query)&&Object.keys(this.query).length&&(n=Gs.stringify(this.query));var a=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||ii[t])&&s!==!1?(s="//"+(s||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),i=i.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),t+s+i+a+r};function Il(e,t){return $r(e,!1,!0).resolve(t)}Kt.prototype.resolve=function(e){return this.resolveObject($r(e,!1,!0)).format()};Kt.prototype.resolveObject=function(e){if(se.isString(e)){var t=new Kt;t.parse(e,!1,!0),e=t}for(var i=new Kt,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];i[n]=this[n]}if(i.hash=e.hash,e.href==="")return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),o=0;o<a.length;o++){var h=a[o];h!=="protocol"&&(i[h]=e[h])}return ii[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!ii[e.protocol]){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];i[u]=e[u]}return i.href=i.format(),i}if(i.protocol=e.protocol,!e.host&&!ks[e.protocol]){for(var v=(e.pathname||"").split("/");v.length&&!(e.host=v.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),v[0]!==""&&v.unshift(""),v.length<2&&v.unshift(""),i.pathname=v.join("/")}else i.pathname=e.pathname;if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var d=i.pathname||"",f=i.search||"";i.path=d+f}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var p=i.pathname&&i.pathname.charAt(0)==="/",m=e.host||e.pathname&&e.pathname.charAt(0)==="/",g=m||p||i.host&&e.pathname,y=g,_=i.pathname&&i.pathname.split("/")||[],v=e.pathname&&e.pathname.split("/")||[],x=i.protocol&&!ii[i.protocol];if(x&&(i.hostname="",i.port=null,i.host&&(_[0]===""?_[0]=i.host:_.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(v[0]===""?v[0]=e.host:v.unshift(e.host)),e.host=null),g=g&&(v[0]===""||_[0]==="")),m)i.host=e.host||e.host===""?e.host:i.host,i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname,i.search=e.search,i.query=e.query,_=v;else if(v.length)_||(_=[]),_.pop(),_=_.concat(v),i.search=e.search,i.query=e.query;else if(!se.isNullOrUndefined(e.search)){if(x){i.hostname=i.host=_.shift();var T=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;T&&(i.auth=T.shift(),i.host=i.hostname=T.shift())}return i.search=e.search,i.query=e.query,(!se.isNull(i.pathname)||!se.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!_.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var C=_.slice(-1)[0],A=(i.host||e.host||_.length>1)&&(C==="."||C==="..")||C==="",w=0,M=_.length;M>=0;M--)C=_[M],C==="."?_.splice(M,1):C===".."?(_.splice(M,1),w++):w&&(_.splice(M,1),w--);if(!g&&!y)for(;w--;w)_.unshift("..");g&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")&&_.unshift(""),A&&_.join("/").substr(-1)!=="/"&&_.push("");var F=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(x){i.hostname=i.host=F?"":_.length?_.shift():"";var T=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;T&&(i.auth=T.shift(),i.host=i.hostname=T.shift())}return g=g||i.host&&_.length,g&&!F&&_.unshift(""),_.length?i.pathname=_.join("/"):(i.pathname=null,i.path=null),(!se.isNull(i.pathname)||!se.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i};Kt.prototype.parseHost=function(){var e=this.host,t=xl.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};const Rl={parse:gl,format:yl,resolve:vl};function Ht(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function fi(e){return e.split("?")[0].split("#")[0]}function Pl(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ml(e,t,i){return e.replace(new RegExp(Pl(t),"g"),i)}function Dl(e,t){let i="",r=0,s=-1,n=0,a=-1;for(let o=0;o<=e.length;++o){if(o<e.length)a=e.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||n===1))if(s!==o-1&&n===2){if(i.length<2||r!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){const h=i.lastIndexOf("/");if(h!==i.length-1){h===-1?(i="",r=0):(i=i.slice(0,h),r=i.length-1-i.lastIndexOf("/")),s=o,n=0;continue}}else if(i.length===2||i.length===1){i="",r=0,s=o,n=0;continue}}t&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+=`/${e.slice(s+1,o)}`:i=e.slice(s+1,o),r=o-s-1;s=o,n=0}else a===46&&n!==-1?++n:n=-1}return i}const Ct={toPosix(e){return Ml(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){Ht(e),e=this.toPosix(e);let t="";const i=/^file:\/\/\//.exec(e),r=/^[^/:]+:\/\//.exec(e),s=/^[^/:]+:\//.exec(e);if(i||r||s){const n=(i==null?void 0:i[0])||(r==null?void 0:r[0])||(s==null?void 0:s[0]);t=n,e=e.slice(n.length)}return t},toAbsolute(e,t,i){if(this.isDataUrl(e))return e;const r=fi(this.toPosix(t??N.ADAPTER.getBaseUrl())),s=fi(this.toPosix(i??this.rootname(r)));return Ht(e),e=this.toPosix(e),e.startsWith("/")?Ct.join(s,e.slice(1)):this.isAbsolute(e)?e:this.join(r,e)},normalize(e){if(e=this.toPosix(e),Ht(e),e.length===0)return".";let t="";const i=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const r=e.endsWith("/");return e=Dl(e,!1),e.length>0&&r&&(e+="/"),i?`/${e}`:t+e},isAbsolute(e){return Ht(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let i=0;i<e.length;++i){const r=e[i];if(Ht(r),r.length>0)if(t===void 0)t=r;else{const s=e[i-1]??"";this.extname(s)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(Ht(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const i=t===47;let r=-1,s=!0;const n=this.getProtocol(e),a=e;e=e.slice(n.length);for(let o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!s){r=o;break}}else s=!1;return r===-1?i?"/":this.isUrl(a)?n+e:n:i&&r===1?"//":n+e.slice(0,r)},rootname(e){Ht(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const i=e.indexOf("/",t.length);i!==-1?t=e.slice(0,i):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){Ht(e),t&&Ht(t),e=fi(this.toPosix(e));let i=0,r=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let a=t.length-1,o=-1;for(n=e.length-1;n>=0;--n){const h=e.charCodeAt(n);if(h===47){if(!s){i=n+1;break}}else o===-1&&(s=!1,o=n+1),a>=0&&(h===t.charCodeAt(a)?--a===-1&&(r=n):(a=-1,r=o))}return i===r?r=o:r===-1&&(r=e.length),e.slice(i,r)}for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!s){i=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":e.slice(i,r)},extname(e){Ht(e),e=fi(this.toPosix(e));let t=-1,i=0,r=-1,s=!0,n=0;for(let a=e.length-1;a>=0;--a){const o=e.charCodeAt(a);if(o===47){if(!s){i=a+1;break}continue}r===-1&&(s=!1,r=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||r===-1||n===0||n===1&&t===r-1&&t===i+1?"":e.slice(t,r)},parse(e){Ht(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=fi(this.toPosix(e));let i=e.charCodeAt(0);const r=this.isAbsolute(e);let s;t.root=this.rootname(e),r||this.hasProtocol(e)?s=1:s=0;let n=-1,a=0,o=-1,h=!0,l=e.length-1,c=0;for(;l>=s;--l){if(i=e.charCodeAt(l),i===47){if(!h){a=l+1;break}continue}o===-1&&(h=!1,o=l+1),i===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||o===-1||c===0||c===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&r?t.base=t.name=e.slice(1,o):t.base=t.name=e.slice(a,o)):(a===0&&r?(t.name=e.slice(1,n),t.base=e.slice(1,o)):(t.name=e.slice(a,n),t.base=e.slice(a,o)),t.ext=e.slice(n,o)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Zn={};function K(e,t,i=3){if(Zn[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(r=r.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(r))),Zn[t]=!0}let ns;function Bl(){return typeof ns>"u"&&(ns=function(){var i;const t={stencil:!0,failIfMajorPerformanceCaveat:N.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!N.ADAPTER.getWebGLRenderingContext())return!1;const r=N.ADAPTER.createCanvas();let s=r.getContext("webgl",t)||r.getContext("experimental-webgl",t);const n=!!((i=s==null?void 0:s.getContextAttributes())!=null&&i.stencil);if(s){const a=s.getExtension("WEBGL_lose_context");a&&a.loseContext()}return s=null,n}catch{return!1}}()),ns}var Fl="#f0f8ff",Nl="#faebd7",Ol="#00ffff",Ll="#7fffd4",Ul="#f0ffff",kl="#f5f5dc",Gl="#ffe4c4",Hl="#000000",Xl="#ffebcd",jl="#0000ff",zl="#8a2be2",Vl="#a52a2a",$l="#deb887",Wl="#5f9ea0",Yl="#7fff00",ql="#d2691e",Kl="#ff7f50",Zl="#6495ed",Jl="#fff8dc",Ql="#dc143c",tc="#00ffff",ec="#00008b",ic="#008b8b",rc="#b8860b",sc="#a9a9a9",nc="#006400",ac="#a9a9a9",oc="#bdb76b",hc="#8b008b",lc="#556b2f",cc="#ff8c00",uc="#9932cc",dc="#8b0000",fc="#e9967a",pc="#8fbc8f",mc="#483d8b",gc="#2f4f4f",vc="#2f4f4f",yc="#00ced1",_c="#9400d3",xc="#ff1493",bc="#00bfff",Ec="#696969",Tc="#696969",wc="#1e90ff",Sc="#b22222",Ac="#fffaf0",Cc="#228b22",Ic="#ff00ff",Rc="#dcdcdc",Pc="#f8f8ff",Mc="#daa520",Dc="#ffd700",Bc="#808080",Fc="#008000",Nc="#adff2f",Oc="#808080",Lc="#f0fff0",Uc="#ff69b4",kc="#cd5c5c",Gc="#4b0082",Hc="#fffff0",Xc="#f0e68c",jc="#fff0f5",zc="#e6e6fa",Vc="#7cfc00",$c="#fffacd",Wc="#add8e6",Yc="#f08080",qc="#e0ffff",Kc="#fafad2",Zc="#d3d3d3",Jc="#90ee90",Qc="#d3d3d3",tu="#ffb6c1",eu="#ffa07a",iu="#20b2aa",ru="#87cefa",su="#778899",nu="#778899",au="#b0c4de",ou="#ffffe0",hu="#00ff00",lu="#32cd32",cu="#faf0e6",uu="#ff00ff",du="#800000",fu="#66cdaa",pu="#0000cd",mu="#ba55d3",gu="#9370db",vu="#3cb371",yu="#7b68ee",_u="#00fa9a",xu="#48d1cc",bu="#c71585",Eu="#191970",Tu="#f5fffa",wu="#ffe4e1",Su="#ffe4b5",Au="#ffdead",Cu="#000080",Iu="#fdf5e6",Ru="#808000",Pu="#6b8e23",Mu="#ffa500",Du="#ff4500",Bu="#da70d6",Fu="#eee8aa",Nu="#98fb98",Ou="#afeeee",Lu="#db7093",Uu="#ffefd5",ku="#ffdab9",Gu="#cd853f",Hu="#ffc0cb",Xu="#dda0dd",ju="#b0e0e6",zu="#800080",Vu="#663399",$u="#ff0000",Wu="#bc8f8f",Yu="#4169e1",qu="#8b4513",Ku="#fa8072",Zu="#f4a460",Ju="#2e8b57",Qu="#fff5ee",td="#a0522d",ed="#c0c0c0",id="#87ceeb",rd="#6a5acd",sd="#708090",nd="#708090",ad="#fffafa",od="#00ff7f",hd="#4682b4",ld="#d2b48c",cd="#008080",ud="#d8bfd8",dd="#ff6347",fd="#40e0d0",pd="#ee82ee",md="#f5deb3",gd="#ffffff",vd="#f5f5f5",yd="#ffff00",_d="#9acd32",xd={aliceblue:Fl,antiquewhite:Nl,aqua:Ol,aquamarine:Ll,azure:Ul,beige:kl,bisque:Gl,black:Hl,blanchedalmond:Xl,blue:jl,blueviolet:zl,brown:Vl,burlywood:$l,cadetblue:Wl,chartreuse:Yl,chocolate:ql,coral:Kl,cornflowerblue:Zl,cornsilk:Jl,crimson:Ql,cyan:tc,darkblue:ec,darkcyan:ic,darkgoldenrod:rc,darkgray:sc,darkgreen:nc,darkgrey:ac,darkkhaki:oc,darkmagenta:hc,darkolivegreen:lc,darkorange:cc,darkorchid:uc,darkred:dc,darksalmon:fc,darkseagreen:pc,darkslateblue:mc,darkslategray:gc,darkslategrey:vc,darkturquoise:yc,darkviolet:_c,deeppink:xc,deepskyblue:bc,dimgray:Ec,dimgrey:Tc,dodgerblue:wc,firebrick:Sc,floralwhite:Ac,forestgreen:Cc,fuchsia:Ic,gainsboro:Rc,ghostwhite:Pc,goldenrod:Mc,gold:Dc,gray:Bc,green:Fc,greenyellow:Nc,grey:Oc,honeydew:Lc,hotpink:Uc,indianred:kc,indigo:Gc,ivory:Hc,khaki:Xc,lavenderblush:jc,lavender:zc,lawngreen:Vc,lemonchiffon:$c,lightblue:Wc,lightcoral:Yc,lightcyan:qc,lightgoldenrodyellow:Kc,lightgray:Zc,lightgreen:Jc,lightgrey:Qc,lightpink:tu,lightsalmon:eu,lightseagreen:iu,lightskyblue:ru,lightslategray:su,lightslategrey:nu,lightsteelblue:au,lightyellow:ou,lime:hu,limegreen:lu,linen:cu,magenta:uu,maroon:du,mediumaquamarine:fu,mediumblue:pu,mediumorchid:mu,mediumpurple:gu,mediumseagreen:vu,mediumslateblue:yu,mediumspringgreen:_u,mediumturquoise:xu,mediumvioletred:bu,midnightblue:Eu,mintcream:Tu,mistyrose:wu,moccasin:Su,navajowhite:Au,navy:Cu,oldlace:Iu,olive:Ru,olivedrab:Pu,orange:Mu,orangered:Du,orchid:Bu,palegoldenrod:Fu,palegreen:Nu,paleturquoise:Ou,palevioletred:Lu,papayawhip:Uu,peachpuff:ku,peru:Gu,pink:Hu,plum:Xu,powderblue:ju,purple:zu,rebeccapurple:Vu,red:$u,rosybrown:Wu,royalblue:Yu,saddlebrown:qu,salmon:Ku,sandybrown:Zu,seagreen:Ju,seashell:Qu,sienna:td,silver:ed,skyblue:id,slateblue:rd,slategray:sd,slategrey:nd,snow:ad,springgreen:od,steelblue:hd,tan:ld,teal:cd,thistle:ud,tomato:dd,turquoise:fd,violet:pd,wheat:md,white:gd,whitesmoke:vd,yellow:yd,yellowgreen:_d};function Fi(e,t=[]){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(e&255)/255,t}function eo(e){let t=e.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function xn(e){if(typeof e=="string"&&(e=xd[e.toLowerCase()]||e,e[0]==="#"&&(e=e.slice(1)),e.length===3)){const[t,i,r]=e;e=t+t+i+i+r+r}return parseInt(e,16)}function bd(){const e=[],t=[];for(let r=0;r<32;r++)e[r]=r,t[r]=r;e[X.NORMAL_NPM]=X.NORMAL,e[X.ADD_NPM]=X.ADD,e[X.SCREEN_NPM]=X.SCREEN,t[X.NORMAL]=X.NORMAL_NPM,t[X.ADD]=X.ADD_NPM,t[X.SCREEN]=X.SCREEN_NPM;const i=[];return i.push(t),i.push(e),i}const io=bd();function ro(e,t){return io[t?1:0][e]}function Ed(e,t,i,r){return i=i||new Float32Array(4),r||r===void 0?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t):(i[0]=e[0],i[1]=e[1],i[2]=e[2]),i[3]=t,i}function bn(e,t){if(t===1)return(t*255<<24)+e;if(t===0)return 0;let i=e>>16&255,r=e>>8&255,s=e&255;return i=i*t+.5|0,r=r*t+.5|0,s=s*t+.5|0,(t*255<<24)+(i<<16)+(r<<8)+s}function so(e,t,i,r){return i=i||new Float32Array(4),i[0]=(e>>16&255)/255,i[1]=(e>>8&255)/255,i[2]=(e&255)/255,(r||r===void 0)&&(i[0]*=t,i[1]*=t,i[2]*=t),i[3]=t,i}function Td(e,t=null){const i=e*6;if(t=t||new Uint16Array(i),t.length!==i)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${i}`);for(let r=0,s=0;r<i;r+=6,s+=4)t[r+0]=s+0,t[r+1]=s+1,t[r+2]=s+2,t[r+3]=s+0,t[r+4]=s+2,t[r+5]=s+3;return t}function no(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}function Ir(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Jn(e){return!(e&e-1)&&!!e}function Qn(e){let t=(e>65535?1:0)<<4;e>>>=t;let i=(e>255?1:0)<<3;return e>>>=i,t|=i,i=(e>15?1:0)<<2,e>>>=i,t|=i,i=(e>3?1:0)<<1,e>>>=i,t|=i,t|e>>1}function ri(e,t,i){const r=e.length;let s;if(t>=r||i===0)return;i=t+i>r?r-t:i;const n=r-i;for(s=t;s<n;++s)e[s]=e[s+i];e.length=n}function Je(e){return e===0?0:e<0?-1:1}let wd=0;function Ue(){return++wd}const ao=class{constructor(e,t,i,r){this.left=e,this.top=t,this.right=i,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Hs=ao;Hs.EMPTY=new ao(0,0,0,0);const ta={},ie=Object.create(null),ge=Object.create(null);class ea{constructor(t,i,r){this._canvas=N.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||N.RESOLUTION,this.resize(t,i)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,i){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(i*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function ia(e,t,i){for(let r=0,s=4*i*t;r<t;++r,s+=4)if(e[s+3]!==0)return!1;return!0}function ra(e,t,i,r,s){const n=4*t;for(let a=r,o=r*n+4*i;a<=s;++a,o+=n)if(e[o+3]!==0)return!1;return!0}function Sd(e){const{width:t,height:i}=e,r=e.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const n=r.getImageData(0,0,t,i).data;let a=0,o=0,h=t-1,l=i-1;for(;o<i&&ia(n,t,o);)++o;if(o===i)return Hs.EMPTY;for(;ia(n,t,l);)--l;for(;ra(n,t,a,o,l);)++a;for(;ra(n,t,h,o,l);)--h;return++h,++l,new Hs(a,o,h,l)}function Ad(e){const t=Sd(e),{width:i,height:r}=t;let s=null;if(!t.isEmpty()){const n=e.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,i,r)}return{width:i,height:r,data:s}}let qi;function Cd(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,qi||(qi=document.createElement("a")),qi.href=e;const i=Rl.parse(qi.href),r=!i.port&&t.port===""||i.port===t.port;return i.hostname!==t.hostname||!r||i.protocol!==t.protocol?"anonymous":""}function Te(e,t=1){var r;const i=(r=N.RETINA_PREFIX)==null?void 0:r.exec(e);return i?parseFloat(i[1]):t}var B=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(B||{});const Xs=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");e={...typeof e.extension!="object"?{type:e.extension}:e.extension,ref:e}}if(typeof e=="object")e={...e};else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},sa=(e,t)=>Xs(e).priority??t,G={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(Xs).forEach(t=>{t.type.forEach(i=>{var r,s;return(s=(r=this._removeHandlers)[i])==null?void 0:s.call(r,t)})}),this},add(...e){return e.map(Xs).forEach(t=>{t.type.forEach(i=>{const r=this._addHandlers,s=this._queue;r[i]?r[i](t):(s[i]=s[i]||[],s[i].push(t))})}),this},handle(e,t,i){const r=this._addHandlers,s=this._removeHandlers;if(r[e]||s[e])throw new Error(`Extension type ${e} already has a handler`);r[e]=t,s[e]=i;const n=this._queue;return n[e]&&(n[e].forEach(a=>t(a)),delete n[e]),this},handleByMap(e,t){return this.handle(e,i=>{t[i.name]=i.ref},i=>{delete t[i.name]})},handleByList(e,t,i=-1){return this.handle(e,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,n)=>sa(n,i)-sa(s,i)))},r=>{const s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};class js{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Id=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Rd(e){let t="";for(let i=0;i<e;++i)i>0&&(t+=`
else `),i<e-1&&(t+=`if(test == ${i}.0){}`);return t}function Pd(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=Id.replace(/%forloop%/gi,Rd(e));if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))e=e/2|0;else break}return e}const as=0,os=1,hs=2,ls=3,cs=4,us=5;let He=class oo{constructor(){this.data=0,this.blendMode=X.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<as)}set blend(t){!!(this.data&1<<as)!==t&&(this.data^=1<<as)}get offsets(){return!!(this.data&1<<os)}set offsets(t){!!(this.data&1<<os)!==t&&(this.data^=1<<os)}get culling(){return!!(this.data&1<<hs)}set culling(t){!!(this.data&1<<hs)!==t&&(this.data^=1<<hs)}get depthTest(){return!!(this.data&1<<ls)}set depthTest(t){!!(this.data&1<<ls)!==t&&(this.data^=1<<ls)}get depthMask(){return!!(this.data&1<<us)}set depthMask(t){!!(this.data&1<<us)!==t&&(this.data^=1<<us)}get clockwiseFrontFace(){return!!(this.data&1<<cs)}set clockwiseFrontFace(t){!!(this.data&1<<cs)!==t&&(this.data^=1<<cs)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==X.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixijs/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new oo;return t.depthTest=!1,t.blend=!0,t}};const zs=[];function ho(e,t){if(!e)return null;let i="";if(typeof e=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);r&&(i=r[1].toLowerCase())}for(let r=zs.length-1;r>=0;--r){const s=zs[r];if(s.test&&s.test(e,i))return new s(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Zt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,i,r,s,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](t,i,r,s,n,a,o,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const i=this.items.indexOf(t);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Zt.prototype,{dispatch:{value:Zt.prototype.emit},run:{value:Zt.prototype.emit}});class Ni{constructor(t=0,i=0){this._width=t,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new Zt("setRealSize"),this.onUpdate=new Zt("update"),this.onError=new Zt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,i){(t!==this._width||i!==this._height)&&(this._width=t,this._height=i,this.onResize.emit(t,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,i,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,i){return!1}}class ji extends Ni{constructor(t,i){const{width:r,height:s}=i||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t}upload(t,i,r){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Qt.UNPACK);const n=i.realWidth,a=i.realHeight;return r.width===n&&r.height===a?s.texSubImage2D(i.target,0,0,0,n,a,i.format,r.type,this.data):(r.width=n,r.height=a,s.texImage2D(i.target,0,r.internalFormat,n,a,0,i.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const Md={scaleMode:fe.NEAREST,format:P.RGBA,alphaMode:Qt.NPM},Ye=class extends Oe{constructor(e=null,t=null){super(),t=Object.assign({},Ye.defaultOptions,t);const{alphaMode:i,mipmap:r,anisotropicLevel:s,scaleMode:n,width:a,height:o,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:f}=t;e&&!(e instanceof Ni)&&(e=ho(e,f),e.internal=!0),this.resolution=d||N.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=s,this._wrapMode=h,this._scaleMode=n,this.format=l,this.type=c,this.target=u,this.alphaMode=i,this.uid=Ue(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Jn(this.realWidth)&&Jn(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ge[this.cacheId],delete ie[this.cacheId],this.cacheId=null),this.dispose(),Ye.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=N.STRICT_TEXTURE_CACHE){const r=typeof e=="string";let s=null;if(r)s=e;else{if(!e._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${Ue()}`}s=e._pixiId}let n=ge[s];if(r&&i&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new Ye(e,t),n.cacheId=s,Ye.addToCache(n,s)),n}static fromBuffer(e,t,i,r){e=e||new Float32Array(t*i*4);const s=new ji(e,{width:t,height:i}),n=e instanceof Float32Array?H.FLOAT:H.UNSIGNED_BYTE;return new Ye(s,Object.assign({},Md,r||{width:t,height:i,type:n}))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ge[t]&&ge[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ge[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ge[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete ge[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ge[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let z=Ye;z.defaultOptions={mipmap:le.POW2,anisotropicLevel:0,scaleMode:fe.LINEAR,wrapMode:be.CLAMP,alphaMode:Qt.UNPACK,target:ei.TEXTURE_2D,format:P.RGBA,type:H.UNSIGNED_BYTE};z._globalBatch=0;class Vs{constructor(){this.texArray=null,this.blend=0,this.type=ae.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Dd=0;class ft{constructor(t,i=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=i,this.id=Dd++,this.disposeRunner=new Zt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?oe.ELEMENT_ARRAY_BUFFER:oe.ARRAY_BUFFER}get index(){return this.type===oe.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new ft(t)}}class Rr{constructor(t,i=0,r=!1,s=H.FLOAT,n,a,o,h=1){this.buffer=t,this.size=i,this.normalized=r,this.type=s,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,i,r,s,n){return new Rr(t,i,r,s,n)}}const Bd={Float32Array,Uint32Array,Int32Array,Uint8Array};function Fd(e,t){let i=0,r=0;const s={};for(let h=0;h<e.length;h++)r+=t[h],i+=e[h].length;const n=new ArrayBuffer(i*4);let a=null,o=0;for(let h=0;h<e.length;h++){const l=t[h],c=e[h],u=no(c);s[u]||(s[u]=new Bd[u](n)),a=s[u];for(let d=0;d<c.length;d++){const f=(d/l|0)*r+o,p=d%l;a[f+p]=c[d]}o+=l}return new Float32Array(n)}const na={5126:4,5123:2,5121:1};let Nd=0;const Od={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class we{constructor(t=[],i={}){this.buffers=t,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=Nd++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Zt("disposeGeometry"),this.refCount=0}addAttribute(t,i,r=0,s=!1,n,a,o,h=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof ft||(i instanceof Array&&(i=new Float32Array(i)),i=new ft(i));const l=t.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],i,r,s,n);return this}let c=this.buffers.indexOf(i);return c===-1&&(this.buffers.push(i),c=this.buffers.length-1),this.attributes[t]=new Rr(c,r,s,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof ft||(t instanceof Array&&(t=new Uint16Array(t)),t=new ft(t)),t.type=oe.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],i=[],r=new ft;let s;for(s in this.attributes){const n=this.attributes[s],a=this.buffers[n.buffer];t.push(a.data),i.push(n.size*na[n.type]/4),n.buffer=0}for(r.data=Fd(t,i),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const i=this.attributes[t];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new we;for(let i=0;i<this.buffers.length;i++)t.buffers[i]=new ft(this.buffers[i].data.slice(0));for(const i in this.attributes){const r=this.attributes[i];t.attributes[i]=new Rr(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=oe.ELEMENT_ARRAY_BUFFER),t}static merge(t){const i=new we,r=[],s=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)s[h]=s[h]||0,s[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)r[o]=new Od[no(a.buffers[o].data)](s[o]),i.buffers[o]=new ft(r[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(i.attributes=a.attributes,a.indexBuffer){i.indexBuffer=i.buffers[a.buffers.indexOf(a.indexBuffer)],i.indexBuffer.type=oe.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,c=0;for(let u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){c=u;break}for(const u in a.attributes){const d=a.attributes[u];(d.buffer|0)===c&&(h+=d.size*na[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)i.indexBuffer.data[f+l]+=o;o+=t[u].buffers[c].data.length/h,l+=d.length}}return i}}class lo extends we{constructor(t=!1){super(),this._buffer=new ft(null,t,!1),this._indexBuffer=new ft(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,H.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,H.FLOAT).addAttribute("aColor",this._buffer,4,!0,H.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,H.FLOAT).addIndex(this._indexBuffer)}}const Pr=Math.PI*2,Ld=180/Math.PI,Ud=Math.PI/180;var St=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(St||{});class q{constructor(t=0,i=0){this.x=0,this.y=0,this.x=t,this.y=i}clone(){return new q(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,i=t){return this.x=t,this.y=i,this}toString(){return`[pixijs/math:Point x=${this.x} y=${this.y}]`}}const Ki=[new q,new q,new q,new q];class Y{constructor(t=0,i=0,r=0,s=0){this.x=Number(t),this.y=Number(i),this.width=Number(r),this.height=Number(s),this.type=St.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Y(0,0,0,0)}clone(){return new Y(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,i){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(t,i){if(!i){const w=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=w)return!1;const F=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>F}const r=this.left,s=this.right,n=this.top,a=this.bottom;if(s<=r||a<=n)return!1;const o=Ki[0].set(t.left,t.top),h=Ki[1].set(t.left,t.bottom),l=Ki[2].set(t.right,t.top),c=Ki[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const u=Math.sign(i.a*i.d-i.b*i.c);if(u===0||(i.apply(o,o),i.apply(h,h),i.apply(l,l),i.apply(c,c),Math.max(o.x,h.x,l.x,c.x)<=r||Math.min(o.x,h.x,l.x,c.x)>=s||Math.max(o.y,h.y,l.y,c.y)<=n||Math.min(o.y,h.y,l.y,c.y)>=a))return!1;const d=u*(h.y-o.y),f=u*(o.x-h.x),p=d*r+f*n,m=d*s+f*n,g=d*r+f*a,y=d*s+f*a;if(Math.max(p,m,g,y)<=d*o.x+f*o.y||Math.min(p,m,g,y)>=d*c.x+f*c.y)return!1;const _=u*(o.y-l.y),v=u*(l.x-o.x),x=_*r+v*n,T=_*s+v*n,C=_*r+v*a,A=_*s+v*a;return!(Math.max(x,T,C,A)<=_*o.x+v*o.y||Math.min(x,T,C,A)>=_*c.x+v*c.y)}pad(t=0,i=t){return this.x-=t,this.y-=i,this.width+=t*2,this.height+=i*2,this}fit(t){const i=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=i,this.width=Math.max(r-i,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,i=.001){const r=Math.ceil((this.x+this.width-i)*t)/t,s=Math.ceil((this.y+this.height-i)*t)/t;return this.x=Math.floor((this.x+i)*t)/t,this.y=Math.floor((this.y+i)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){const i=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=i,this.width=r-i,this.y=s,this.height=n-s,this}toString(){return`[pixijs/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class En{constructor(t=0,i=0,r=0){this.x=t,this.y=i,this.radius=r,this.type=St.CIRC}clone(){return new En(this.x,this.y,this.radius)}contains(t,i){if(this.radius<=0)return!1;const r=this.radius*this.radius;let s=this.x-t,n=this.y-i;return s*=s,n*=n,s+n<=r}getBounds(){return new Y(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[pixijs/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Tn{constructor(t=0,i=0,r=0,s=0){this.x=t,this.y=i,this.width=r,this.height=s,this.type=St.ELIP}clone(){return new Tn(this.x,this.y,this.width,this.height)}contains(t,i){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,s=(i-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new Y(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[pixijs/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class si{constructor(...t){let i=Array.isArray(t[0])?t[0]:t;if(typeof i[0]!="number"){const r=[];for(let s=0,n=i.length;s<n;s++)r.push(i[s].x,i[s].y);i=r}this.points=i,this.type=St.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),i=new si(t);return i.closeStroke=this.closeStroke,i}contains(t,i){let r=!1;const s=this.points.length/2;for(let n=0,a=s-1;n<s;a=n++){const o=this.points[n*2],h=this.points[n*2+1],l=this.points[a*2],c=this.points[a*2+1];h>i!=c>i&&t<(l-o)*((i-h)/(c-h))+o&&(r=!r)}return r}toString(){return`[pixijs/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,i)=>`${t}, ${i}`,"")}]`}}class wn{constructor(t=0,i=0,r=0,s=0,n=20){this.x=t,this.y=i,this.width=r,this.height=s,this.radius=n,this.type=St.RREC}clone(){return new wn(this.x,this.y,this.width,this.height,this.radius)}contains(t,i){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+r&&i<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let s=t-(this.x+r),n=i-(this.y+r);const a=r*r;if(s*s+n*n<=a||(s=t-(this.x+this.width-r),s*s+n*n<=a)||(n=i-(this.y+this.height-r),s*s+n*n<=a)||(s=t-(this.x+r),s*s+n*n<=a))return!0}return!1}toString(){return`[pixijs/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class nt{constructor(t=1,i=0,r=0,s=1,n=0,a=0){this.array=null,this.a=t,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,i,r,s,n,a){return this.a=t,this.b=i,this.c=r,this.d=s,this.tx=n,this.ty=a,this}toArray(t,i){this.array||(this.array=new Float32Array(9));const r=i||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,i){i=i||new q;const r=t.x,s=t.y;return i.x=this.a*r+this.c*s+this.tx,i.y=this.b*r+this.d*s+this.ty,i}applyInverse(t,i){i=i||new q;const r=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return i.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,i.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,i}translate(t,i){return this.tx+=t,this.ty+=i,this}scale(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this}rotate(t){const i=Math.cos(t),r=Math.sin(t),s=this.a,n=this.c,a=this.tx;return this.a=s*i-this.b*r,this.b=s*r+this.b*i,this.c=n*i-this.d*r,this.d=n*r+this.d*i,this.tx=a*i-this.ty*r,this.ty=a*r+this.ty*i,this}append(t){const i=this.a,r=this.b,s=this.c,n=this.d;return this.a=t.a*i+t.b*s,this.b=t.a*r+t.b*n,this.c=t.c*i+t.d*s,this.d=t.c*r+t.d*n,this.tx=t.tx*i+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,i,r,s,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(r*this.a+s*this.c),this.ty=i-(r*this.b+s*this.d),this}prepend(t){const i=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this}decompose(t){const i=this.a,r=this.b,s=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-s,n),h=Math.atan2(r,i),l=Math.abs(o+h);return l<1e-5||Math.abs(Pr-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(i*i+r*r),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(a.x*i+a.y*s),t.position.y=this.ty+(a.x*r+a.y*n),t}invert(){const t=this.a,i=this.b,r=this.c,s=this.d,n=this.tx,a=t*s-i*r;return this.a=s/a,this.b=-i/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-s*n)/a,this.ty=-(t*this.ty-i*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new nt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[pixijs/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new nt}static get TEMP_MATRIX(){return new nt}}const Re=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Pe=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Me=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],De=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],$s=[],co=[],Zi=Math.sign;function kd(){for(let e=0;e<16;e++){const t=[];$s.push(t);for(let i=0;i<16;i++){const r=Zi(Re[e]*Re[i]+Me[e]*Pe[i]),s=Zi(Pe[e]*Re[i]+De[e]*Pe[i]),n=Zi(Re[e]*Me[i]+Me[e]*De[i]),a=Zi(Pe[e]*Me[i]+De[e]*De[i]);for(let o=0;o<16;o++)if(Re[o]===r&&Pe[o]===s&&Me[o]===n&&De[o]===a){t.push(o);break}}}for(let e=0;e<16;e++){const t=new nt;t.set(Re[e],Pe[e],Me[e],De[e],0,0),co.push(t)}}kd();const ot={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Re[e],uY:e=>Pe[e],vX:e=>Me[e],vY:e=>De[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>$s[e][t],sub:(e,t)=>$s[e][ot.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?ot.S:ot.N:Math.abs(t)*2<=Math.abs(e)?e>0?ot.E:ot.W:t>0?e>0?ot.SE:ot.SW:e>0?ot.NE:ot.NW,matrixAppendRotationInv:(e,t,i=0,r=0)=>{const s=co[ot.inv(t)];s.tx=i,s.ty=r,e.append(s)}};class _e{constructor(t,i,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=i}clone(t=this.cb,i=this.scope){return new _e(t,i,this._x,this._y)}set(t=0,i=t){return(this._x!==t||this._y!==i)&&(this._x=t,this._y=i,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixijs/math:ObservablePoint x=${0} y=${0} scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const uo=class{constructor(){this.worldTransform=new nt,this.localTransform=new nt,this.position=new _e(this.onChange,this,0,0),this.scale=new _e(this.onChange,this,1,1),this.pivot=new _e(this.onChange,this,0,0),this.skew=new _e(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[pixijs/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const i=e.worldTransform,r=this.worldTransform;r.a=t.a*i.a+t.b*i.c,r.b=t.a*i.b+t.b*i.d,r.c=t.c*i.a+t.d*i.c,r.d=t.c*i.b+t.d*i.d,r.tx=t.tx*i.a+t.ty*i.c+i.tx,r.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let Sn=uo;Sn.IDENTITY=new uo;var Gd=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Hd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function aa(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}function ds(e){const t=new Array(e);for(let i=0;i<t.length;i++)t[i]=!1;return t}function fo(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return ds(2*t);case"bvec3":return ds(3*t);case"bvec4":return ds(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ni=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],Xd={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},jd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function zd(e,t){var r;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in e.uniforms){const n=t[s];if(!n){(r=e.uniforms[s])!=null&&r.group&&(e.uniforms[s].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}const a=e.uniforms[s];let o=!1;for(let h=0;h<ni.length;h++)if(ni[h].test(n,a)){i.push(ni[h].code(s,a)),o=!0;break}if(!o){const l=(n.size===1&&!n.isArray?Xd:jd)[n.type].replace("location",`ud["${s}"].location`);i.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const po={};let je=po;function Vd(){if(je===po||je!=null&&je.isContextLost()){const e=N.ADAPTER.createCanvas();let t;N.PREFER_ENV>=Ge.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),je=t}return je}let Ji;function $d(){if(!Ji){Ji=kt.MEDIUM;const e=Vd();e&&e.getShaderPrecisionFormat&&(Ji=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?kt.HIGH:kt.MEDIUM)}return Ji}function oa(e,t){const i=e.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),r=e.getShaderInfoLog(t),s=r.split(`
`),n={},a=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{i[l-1]=`%c${i[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=i.join(`
`);o[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function Wd(e,t,i,r){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(i,e.COMPILE_STATUS)||oa(e,i),e.getShaderParameter(r,e.COMPILE_STATUS)||oa(e,r),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const Yd={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mo(e){return Yd[e]}let Qi=null;const ha={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function go(e,t){if(!Qi){const i=Object.keys(ha);Qi={};for(let r=0;r<i.length;++r){const s=i[r];Qi[e[s]]=ha[s]}}return Qi[t]}function la(e,t,i){if(e.substring(0,9)!=="precision"){let r=t;return t===kt.HIGH&&i!==kt.HIGH&&(r=kt.MEDIUM),`precision ${r} float;
${e}`}else if(i!==kt.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let pi;function qd(){if(typeof pi=="boolean")return pi;try{pi=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{pi=!1}return pi}let Kd=0;const tr={},qe=class{constructor(e,t,i="pixi-shader",r={}){this.extra={},this.id=Kd++,this.vertexSrc=e||qe.defaultVertexSrc,this.fragmentSrc=t||qe.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),tr[i]?(tr[i]++,i+=`-${tr[i]}`):tr[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=la(this.vertexSrc,qe.defaultVertexPrecision,kt.HIGH),this.fragmentSrc=la(this.fragmentSrc,qe.defaultFragmentPrecision,$d())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Hd}static get defaultFragmentSrc(){return Gd}static from(e,t,i){const r=e+t;let s=ta[r];return s||(ta[r]=s=new qe(e,t,i)),s}};let qt=qe;qt.defaultVertexPrecision=kt.HIGH;qt.defaultFragmentPrecision=pe.apple.device?kt.HIGH:kt.MEDIUM;let Zd=0;class Jt{constructor(t,i,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Zd++,this.static=!!i,this.ubo=!!r,t instanceof ft?(this.buffer=t,this.buffer.type=oe.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new ft(new Float32Array(1)),this.buffer.type=oe.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,i,r){if(!this.ubo)this.uniforms[t]=new Jt(i,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,i,r){return new Jt(t,i,r)}static uboFrom(t,i){return new Jt(t,i??!0,!0)}}class he{constructor(t,i){this.uniformBindCount=0,this.program=t,i?i instanceof Jt?this.uniformGroup=i:this.uniformGroup=new Jt(i):this.uniformGroup=new Jt({}),this.disposeRunner=new Zt("disposeShader")}checkUniformExists(t,i){if(i.uniforms[t])return!0;for(const r in i.uniforms){const s=i.uniforms[r];if(s.group&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,i,r){const s=qt.from(t,i);return new he(s,r)}}class Jd{constructor(t,i){if(this.vertexSrc=t,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=Jt.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new qt(this.vertexSrc,s)}const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new nt,default:this.defaultGroupCache[t]};return new he(this.programCache[t],i)}generateSampleSrc(t){let i="";i+=`
`,i+=`
`;for(let r=0;r<t;r++)r>0&&(i+=`
else `),r<t-1&&(i+=`if(vTextureId < ${r}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}}class Ws{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Qd(){return!pe.apple.device}function tf(e){let t=!0;const i=N.ADAPTER.getNavigator();if(pe.tablet||pe.phone){if(pe.apple.device){const r=i.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(pe.android.device){const r=i.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?e:4}class Wr{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var ef=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,rf=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const jt=class extends Wr{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=lo,this.vertexSize=6,this.state=He.for2d(),this.size=jt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??tf(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Qd(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return K("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return rf}static get defaultFragmentTemplate(){return ef}setShaderGenerator({vertex:e=jt.defaultVertexSrc,fragment:t=jt.defaultFragmentTemplate}={}){this.shaderGenerator=new Jd(e,t)}contextChange(){const e=this.renderer.gl;N.PREFER_ENV===Ge.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),jt.defaultMaxTextures),this.maxTextures=Pd(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=jt,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new Vs);for(;t.length<r;)t.push(new Ws);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=jt._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count;let a=++z._globalBatch,o=0,h=i[0],l=0;r.copyBoundTextures(s,t);for(let c=0;c<this._bufferSize;++c){const u=e[c];e[c]=null,u._batchEnabled!==a&&(h.count>=t&&(r.boundArray(h,s,a,t),this.buildDrawCalls(h,l,c),l=c,h=i[++o],++a),u._batchEnabled=a,u.touched=n,h.elements[h.count++]=u)}h.count>0&&(r.boundArray(h,s,a,t),this.buildDrawCalls(h,l,this._bufferSize),++o,++a);for(let c=0;c<s.length;c++)s[c]=null;z._globalBatch=a}buildDrawCalls(e,t,i){const{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:a}=this,o=jt._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=o[h];u.start=this._iIndex,u.texArray=e;for(let d=t;d<i;++d){const f=r[d],p=f._texture.baseTexture,m=io[p.alphaMode?1:0][f.blendMode];r[d]=null,t<d&&u.blend!==m&&(u.size=c-u.start,t=d,u=o[++h],u.texArray=e,u.start=c),this.packInterleavedGeometry(f,s,n,l,c),l+=f.vertexData.length/2*a,c+=f.indices.length,u.blend=m}t<i&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;jt.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,r=jt._drawCallPool;let s=null;for(let n=0;n<e;n++){const{texArray:a,type:o,size:h,start:l,blend:c}=r[n];s!==a&&(s=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),t.drawElements(o,h,t.UNSIGNED_SHORT,l*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),jt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Ir(Math.ceil(e/8)),i=Qn(t),r=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new js(r*this.vertexSize*4)),s}getIndexBuffer(e){const t=Ir(Math.ceil(e/12)),i=Qn(t),r=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let s=this._iBuffers[i];return s||(this._iBuffers[i]=s=new Uint16Array(r)),s}packInterleavedGeometry(e,t,i,r,s){const{uint32View:n,float32View:a}=t,o=r/this.vertexSize,h=e.uvs,l=e.indices,c=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),f=d<1&&e._texture.baseTexture.alphaMode?bn(e._tintRGB,d):e._tintRGB+(d*255<<24);for(let p=0;p<c.length;p+=2)a[r++]=c[p],a[r++]=c[p+1],a[r++]=h[p],a[r++]=h[p+1],n[r++]=f,a[r++]=u;for(let p=0;p<l.length;p++)i[s++]=o+l[p]}};let Wt=jt;Wt.defaultBatchSize=4096;Wt.extension={name:"batch",type:B.RendererPlugin};Wt._drawCallPool=[];Wt._textureArrayPool=[];G.add(Wt);var sf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,nf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const bi=class extends he{constructor(e,t,i){const r=qt.from(e||bi.defaultVertexSrc,t||bi.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=bi.defaultResolution,this.multisample=bi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new He}apply(e,t,i,r,s){e.applyFilter(this,t,i,r)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return nf}static get defaultFragmentSrc(){return sf}};let At=bi;At.defaultResolution=1;At.defaultMultisample=gt.NONE;class vo{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?xn(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=eo(t),Fi(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}vo.extension={type:[B.RendererSystem,B.CanvasRendererSystem],name:"background"};G.add(vo);class yo{constructor(t){this.renderer=t,this.emptyRenderer=new Wr(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,i){const{boundTextures:r}=this.renderer.texture;for(let s=i-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,i,r,s){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const c=n[l],u=c._batchLocation;if(u>=0&&u<s&&i[u]===c){a[l]=u;continue}for(;h<s;){const d=i[h];if(d&&d._batchEnabled===r&&d._batchLocation===h){h++;continue}a[l]=h,c._batchLocation=h,i[h]=c;break}}}destroy(){this.renderer=null}}yo.extension={type:B.RendererSystem,name:"batch"};G.add(yo);let ca=0;class _o{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ca++}init(t){if(t.context)this.initFromContext(t.context);else{const i=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ca++,this.renderer.runners.contextChange.emit(t);const i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const i=this.createContext(this.renderer.view,t);this.initFromContext(i)}createContext(t,i){let r;if(N.PREFER_ENV>=Ge.WEBGL2&&(r=t.getContext("webgl2",i)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,i={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const i=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}_o.extension={type:B.RendererSystem,name:"context"};G.add(_o);class af extends ji{upload(t,i,r){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Qt.UNPACK);const n=i.realWidth,a=i.realHeight;return r.width===n&&r.height===a?s.texSubImage2D(i.target,0,0,0,n,a,i.format,r.type,this.data):(r.width=n,r.height=a,s.texImage2D(i.target,0,r.internalFormat,n,a,0,i.format,r.type,this.data)),!0}}class Ys{constructor(t,i){this.width=Math.round(t||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Zt("disposeFramebuffer"),this.multisample=gt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,i){return this.colorTextures[t]=i||new z(null,{scaleMode:fe.NEAREST,resolution:1,mipmap:le.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new z(new af(null,{width:this.width,height:this.height}),{scaleMode:fe.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:le.OFF,format:P.DEPTH_COMPONENT,type:H.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,i){if(t=Math.round(t),i=Math.round(i),!(t===this.width&&i===this.height)){this.width=t,this.height=i,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(t/n,i/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,i/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class xo extends z{constructor(t={}){if(typeof t=="number"){const i=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];t={width:i,height:r,scaleMode:s,resolution:n}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=gt.NONE),super(null,t),this.mipmap=le.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Ys(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,i){this.framebuffer.resize(t*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Se extends Ni{constructor(t){const i=t,r=i.naturalWidth||i.videoWidth||i.width,s=i.naturalHeight||i.videoHeight||i.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,i,r){r===void 0&&!i.startsWith("data:")?t.crossOrigin=Cd(i):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,i,r,s){const n=t.gl,a=i.realWidth,o=i.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Qt.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&r.width===a&&r.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,r.type,s):(r.width=a,r.height=o,n.texImage2D(i.target,0,r.internalFormat,i.format,r.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,i=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(i,r),super.update()}dispose(){this.source=null}}class bo extends Se{constructor(t,i){if(i=i||{},typeof t=="string"){const r=new Image;Se.crossOrigin(r,t,i.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(i.createBitmap??N.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((i,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?i(this.process()):i(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const i=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>i(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Qt.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,i,r){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,i,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,i,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=i._glTextures;for(const a in n){const o=n[a];if(o!==r&&o.dirtyId!==i.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Eo{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,i,r){const s=i.width,n=i.height;if(r){const a=t.width/2/s,o=t.height/2/n,h=t.x/s+a,l=t.y/n+o;r=ot.add(r,ot.NW),this.x0=h+a*ot.uX(r),this.y0=l+o*ot.uY(r),r=ot.add(r,2),this.x1=h+a*ot.uX(r),this.y1=l+o*ot.uY(r),r=ot.add(r,2),this.x2=h+a*ot.uX(r),this.y2=l+o*ot.uY(r),r=ot.add(r,2),this.x3=h+a*ot.uX(r),this.y3=l+o*ot.uY(r)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[pixijs/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const ua=new Eo;function er(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class k extends Oe{constructor(t,i,r,s,n,a){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new Y(0,0,1,1)),t instanceof k&&(t=t.baseTexture),this.baseTexture=t,this._frame=i,this.trim=s,this.valid=!1,this._uvs=ua,this.uvMatrix=null,this.orig=r||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new q(a.x,a.y):new q(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=i:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:i}=this.baseTexture;i!=null&&i.url&&ie[i.url]&&k.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,k.removeFromCache(this),this.textureCacheIds=null}clone(){var s;const t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),r=new k(this.baseTexture,!this.noFrame&&t,i,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===ua&&(this._uvs=new Eo),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,i={},r=N.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof z){if(!t.cacheId){const o=(i==null?void 0:i.pixiIdPrefix)||"pixiid";t.cacheId=`${o}-${Ue()}`,z.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=(i==null?void 0:i.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${Ue()}`}n=t._pixiId}let a=ie[n];if(s&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof z)?(i.resolution||(i.resolution=Te(t)),a=new k(new z(t,i)),a.baseTexture.cacheId=n,z.addToCache(a.baseTexture,n),k.addToCache(a,n)):!a&&t instanceof z&&(a=new k(t),k.addToCache(a,n)),a}static fromURL(t,i){const r=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),s=k.from(t,Object.assign({resourceOptions:r},i),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,i,r,s){return new k(z.fromBuffer(t,i,r,s))}static fromLoader(t,i,r,s){const n=new z(t,Object.assign({scaleMode:z.defaultOptions.scaleMode,resolution:Te(i)},s)),{resource:a}=n;a instanceof bo&&(a.url=i);const o=new k(n);return r||(r=i),z.addToCache(o.baseTexture,r),k.addToCache(o,r),r!==i&&(z.addToCache(o.baseTexture,i),k.addToCache(o,i)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(t,i){i&&(t.textureCacheIds.includes(i)||t.textureCacheIds.push(i),ie[i]&&ie[i]!==t&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),ie[i]=t)}static removeFromCache(t){if(typeof t=="string"){const i=ie[t];if(i){const r=i.textureCacheIds.indexOf(t);return r>-1&&i.textureCacheIds.splice(r,1),delete ie[t],i}}else if(t!=null&&t.textureCacheIds){for(let i=0;i<t.textureCacheIds.length;++i)ie[t.textureCacheIds[i]]===t&&delete ie[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:i,y:r,width:s,height:n}=t,a=i+s>this.baseTexture.width,o=r+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${i} + ${s} = ${i+s} > ${this.baseTexture.width}`,c=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return k._EMPTY||(k._EMPTY=new k(new z),er(k._EMPTY),er(k._EMPTY.baseTexture)),k._EMPTY}static get WHITE(){if(!k._WHITE){const t=N.ADAPTER.createCanvas(16,16),i=t.getContext("2d");t.width=16,t.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),k._WHITE=new k(z.from(t)),er(k._WHITE),er(k._WHITE.baseTexture)}return k._WHITE}}class Ae extends k{constructor(t,i){super(t,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,i,r=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,a=Math.round(i*s)/s;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:i}=this;i.resolution!==t&&(i.setResolution(t),this.resize(i.width,i.height,!1))}static create(t){return new Ae(new xo(t))}}class To{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,i,r=gt.NONE){const s=new xo(Object.assign({width:t,height:i,resolution:1,multisample:r},this.textureOptions));return new Ae(s)}getOptimalTexture(t,i,r=1,s=gt.NONE){let n;t=Math.ceil(t*r-1e-6),i=Math.ceil(i*r-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||i!==this._pixelsHeight?(t=Ir(t),i=Ir(i),n=((t&65535)<<16|i&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,i,s)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(t,i,r){const s=this.getOptimalTexture(t.width,t.height,i||t.resolution,r||gt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const i=t.filterPoolKey;t.filterFrame=null,this.texturePool[i].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const i in this.texturePool){const r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const i in this.texturePool){if(!(Number(i)<0))continue;const r=this.texturePool[i];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}To.SCREEN_KEY=-1;class of extends we{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class wo extends we{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ft(this.vertices),this.uvBuffer=new ft(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,i){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+i.width/t.width,this.uvs[3]=s,this.uvs[4]=r+i.width/t.width,this.uvs[5]=s+i.height/t.height,this.uvs[6]=r,this.uvs[7]=s+i.height/t.height,r=i.x,s=i.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+i.width,this.vertices[3]=s,this.vertices[4]=r+i.width,this.vertices[5]=s+i.height,this.vertices[6]=r,this.vertices[7]=s+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class hf{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=gt.NONE,this.sourceFrame=new Y,this.destinationFrame=new Y,this.bindingSourceFrame=new Y,this.bindingDestinationFrame=new Y,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ir=[new q,new q,new q,new q],fs=new nt;class So{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new To,this.statePool=[],this.quad=new of,this.quadUv=new wo,this.tempRect=new Y,this.activeState={},this.globalUniforms=new Jt({outputFrame:new Y,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,i){const r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new hf,a=this.renderer.renderTexture;let o=i[0].resolution,h=i[0].multisample,l=i[0].padding,c=i[0].autoFit,u=i[0].legacy??!0;for(let p=1;p<i.length;p++){const m=i[p];o=Math.min(o,m.resolution),h=Math.min(h,m.multisample),l=this.useMaxPadding?Math.max(l,m.padding):l+m.padding,c=c&&m.autoFit,u=u||(m.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(n),n.resolution=o,n.multisample=h,n.legacy=u,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(l);const d=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(fs.copyFrom(r.projection.transform).invert(),d),c?(n.sourceFrame.fit(d),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(d)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o,h),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,f),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,i=t.pop(),r=i.filters;this.activeState=i;const s=this.globalUniforms.uniforms;s.outputFrame=i.sourceFrame,s.resolution=i.resolution;const n=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*i.resolution),a[1]=Math.round(n[1]*i.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=i.sourceFrame.width*n[2]-.5*a[2],o[3]=i.sourceFrame.height*n[3]-.5*a[3],i.legacy){const l=s.filterArea;l[0]=i.destinationFrame.width,l[1]=i.destinationFrame.height,l[2]=i.sourceFrame.x,l[3]=i.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,i.renderTexture,h.renderTexture,re.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let l=i.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,i.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<r.length-1;++u){u===1&&i.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,i.resolution),c.filterFrame=l.filterFrame),r[u].apply(this,l,c,re.CLEAR,i);const d=l;l=c,c=d}r[u].apply(this,l,h.renderTexture,re.BLEND,i),u>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}i.clear(),this.statePool.push(i)}bindAndClear(t,i=re.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(i===re.CLEAR||i===re.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,i,r,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=i,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(ae.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(ae.TRIANGLE_STRIP))}calculateSpriteMatrix(t,i){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=i._texture,a=t.set(s.width,0,0,s.height,r.x,r.y),o=i.worldTransform.copyTo(nt.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(i.anchor.x,i.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,i,r=1,s=gt.NONE){return this.texturePool.getOptimalTexture(t,i,r,s)}getFilterTexture(t,i,r){if(typeof t=="number"){const n=t;t=i,i=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,i||t.resolution,r||gt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,i){const r=ir[0],s=ir[1],n=ir[2],a=ir[3];r.set(i.left,i.top),s.set(i.left,i.bottom),n.set(i.right,i.top),a.set(i.right,i.bottom),t.apply(r,r),t.apply(s,s),t.apply(n,n),t.apply(a,a);const o=Math.min(r.x,s.x,n.x,a.x),h=Math.min(r.y,s.y,n.y,a.y),l=Math.max(r.x,s.x,n.x,a.x),c=Math.max(r.y,s.y,n.y,a.y);i.x=o,i.y=h,i.width=l-o,i.height=c-h}roundFrame(t,i,r,s,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?fs.copyFrom(n):fs.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(i),this.transformAABB(n.invert(),t)}}}So.extension={type:B.RendererSystem,name:"filter"};G.add(So);class lf{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=gt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const cf=new Y;class Ao{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ys(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Y,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;N.PREFER_ENV===Ge.WEBGL_LEGACY&&(i=null,r=null),i?t.drawBuffers=s=>i.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,i,r=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),i){const a=i.width>>r,o=i.height>>r,h=a/i.width;this.setViewport(i.x*h,i.y*h,a,o)}else{const a=t.width>>r,o=t.height>>r;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,i,r,s){const n=this.viewport;t=Math.round(t),i=Math.round(i),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==t||n.y!==i)&&(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,i,r,s,n=Bs.COLOR|Bs.DEPTH){const{gl:a}=this;a.clearColor(t,i,r,s),a.clear(n)}initFramebuffer(t){const{gl:i}=this,r=new lf(i.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:i}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height));const s=t.colorTextures;let n=s.length;i.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=s[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&r.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,i){const{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;r.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,i),o.push(r.COLOR_ATTACHMENT0+h))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const l=t.depthTexture;this.renderer.texture.bind(l,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,i)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:i}=this;let r=gt.NONE;if(t<=1||i===null)return r;for(let s=0;s<i.length;s++)if(i[s]<=t){r=i[s];break}return r===1&&(r=gt.NONE),r}blit(t,i,r){const{current:s,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const c=s.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new Ys(s.width,s.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}i||(i=cf,i.width=s.width,i.height=s.height),r||(r=i);const l=i.width===r.width&&i.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(i.left,i.top,i.right,i.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR)}disposeFramebuffer(t,i){const r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),i||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}disposeAll(t){const i=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<i.length;r++)this.disposeFramebuffer(i[r],t)}forceStencil(){const t=this.current;if(!t)return;const i=t.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;t.stencil=!0;const r=t.width,s=t.height,n=this.gl,a=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,r,s):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,s),i.stencil=a,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Y}destroy(){this.renderer=null}}Ao.extension={type:B.RendererSystem,name:"framebuffer"};G.add(Ao);const ps={5126:4,5123:2,5121:1};class Co{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;N.PREFER_ENV===Ge.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,a,o,h)=>r.drawElementsInstancedANGLE(s,n,a,o,h),t.drawArraysInstanced=(s,n,a,o)=>r.drawArraysInstancedANGLE(s,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(t,i){i=i||this.renderer.shader.shader;const{gl:r}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const a=s[i.program.id]||this.initGeometryVao(t,i,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,i=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];i.update(s)}}checkCompatibility(t,i){const r=t.attributes,s=i.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,i){const r=t.attributes,s=i.attributeData,n=["g",t.id];for(const a in r)s[a]&&n.push(a,s[a].location);return n.join("-")}initGeometryVao(t,i,r=!0){const s=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=i.program;o.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let c=l[h];if(c)return l[o.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&o.attributeData[m]?d[m].size=o.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*ps[d[m].type];for(const m in d){const g=d[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*ps[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*ps[g.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let m=0;m<u.length;m++){const g=u[m];a.bind(g),r&&g._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=c,l[h]=c,s.bindVertexArray(null),a.unbind(oe.ARRAY_BUFFER),c}disposeGeometry(t,i){var o;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,a=(o=this.renderer)==null?void 0:o.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let h=0;h<n.length;h++){const l=n[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&a.dispose(n[h],i))}if(!i){for(const h in r)if(h[0]==="g"){const l=r[h];this._activeVao===l&&this.unbind(),s.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const i=Object.keys(this.managedGeometries);for(let r=0;r<i.length;r++)this.disposeGeometry(this.managedGeometries[i[r]],t)}activateVao(t,i){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const c=o[l],u=a[c.buffer],d=u._glBuffers[s];if(i.attributeData[l]){h!==d&&(n.bind(u),h=d);const f=i.attributeData[l].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)r.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,i,r,s){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,i||a.indexBuffer.data.length,h,(r||0)*o,s||1):n.drawElements(t,i||a.indexBuffer.data.length,h,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,r,i||a.getSize(),s||1):n.drawArrays(t,r,i||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Co.extension={type:B.RendererSystem,name:"geometry"};G.add(Co);const da=new nt;class Io{constructor(t,i){this._texture=t,this.mapCoord=new nt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i>"u"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,i){i===void 0&&(i=t);const r=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],a=t[s+1];i[s]=n*r.a+a*r.c+r.tx,i[s+1]=n*r.b+a*r.d+r.ty}return i}update(t){const i=this._texture;if(!i||!i.valid||!t&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;const r=i._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=i.orig,n=i.trim;n&&(da.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(da));const a=i.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(i._frame.x+h+l)/a.width,o[1]=(i._frame.y+h+l)/a.height,o[2]=(i._frame.x+i._frame.width-h+l)/a.width,o[3]=(i._frame.y+i._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=i._frame.width===a.width&&i._frame.height===a.height&&i.rotate===0,!0}}var uf=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,df=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class ff extends At{constructor(t,i,r){let s=null;typeof t!="string"&&i===void 0&&r===void 0&&(s=t,t=void 0,i=void 0,r=void 0),super(t||df,i||uf,r),this.maskSprite=s,this.maskMatrix=new nt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,i,r,s){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Io(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,i,r,s))}}class pf{constructor(t=null){this.type=yt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=At.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=yt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Ro{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,i){let r=i;if(!r.isMaskData){const n=this.maskDataPool.pop()||new pf;n.pooled=!0,n.maskObject=i,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==yt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case yt.SCISSOR:this.renderer.scissor.push(r);break;case yt.STENCIL:this.renderer.stencil.push(r);break;case yt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case yt.COLOR:this.pushColorMask(r);break}r.type===yt.SPRITE&&this.maskStack.push(r)}pop(t){const i=this.maskStack.pop();if(!(!i||i._target!==t)){if(i.enabled)switch(i.type){case yt.SCISSOR:this.renderer.scissor.pop(i);break;case yt.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case yt.SPRITE:this.popSpriteMask(i);break;case yt.COLOR:this.popColorMask(i);break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===yt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const i=t.maskObject;i?i.isSprite?t.type=yt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=yt.SCISSOR:t.type=yt.STENCIL:t.type=yt.COLOR}pushSpriteMask(t){const{maskObject:i}=t,r=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new ff]));const n=this.renderer,a=n.renderTexture;let o,h;if(a.current){const c=a.current;o=t.resolution||c.resolution,h=t.multisample??c.multisample}else o=t.resolution||n.resolution,h=t.multisample??n.multisample;s[0].resolution=o,s[0].multisample=h,s[0].maskSprite=i;const l=r.filterArea;r.filterArea=i.getBounds(!0),n.filter.push(r,s),r.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const i=t._colorMask,r=t._colorMask=i&t.colorMask;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const i=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==i&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Ro.extension={type:B.RendererSystem,name:"mask"};G.add(Ro);class Po{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:i}=this.renderer,r=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==r&&(s===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const fa=new nt,pa=[],yr=class extends Po{constructor(e){super(e),this.glConst=N.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:r}=this,s=r.renderTexture,n=i.getBounds(!0,pa.pop()??new Y);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:r,d:s}=e;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||yr.isMatrixRotated(t.worldTransform)||yr.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,r,s){yr.isMatrixRotated(s)||(s=s?fa.copyFrom(s):fa.identity(),s.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,e),e.fit(r),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&pa.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let Mo=yr;Mo.extension={type:B.RendererSystem,name:"scissor"};G.add(Mo);class Do extends Po{constructor(t){super(t),this.glConst=N.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const i=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Do.extension={type:B.RendererSystem,name:"stencil"};G.add(Do);class Bo{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return K("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return K("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return K("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const i in t)this.plugins[i]=new t[i](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Bo.extension={type:[B.RendererSystem,B.CanvasRendererSystem],name:"_plugin"};G.add(Bo);class Fo{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new nt,this.transform=null}update(t,i,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,i,r,s){const n=this.projectionMatrix,a=s?-1:1;n.identity(),n.a=1/i.width*2,n.d=a*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-a-i.y*n.d}setTransform(t){}destroy(){this.renderer=null}}Fo.extension={type:B.RendererSystem,name:"projection"};G.add(Fo);const mf=new Sn;class No{constructor(t){this.renderer=t,this._tempMatrix=new nt}generateTexture(t,i){const{region:r,...s}=i||{},n=r||t.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);const a=Ae.create({width:n.width,height:n.height,...s});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const o=t.transform;return t.transform=mf,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}No.extension={type:[B.RendererSystem,B.CanvasRendererSystem],name:"textureGenerator"};G.add(No);const Ce=new Y,mi=new Y;class Oo{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Y,this.destinationFrame=new Y,this.viewportFrame=new Y}bind(t=null,i,r){const s=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,i||(Ce.width=t.frame.width,Ce.height=t.frame.height,i=Ce),r||(mi.x=t.frame.x,mi.y=t.frame.y,mi.width=i.width,mi.height=i.height,r=mi),a=n.framebuffer):(o=s.resolution,i||(Ce.width=s._view.screen.width,Ce.height=s._view.screen.height,i=Ce),r||(r=Ce,r.width=i.width,r.height=i.height));const h=this.viewportFrame;h.x=r.x*o,h.y=r.y*o,h.width=r.width*o,h.height=r.height*o,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,i,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(r)}clear(t,i){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const r=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,n=r.width!==s.width||r.height!==s.height;if(n){let{x:a,y:o,width:h,height:l}=this.viewportFrame;a=Math.round(a),o=Math.round(o),h=Math.round(h),l=Math.round(l),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,h,l)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],i),n&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Oo.extension={type:B.RendererSystem,name:"renderTexture"};G.add(Oo);class gf{constructor(t,i){this.program=t,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function vf(e,t){const i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=t.getActiveAttrib(e,s);if(n.name.startsWith("gl_"))continue;const a=go(t,n.type),o={type:a,name:n.name,size:mo(a),location:t.getAttribLocation(e,n.name)};i[n.name]=o}return i}function yf(e,t){const i={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=t.getActiveUniform(e,s),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=go(t,n.type);i[a]={name:a,index:s,type:h,size:n.size,isArray:o,value:fo(h,n.size)}}return i}function _f(e,t){var h;const i=aa(e,e.VERTEX_SHADER,t.vertexSrc),r=aa(e,e.FRAGMENT_SHADER,t.fragmentSrc),s=e.createProgram();e.attachShader(s,i),e.attachShader(s,r);const n=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(n&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||Wd(e,s,i,r),t.attributeData=vf(s,e),t.uniformData=yf(s,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((c,u)=>c>u?1:-1);for(let c=0;c<l.length;c++)t.attributeData[l[c]].location=c,e.bindAttribLocation(s,c,l[c]);e.linkProgram(s)}e.deleteShader(i),e.deleteShader(r);const a={};for(const l in t.uniformData){const c=t.uniformData[l];a[l]={location:e.getUniformLocation(s,l),value:fo(c.type,c.size)}}return new gf(s,a)}function xf(e,t,i,r,s){i.buffer.update(s)}const bf={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Lo={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Ef(e){const t=e.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let i=0,r=0,s=0;for(let n=0;n<t.length;n++){const a=t[n];if(i=Lo[a.data.type],a.data.size>1&&(i=Math.max(i,16)*a.data.size),a.dataLen=i,r%i!==0&&r<16){const o=r%i%16;r+=o,s+=o}r+i>16?(s=Math.ceil(s/16)*16,a.offset=s,s+=i,r=i):(a.offset=s,r+=i,s+=i)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function Tf(e,t){const i=[];for(const r in e)t[r]&&i.push(t[r]);return i.sort((r,s)=>r.index-s.index),i}function wf(e,t){if(!e.autoManage)return{size:0,syncFunc:xf};const i=Tf(e.uniforms,t),{uboElements:r,size:s}=Ef(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const o=r[a],h=e.uniforms[o.data.name],l=o.data.name;let c=!1;for(let u=0;u<ni.length;u++){const d=ni[u];if(d.codeUbo&&d.test(o.data,h)){n.push(`offset = ${o.offset/4};`,ni[u].codeUbo(o.data.name,h)),c=!0;break}}if(!c)if(o.data.size>1){const u=mo(o.data.type),d=Math.max(Lo[o.data.type]/16,1),f=u/d,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=bf[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Sf=0;const rr={textureCount:0,uboCount:0};class Uo{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Sf++}systemCheck(){if(!qd())throw new Error("Current environment does not allow unsafe-eval, please use pixijs/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,i){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),i||(rr.textureCount=0,rr.uboCount=0,this.syncUniformGroup(t.uniformGroup,rr)),s}setUniforms(t){const i=this.shader.program,r=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,i){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,i))}syncUniforms(t,i,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(i.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const i=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=zd(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[i],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,i){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,i);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,rr,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[i])}createSyncBufferGroup(t,i,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(i.program,r);i.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=wf(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return i.uniformGroups[t.id]=o.syncFunc,i.uniformGroups[t.id]}getSignature(t,i,r){const s=t.uniforms,n=[`${r}-`];for(const a in s)n.push(a),i[a]&&n.push(i[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const i=this.gl,r=t.program,s=_f(i,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Uo.extension={type:B.RendererSystem,name:"shader"};G.add(Uo);class ko{constructor(t){this.renderer=t}run(t){const i=this.renderer;i.emitWithCustomOptions(i.runners.init,t),t.hello&&console.log(`PixiJS 7.1.1 - ${i.rendererLogId} - https://pixijs.com`),i.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}ko.extension={type:[B.RendererSystem,B.CanvasRendererSystem],name:"startup"};G.add(ko);function Af(e,t=[]){return t[X.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.ADD]=[e.ONE,e.ONE],t[X.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.NONE]=[0,0],t[X.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[X.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[X.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[X.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[X.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[X.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[X.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[X.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[X.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[X.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[X.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const Cf=0,If=1,Rf=2,Pf=3,Mf=4,Df=5,qs=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=X.NONE,this._blendEq=!1,this.map=[],this.map[Cf]=this.setBlend,this.map[If]=this.setOffset,this.map[Rf]=this.setCullFace,this.map[Pf]=this.setDepthTest,this.map[Mf]=this.setFrontFace,this.map[Df]=this.setDepthMask,this.checks=[],this.defaultState=new He,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=Af(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(qs.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(qs.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let Go=qs;Go.extension={type:B.RendererSystem,name:"state"};G.add(Go);let Bf=class extends Oe{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const i=(t.priority??[]).filter(s=>t.systems[s]),r=[...i,...Object.keys(t.systems).filter(s=>!i.includes(s))];for(const s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(i=>{this.runners[i]=new Zt(i)})}addSystem(t,i){const r=new t(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=r,this._systemsHash[i]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,i){const r=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=r.find(a=>this._systemsHash[a]===s);s[t.name](i[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}};const _r=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=_r.defaultMaxIdle,this.checkCountMax=_r.defaultCheckCountMax,this.mode=_r.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==_n.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let r=0;r<t.length;r++){const s=t[r];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(e.destroyTexture(s,!0),t[r]=null,i=!0)}if(i){let r=0;for(let s=0;s<t.length;s++)t[s]!==null&&(t[r++]=t[s]);t.length=r}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let r=e.children.length-1;r>=0;r--)this.unload(e.children[r])}destroy(){this.renderer=null}};let Yt=_r;Yt.defaultMode=_n.AUTO;Yt.defaultMaxIdle=60*60;Yt.defaultCheckCountMax=60*10;Yt.extension={type:B.RendererSystem,name:"textureGC"};G.add(Yt);class ms{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=H.UNSIGNED_BYTE,this.internalFormat=P.RGBA,this.samplerType=0}}function Ff(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[H.UNSIGNED_BYTE]:{[P.RGBA]:e.RGBA8,[P.RGB]:e.RGB8,[P.RG]:e.RG8,[P.RED]:e.R8,[P.RGBA_INTEGER]:e.RGBA8UI,[P.RGB_INTEGER]:e.RGB8UI,[P.RG_INTEGER]:e.RG8UI,[P.RED_INTEGER]:e.R8UI,[P.ALPHA]:e.ALPHA,[P.LUMINANCE]:e.LUMINANCE,[P.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[H.BYTE]:{[P.RGBA]:e.RGBA8_SNORM,[P.RGB]:e.RGB8_SNORM,[P.RG]:e.RG8_SNORM,[P.RED]:e.R8_SNORM,[P.RGBA_INTEGER]:e.RGBA8I,[P.RGB_INTEGER]:e.RGB8I,[P.RG_INTEGER]:e.RG8I,[P.RED_INTEGER]:e.R8I},[H.UNSIGNED_SHORT]:{[P.RGBA_INTEGER]:e.RGBA16UI,[P.RGB_INTEGER]:e.RGB16UI,[P.RG_INTEGER]:e.RG16UI,[P.RED_INTEGER]:e.R16UI,[P.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[H.SHORT]:{[P.RGBA_INTEGER]:e.RGBA16I,[P.RGB_INTEGER]:e.RGB16I,[P.RG_INTEGER]:e.RG16I,[P.RED_INTEGER]:e.R16I},[H.UNSIGNED_INT]:{[P.RGBA_INTEGER]:e.RGBA32UI,[P.RGB_INTEGER]:e.RGB32UI,[P.RG_INTEGER]:e.RG32UI,[P.RED_INTEGER]:e.R32UI,[P.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[H.INT]:{[P.RGBA_INTEGER]:e.RGBA32I,[P.RGB_INTEGER]:e.RGB32I,[P.RG_INTEGER]:e.RG32I,[P.RED_INTEGER]:e.R32I},[H.FLOAT]:{[P.RGBA]:e.RGBA32F,[P.RGB]:e.RGB32F,[P.RG]:e.RG32F,[P.RED]:e.R32F,[P.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[H.HALF_FLOAT]:{[P.RGBA]:e.RGBA16F,[P.RGB]:e.RGB16F,[P.RG]:e.RG16F,[P.RED]:e.R16F},[H.UNSIGNED_SHORT_5_6_5]:{[P.RGB]:e.RGB565},[H.UNSIGNED_SHORT_4_4_4_4]:{[P.RGBA]:e.RGBA4},[H.UNSIGNED_SHORT_5_5_5_1]:{[P.RGBA]:e.RGB5_A1},[H.UNSIGNED_INT_2_10_10_10_REV]:{[P.RGBA]:e.RGB10_A2,[P.RGBA_INTEGER]:e.RGB10_A2UI},[H.UNSIGNED_INT_10F_11F_11F_REV]:{[P.RGB]:e.R11F_G11F_B10F},[H.UNSIGNED_INT_5_9_9_9_REV]:{[P.RGB]:e.RGB9_E5},[H.UNSIGNED_INT_24_8]:{[P.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[H.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[P.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[H.UNSIGNED_BYTE]:{[P.RGBA]:e.RGBA,[P.RGB]:e.RGB,[P.ALPHA]:e.ALPHA,[P.LUMINANCE]:e.LUMINANCE,[P.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[H.UNSIGNED_SHORT_5_6_5]:{[P.RGB]:e.RGB},[H.UNSIGNED_SHORT_4_4_4_4]:{[P.RGBA]:e.RGBA},[H.UNSIGNED_SHORT_5_5_5_1]:{[P.RGBA]:e.RGBA}},t}class Ho{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new z,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Ff(t);const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let s=0;s<i;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new ms(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new ms(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,i=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[i]!==t&&(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[i]=t}else this.currentLocation!==i&&(this.currentLocation=i,r.activeTexture(r.TEXTURE0+i)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:i,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(i.activeTexture(i.TEXTURE0+s),this.currentLocation=s),i.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){const{boundTextures:i,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=t-1;n>=0;--n){const a=i[n];a&&a._glTextures[s].samplerType!==Fs.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const i=new ms(this.gl.createTexture());return i.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),i}initTextureType(t,i){var r;i.internalFormat=((r=this.internalFormats[t.type])==null?void 0:r[t.format])??t.format,this.webGLVersion===2&&t.type===H.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=t.type}updateTexture(t){var s;const i=t._glTextures[this.CONTEXT_UID];if(!i)return;const r=this.renderer;if(this.initTextureType(t,i),(s=t.resource)!=null&&s.upload(r,t,i))i.samplerType!==Fs.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,a=t.realHeight,o=r.gl;(i.width!==n||i.height!==a||i.dirtyId<0)&&(i.width=n,i.height=a,o.texImage2D(t.target,0,i.internalFormat,n,a,0,t.format,i.type,null))}t.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(t),i.dirtyId=t.dirtyId}destroyTexture(t,i){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!i)){const s=this.managedTextures.indexOf(t);s!==-1&&ri(this.managedTextures,s,1)}}updateTextureStyle(t){var r;const i=t._glTextures[this.CONTEXT_UID];i&&((t.mipmap===le.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?i.mipmap=!1:i.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?i.wrapMode=be.CLAMP:i.wrapMode=t.wrapMode,(r=t.resource)!=null&&r.style(this.renderer,t,i)||this.setStyle(t,i),i.dirtyStyleId=t.dirtyStyleId)}setStyle(t,i){const r=this.gl;if(i.mipmap&&t.mipmap!==le.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,i.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===fe.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===fe.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===fe.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===fe.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Ho.extension={type:B.RendererSystem,name:"texture"};G.add(Ho);class Xo{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:i,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,i){const{gl:r,renderer:s}=this;i&&s.shader.bind(i),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:i,renderer:r,CONTEXT_UID:s}=this,n=i.createTransformFeedback();t._glTransformFeedbacks[s]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];o&&(r.buffer.update(o),o._glBuffers[s].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,i){const r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!i&&n.dispose(o,i))}r&&(i||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Xo.extension={type:B.RendererSystem,name:"transformFeedback"};G.add(Xo);class jo{constructor(t){this.renderer=t}init(t){this.screen=new Y(0,0,t.width,t.height),this.element=t.view||N.ADAPTER.createCanvas(),this.resolution=t.resolution||N.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,i){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(i*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var i;t&&((i=this.element.parentNode)==null||i.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}jo.extension={type:[B.RendererSystem,B.CanvasRendererSystem],name:"_view"};G.add(jo);N.PREFER_ENV=Ge.WEBGL2;N.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(N,{WRAP_MODE:{get(){return z.defaultOptions.wrapMode},set(e){K("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),z.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return z.defaultOptions.scaleMode},set(e){K("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),z.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return z.defaultOptions.mipmap},set(e){K("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),z.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return z.defaultOptions.anisotropicLevel},set(e){K("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),z.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return K("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),At.defaultResolution},set(e){At.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return K("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),At.defaultMultisample},set(e){At.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return Wt.defaultMaxTextures},set(e){K("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Wt.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return Wt.defaultBatchSize},set(e){K("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Wt.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return Wt.canUploadSameBuffer},set(e){K("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Wt.canUploadSameBuffer=e}},GC_MODE:{get(){return Yt.defaultMode},set(e){K("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Yt.defaultMode=e}},GC_MAX_IDLE:{get(){return Yt.defaultMaxIdle},set(e){K("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Yt.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return Yt.defaultCheckCountMax},set(e){K("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Yt.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return qt.defaultVertexPrecision},set(e){K("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),qt.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return qt.defaultFragmentPrecision},set(e){K("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),qt.defaultFragmentPrecision=e}}});var ai=(e=>(e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(ai||{});class gs{constructor(t,i=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=i,this.priority=r,this.once=s}match(t,i=null){return this.fn===t&&this.context===i}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const i=this.next;return this.next=t?null:i,this.previous=null,i}}const Ot=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new gs(null,null,1/0),this.deltaMS=1/Ot.targetFPMS,this.elapsedMS=1/Ot.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=ai.NORMAL){return this._addListener(new gs(e,t,i))}addOnce(e,t,i=ai.NORMAL){return this._addListener(new gs(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const s=e-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=e-s%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Ot.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,Ot.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Ot._shared){const e=Ot._shared=new Ot;e.autoStart=!0,e._protected=!0}return Ot._shared}static get system(){if(!Ot._system){const e=Ot._system=new Ot;e.autoStart=!0,e._protected=!0}return Ot._system}};let Nt=Ot;Nt.targetFPMS=.06;Object.defineProperties(N,{TARGET_FPMS:{get(){return Nt.targetFPMS},set(e){K("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Nt.targetFPMS=e}}});class zo{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,ai.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Nt.shared:new Nt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}zo.extension=B.Application;G.add(zo);const Vo=[];G.handleByList(B.Renderer,Vo);function Nf(e){for(const t of Vo)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var Of=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Lf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Uf=Of,$o=Lf;class Wo{constructor(t){this.renderer=t}contextChange(t){let i;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}i>=gt.HIGH?this.multisample=gt.HIGH:i>=gt.MEDIUM?this.multisample=gt.MEDIUM:i>=gt.LOW?this.multisample=gt.LOW:this.multisample=gt.NONE}destroy(){}}Wo.extension={type:B.RendererSystem,name:"_multisample"};G.add(Wo);class kf{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Yo{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:i,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);i.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:i}=this;i.bindBuffer(t,null)}bindBufferBase(t,i){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[i]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[i]=t,r.bindBufferBase(r.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(t,i,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const a=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,i||0,a.buffer,r*256,256)}update(t){const{gl:i,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,i.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)i.bufferSubData(t.type,0,t.data);else{const n=t.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,i.bufferData(t.type,t.data,n)}}dispose(t,i){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(i||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const i=Object.keys(this.managedBuffers);for(let r=0;r<i.length;r++)this.dispose(this.managedBuffers[i[r]],t)}createGLBuffer(t){const{CONTEXT_UID:i,gl:r}=this;return t._glBuffers[i]=new kf(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[i]}}Yo.extension={type:B.RendererSystem,name:"buffer"};G.add(Yo);class qo{constructor(t){this.renderer=t}render(t,i){const r=this.renderer;let s,n,a,o;if(i&&(s=i.renderTexture,n=i.clear,a=i.transform,o=i.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(s||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(i.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}qo.extension={type:B.RendererSystem,name:"objectRenderer"};G.add(qo);const Ks=class extends Bf{constructor(e){super(),e=Object.assign({},N.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Jt({projectionMatrix:new nt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ks.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(K("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha);const i={hello:e.hello,_plugin:Ks.__plugins,background:{alpha:e.backgroundAlpha,color:e.background??e.backgroundColor,clearBeforeRender:e.clearBeforeRender},_view:{height:e.height,width:e.width,autoDensity:e.autoDensity,resolution:e.resolution,view:e.view},context:{antialias:e.antialias,context:e.context,powerPreference:e.powerPreference,premultipliedAlpha:e.premultipliedAlpha,preserveDrawingBuffer:e.preserveDrawingBuffer}};this.startup.run(i),this.options=e}static test(e){return e!=null&&e.forceCanvas?!1:Bl()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return K("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return K("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return K("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return K("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){K("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return K("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(e){K("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return K("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let ci=Ks;ci.extension={type:B.Renderer,priority:1};ci.__plugins={};ci.__systems={};G.handleByMap(B.RendererPlugin,ci.__plugins);G.handleByMap(B.RendererSystem,ci.__systems);G.add(ci);class Ko extends Ni{constructor(t,i){const{width:r,height:s}=i||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new z;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,i){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Ni?this.addResourceAt(t[r],r):this.addResourceAt(ho(t[r],i),r))}dispose(){for(let t=0,i=this.length;t<i;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[i].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=t,this.items[i].on("update",t.update,t)}unbind(t){super.unbind(t);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",t.update,t)}load(){if(this._load)return this._load;const i=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(i).then(()=>{const{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}}class Gf extends Ko{constructor(t,i){const{width:r,height:s}=i||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:r,height:s}),n&&this.initFromArray(n,i)}addBaseTextureAt(t,i){if(t.resource)this.addResourceAt(t.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=ei.TEXTURE_2D_ARRAY}upload(t,i,r){const{length:s,itemDirtyIds:n,items:a}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,i.format,r.type,null);for(let h=0;h<s;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,i.format,r.type,l.resource.source))}return!0}}class Hf extends Se{constructor(t){super(t)}static test(t){const{OffscreenCanvas:i}=globalThis;return i&&t instanceof i?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Ei=class extends Ko{constructor(e,t){const{width:i,height:r,autoLoad:s,linkBaseTexture:n}=t||{};if(e&&e.length!==Ei.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:r});for(let a=0;a<Ei.SIDES;a++)this.items[a].target=ei.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=n!==!1,e&&this.initFromArray(e,t),s!==!1&&this.load()}bind(e){super.bind(e),e.target=ei.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=ei.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const r=this.itemDirtyIds;for(let s=0;s<Ei.SIDES;s++){const n=this.items[s];(r[s]<n.dirtyId||i.dirtyId<t.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(e,n,i),r[s]=n.dirtyId):r[s]<-1&&(e.gl.texImage2D(n.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),r[s]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Ei.SIDES}};let Zo=Ei;Zo.SIDES=6;class Qe extends Se{constructor(t,i){i=i||{};let r,s;typeof t=="string"?(r=Qe.EMPTY,s=t):(r=t,s=null),super(r),this.url=s,this.crossOrigin=i.crossOrigin??!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,i)=>{if(this.url===null){t(this);return}try{const r=await N.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Qt.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;i(r),this.onError.emit(r)}}),this._load)}upload(t,i,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(t,i,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return Qe._EMPTY=Qe._EMPTY??N.ADAPTER.createCanvas(0,0),Qe._EMPTY}}const xr=class extends Se{constructor(e,t){t=t||{},super(N.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},xr.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;Se.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,s=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*t,s=this._overrideHeight||this._overrideWidth/t*i),r=Math.round(r),s=Math.round(s);const n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${Ue()}`,n.getContext("2d").drawImage(e,0,0,t,i,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(e){const t=xr.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&xr.SVG_XML.test(e)}};let Oi=xr;Oi.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Oi.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Zs=class extends Se{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const r=e[0].src||e[0];Se.crossOrigin(i,r,t.crossorigin);for(let s=0;s<e.length;++s){const n=document.createElement("source");let{src:a,mime:o}=e[s];a=a||e[s];const h=a.split("?").shift().toLowerCase(),l=h.slice(h.lastIndexOf(".")+1);o=o||Zs.MIME_TYPES[l]||`video/${l}`,n.src=a,n.type=o,i.appendChild(n)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=Nt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Nt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Nt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Nt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Zs.TYPES.includes(t)}};let An=Zs;An.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];An.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};zs.push(Qe,bo,Hf,An,Oi,ji,Zo,Gf);class Mr{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Y.EMPTY:(t=t||new Y(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,i){const{a:r,b:s,c:n,d:a,tx:o,ty:h}=t,l=r*i.x+n*i.y+o,c=s*i.x+a*i.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let i=this.minX,r=this.minY,s=this.maxX,n=this.maxY,a=t[0],o=t[1];i=a<i?a:i,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[2],o=t[3],i=a<i?a:i,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[4],o=t[5],i=a<i?a:i,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[6],o=t[7],i=a<i?a:i,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,this.minX=i,this.minY=r,this.maxX=s,this.maxY=n}addFrame(t,i,r,s,n){this.addFrameMatrix(t.worldTransform,i,r,s,n)}addFrameMatrix(t,i,r,s,n){const a=t.a,o=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=a*i+h*r+c,y=o*i+l*r+u;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=a*s+h*r+c,y=o*s+l*r+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=a*i+h*n+c,y=o*i+l*n+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=a*s+h*n+c,y=o*s+l*n+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(t,i,r){let s=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=i;h<r;h+=2){const l=t[h],c=t[h+1];s=l<s?l:s,n=c<n?c:n,a=l>a?l:a,o=c>o?c:o}this.minX=s,this.minY=n,this.maxX=a,this.maxY=o}addVertices(t,i,r,s){this.addVerticesMatrix(t.worldTransform,i,r,s)}addVerticesMatrix(t,i,r,s,n=0,a=n){const o=t.a,h=t.b,l=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=r;y<s;y+=2){const _=i[y],v=i[y+1],x=o*_+l*v+u,T=c*v+h*_+d;f=Math.min(f,x-n),m=Math.max(m,x+n),p=Math.min(p,T-a),g=Math.max(g,T+a)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(t){const i=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<i?t.minX:i,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,i){const r=t.minX>i.minX?t.minX:i.minX,s=t.minY>i.minY?t.minY:i.minY,n=t.maxX<i.maxX?t.maxX:i.maxX,a=t.maxY<i.maxY?t.maxY:i.maxY;if(r<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=r<o?r:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>c?a:c}}addBoundsMatrix(t,i){this.addFrameMatrix(i,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,i){const r=t.minX>i.x?t.minX:i.x,s=t.minY>i.y?t.minY:i.y,n=t.maxX<i.x+i.width?t.maxX:i.x+i.width,a=t.maxY<i.y+i.height?t.maxY:i.y+i.height;if(r<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=r<o?r:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>c?a:c}}pad(t=0,i=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=i,this.maxY+=i)}addFramePad(t,i,r,s,n,a){t-=n,i-=a,r+=n,s+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>s?this.maxY:s}}class ct extends Oe{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Sn,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Mr,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const i=Object.keys(t);for(let r=0;r<i.length;++r){const s=i[r];Object.defineProperty(ct.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,i){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new Y),i=this._boundsRect),this._bounds.getRectangle(i)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Mr);const i=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=i,this._bounds=s,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,i,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,i)}toLocal(t,i,r,s){return i&&(t=i.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,i=0,r=1,s=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=t,this.position.y=i,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Xf),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Ld}set angle(t){this.transform.rotation=t*Ud}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=t,this._mask){const i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}}}class Xf extends ct{constructor(){super(...arguments),this.sortDirty=null}}ct.prototype.displayObjectUpdateTransform=ct.prototype.updateTransform;const jf=new nt;function zf(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Js=class extends ct{constructor(){super(),this.children=[],this.sortableChildren=Js.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),r=this.getChildIndex(t);this.children[i]=t,this.children[r]=e,this.onChildrenChange(i<r?i:r)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);ri(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,ri(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,ri(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,r=t,s=r-i;let n;if(s>0&&s<=r){n=this.children.splice(i,s);for(let a=0;a<n.length;++a)n[a].parent=null,n[a].transform&&(n[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let a=0;a<n.length;++a)n[a].emit("removed",this),this.emit("childRemoved",n[a],this,a);return n}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const r=this.children[t];r._lastSortedIndex=t,!e&&r.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(zf),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let r=0,s=this.children.length;r<s;++r){const n=this.children[r];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==Js.prototype._render&&(i=this.getBounds(!0));const s=e.projection.transform;if(s&&(r?(r=jf.copyFrom(r),r.prepend(s)):r=s),i&&t.intersects(i,r))this._render(e);else if(this.cullArea)return;for(let n=0,a=this.children.length;n<a;++n){const o=this.children[n],h=o.cullable;o.cullable=h||!this.cullArea,o.render(e),o.cullable=h}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let i=0,r=this.children.length;i<r;++i)this.children[i].render(e)}}renderAdvanced(e){var s,n,a;const t=this.filters,i=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let o=0;o<t.length;o++)t[o].enabled&&this._enabledFilters.push(t[o])}const r=t&&((s=this._enabledFilters)==null?void 0:s.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==yt.NONE));if(r&&e.batch.flush(),t&&((n=this._enabledFilters)!=null&&n.length)&&e.filter.push(this,this._enabledFilters),i&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let o=0,h=this.children.length;o<h;++o)this.children[o].render(e)}r&&e.batch.flush(),i&&e.mask.pop(this),t&&((a=this._enabledFilters)!=null&&a.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,i=this.removeChildren(0,this.children.length);if(t)for(let r=0;r<i.length;++r)i[r].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let Gt=Js;Gt.defaultSortableChildren=!1;Gt.prototype.containerUpdateTransform=Gt.prototype.updateTransform;Object.defineProperties(N,{SORTABLE_CHILDREN:{get(){return Gt.defaultSortableChildren},set(e){K("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Gt.defaultSortableChildren=e}}});const gi=new q,Vf=new Uint16Array([0,1,2,0,2,3]);class Ee extends Gt{constructor(t){super(),this._anchor=new _e(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=X.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||k.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Vf,this.pluginName="batch",this.isSprite=!0,this._roundPixels=N.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Je(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Je(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const i=this.transform.worldTransform,r=i.a,s=i.b,n=i.c,a=i.d,o=i.tx,h=i.ty,l=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,g=c.y-d._y*u.height,m=g+c.height):(p=-d._x*u.width,f=p+u.width,g=-d._y*u.height,m=g+u.height),l[0]=r*p+n*g+o,l[1]=a*g+s*p+h,l[2]=r*f+n*g+o,l[3]=a*g+s*f+h,l[4]=r*f+n*m+o,l[5]=a*m+s*f+h,l[6]=r*p+n*m+o,l[7]=a*m+s*p+h,this._roundPixels){const y=N.RESOLUTION;for(let _=0;_<l.length;++_)l[_]=Math.round(l[_]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,i=this.vertexTrimmedData,r=t.orig,s=this._anchor,n=this.transform.worldTransform,a=n.a,o=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty,d=-s._x*r.width,f=d+r.width,p=-s._y*r.height,m=p+r.height;i[0]=a*d+h*p+c,i[1]=l*p+o*d+u,i[2]=a*f+h*p+c,i[3]=l*p+o*f+u,i[4]=a*f+h*m+c,i[5]=l*m+o*f+u,i[6]=a*d+h*m+c,i[7]=l*m+o*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,i=this._texture.orig;!t||t.width===i.width&&t.height===i.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Mr),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Y),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,gi);const i=this._texture.orig.width,r=this._texture.orig.height,s=-i*this.anchor.x;let n=0;return gi.x>=s&&gi.x<s+i&&(n=-r*this.anchor.y,gi.y>=n&&gi.y<n+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const r=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(t,i){const r=t instanceof k?t:k.from(t,i);return new Ee(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const i=Je(this.scale.x)||1;this.scale.x=i*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const i=Je(this.scale.y)||1;this.scale.y=i*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||k.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Jo=new nt;ct.prototype._cacheAsBitmap=!1;ct.prototype._cacheData=null;ct.prototype._cacheAsBitmapResolution=null;ct.prototype._cacheAsBitmapMultisample=null;class $f{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ct.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new $f),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});ct.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};ct.prototype._initCachedDisplayObject=function(t){var d,f;if((d=this._cacheData)!=null&&d.sprite)return;const i=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if((f=this.filters)!=null&&f.length){const p=this.filters[0].padding;r.pad(p)}r.ceil(N.RESOLUTION);const s=t.renderTexture.current,n=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,h=Ae.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),l=`cacheAsBitmap_${Ue()}`;this._cacheData.textureCacheId=l,z.addToCache(h.baseTexture,l),k.addToCache(h,l);const c=this.transform.localTransform.copyTo(Jo).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(s,n,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new Ee(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(r.x/r.width),u.anchor.y=-(r.y/r.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};ct.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};ct.prototype._initCachedDisplayObjectCanvas=function(t){var c;if((c=this._cacheData)!=null&&c.sprite)return;const i=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const s=t.canvasContext.activeContext,n=t._projTransform;i.ceil(N.RESOLUTION);const a=Ae.create({width:i.width,height:i.height}),o=`cacheAsBitmap_${Ue()}`;this._cacheData.textureCacheId=o,z.addToCache(a.baseTexture,o),k.addToCache(a,o);const h=Jo;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=i.x,h.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=s,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const l=new Ee(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(i.x/i.width),l.anchor.y=-(i.y/i.height),l.alpha=r,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};ct.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ct.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ct.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,z.removeFromCache(this._cacheData.textureCacheId),k.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ct.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};ct.prototype.name=null;Gt.prototype.getChildByName=function(t,i){for(let r=0,s=this.children.length;r<s;r++)if(this.children[r].name===t)return this.children[r];if(i)for(let r=0,s=this.children.length;r<s;r++){const n=this.children[r];if(!n.getChildByName)continue;const a=n.getChildByName(t,!0);if(a)return a}return null};ct.prototype.getGlobalPosition=function(t=new q,i=!1){return this.parent?this.parent.toGlobal(this.position,t,i):(t.x=this.position.x,t.y=this.position.y),t};var Wf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class Yf extends At{constructor(t=1){super(Uf,Wf,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const qf={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Kf=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Zf(e){const t=qf[e],i=t.length;let r=Kf,s="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let o=0;o<e;o++){let h=n.replace("%index%",o.toString());a=o,o>=i&&(a=e-o-1),h=h.replace("%value%",t[a].toString()),s+=h,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",e.toString()),r}const Jf=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Qf(e,t){const i=Math.ceil(e/2);let r=Jf,s="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<e;a++){let o=n.replace("%index%",a.toString());o=o.replace("%sampleIndex%",`${a-(i-1)}.0`),s+=o,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",e.toString()),r}class Qs extends At{constructor(t,i=8,r=4,s=At.defaultResolution,n=5){const a=Qf(n,t),o=Zf(n);super(a,o),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=r,this.blur=i}apply(t,i,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/i.width):this.uniforms.strength=1/r.height*(r.height/i.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/i.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/i.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,i,r,s);else{const n=t.getFilterTexture(),a=t.renderer;let o=i,h=n;this.state.blend=!1,t.applyFilter(this,o,h,re.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(o,re.BLIT),this.uniforms.uSampler=h;const c=h;h=o,o=c,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,r,s),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class tp extends At{constructor(t=8,i=4,r=At.defaultResolution,s=5){super(),this.blurXFilter=new Qs(!0,t,i,r,s),this.blurYFilter=new Qs(!1,t,i,r,s),this.resolution=r,this.quality=i,this.blur=t,this.repeatEdgePixels=!1}apply(t,i,r,s){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const o=t.getFilterTexture();this.blurXFilter.apply(t,i,o,re.CLEAR),this.blurYFilter.apply(t,o,r,s),t.returnFilterTexture(o)}else a?this.blurYFilter.apply(t,i,r,s):this.blurXFilter.apply(t,i,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var ep=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class tn extends At{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super($o,ep,t),this.alpha=1}_loadMatrix(t,i=!1){let r=t;i&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,i,r){return t[0]=i[0]*r[0]+i[1]*r[5]+i[2]*r[10]+i[3]*r[15],t[1]=i[0]*r[1]+i[1]*r[6]+i[2]*r[11]+i[3]*r[16],t[2]=i[0]*r[2]+i[1]*r[7]+i[2]*r[12]+i[3]*r[17],t[3]=i[0]*r[3]+i[1]*r[8]+i[2]*r[13]+i[3]*r[18],t[4]=i[0]*r[4]+i[1]*r[9]+i[2]*r[14]+i[3]*r[19]+i[4],t[5]=i[5]*r[0]+i[6]*r[5]+i[7]*r[10]+i[8]*r[15],t[6]=i[5]*r[1]+i[6]*r[6]+i[7]*r[11]+i[8]*r[16],t[7]=i[5]*r[2]+i[6]*r[7]+i[7]*r[12]+i[8]*r[17],t[8]=i[5]*r[3]+i[6]*r[8]+i[7]*r[13]+i[8]*r[18],t[9]=i[5]*r[4]+i[6]*r[9]+i[7]*r[14]+i[8]*r[19]+i[9],t[10]=i[10]*r[0]+i[11]*r[5]+i[12]*r[10]+i[13]*r[15],t[11]=i[10]*r[1]+i[11]*r[6]+i[12]*r[11]+i[13]*r[16],t[12]=i[10]*r[2]+i[11]*r[7]+i[12]*r[12]+i[13]*r[17],t[13]=i[10]*r[3]+i[11]*r[8]+i[12]*r[13]+i[13]*r[18],t[14]=i[10]*r[4]+i[11]*r[9]+i[12]*r[14]+i[13]*r[19]+i[14],t[15]=i[15]*r[0]+i[16]*r[5]+i[17]*r[10]+i[18]*r[15],t[16]=i[15]*r[1]+i[16]*r[6]+i[17]*r[11]+i[18]*r[16],t[17]=i[15]*r[2]+i[16]*r[7]+i[17]*r[12]+i[18]*r[17],t[18]=i[15]*r[3]+i[16]*r[8]+i[17]*r[13]+i[18]*r[18],t[19]=i[15]*r[4]+i[16]*r[9]+i[17]*r[14]+i[18]*r[19]+i[19],t}_colorMatrix(t){const i=new Float32Array(t);return i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255,i}brightness(t,i){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,i)}tint(t,i){const r=t>>16&255,s=t>>8&255,n=t&255,a=[r/255,0,0,0,0,0,s/255,0,0,0,0,0,n/255,0,0,0,0,0,1,0];this._loadMatrix(a,i)}greyscale(t,i){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,i)}blackAndWhite(t){const i=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(i,t)}hue(t,i){t=(t||0)/180*Math.PI;const r=Math.cos(t),s=Math.sin(t),n=Math.sqrt,a=1/3,o=n(a),h=r+(1-r)*a,l=a*(1-r)-o*s,c=a*(1-r)+o*s,u=a*(1-r)+o*s,d=r+a*(1-r),f=a*(1-r)-o*s,p=a*(1-r)-o*s,m=a*(1-r)+o*s,g=r+a*(1-r),y=[h,l,c,0,0,u,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,i)}contrast(t,i){const r=(t||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,i)}saturate(t=0,i){const r=t*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,i)}desaturate(){this.saturate(-1)}negative(t){const i=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(i,t)}sepia(t){const i=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(i,t)}technicolor(t){const i=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(i,t)}polaroid(t){const i=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(i,t)}toBGR(t){const i=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(i,t)}kodachrome(t){const i=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(i,t)}browni(t){const i=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(i,t)}vintage(t){const i=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(i,t)}colorTone(t,i,r,s,n){t=t||.2,i=i||.15,r=r||16770432,s=s||3375104;const a=(r>>16&255)/255,o=(r>>8&255)/255,h=(r&255)/255,l=(s>>16&255)/255,c=(s>>8&255)/255,u=(s&255)/255,d=[.3,.59,.11,0,0,a,o,h,t,0,l,c,u,i,0,a-l,o-c,h-u,0,0];this._loadMatrix(d,n)}night(t,i){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,i)}predator(t,i){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,i)}lsd(t){const i=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(i,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}tn.prototype.grayscale=tn.prototype.greyscale;var ip=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,rp=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class sp extends At{constructor(t,i){const r=new nt;t.renderable=!1,super(rp,ip,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,i==null&&(i=20),this.scale=new q(i,i)}apply(t,i,r,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,a=Math.sqrt(n.a*n.a+n.b*n.b),o=Math.sqrt(n.c*n.c+n.d*n.d);a!==0&&o!==0&&(this.uniforms.rotation[0]=n.a/a,this.uniforms.rotation[1]=n.b/a,this.uniforms.rotation[2]=n.c/o,this.uniforms.rotation[3]=n.d/o),t.applyFilter(this,i,r,s)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var np=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,ap=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class op extends At{constructor(){super(ap,np)}}var hp=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class lp extends At{constructor(t=.5,i=Math.random()){super($o,hp,{uNoise:0,uSeed:0}),this.noise=t,this.seed=i}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const ma={AlphaFilter:Yf,BlurFilter:tp,BlurFilterPass:Qs,ColorMatrixFilter:tn,DisplacementFilter:sp,FXAAFilter:op,NoiseFilter:lp};Object.entries(ma).forEach(([e,t])=>{Object.defineProperty(ma,e,{get(){return K("7.1.0",`filters.${e} has moved to ${e}`),t}})});class zi{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=zi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new q,this.page=new q,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,i,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,i,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Dr extends zi{constructor(){super(...arguments),this.client=new q,this.movement=new q,this.offset=new q,this.global=new q,this.screen=new q}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,i,r,s,n,a,o,h,l,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class zt extends Dr{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class en extends Dr{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const cp=2048,up=new q,vs=new q;class dp{constructor(t){this.dispatch=new Oe,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,i){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:i,priority:0}),this.mappingTable[t].sort((r,s)=>r.priority-s.priority)}dispatchEvent(t,i){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,i),this.dispatch.emit(i||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const i=this.mappingTable[t.type];if(i)for(let r=0,s=i.length;r<s;r++)i[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,i){const r=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,up.set(t,i),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,i){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(t.currentTarget=r[s],this.notifyTarget(t,i),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,i),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(t.currentTarget=r[s],this.notifyTarget(t,i),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,i,r=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const s=r.children;if(s)for(let n=0;n<s.length;n++)this.all(t,i,s[n]);t.currentTarget=r,this.notifyTarget(t,i)}propagationPath(t){const i=[t];for(let r=0;r<cp&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(t.parent),t=t.parent}return i.reverse(),i}hitTestRecursive(t,i,r,s,n){if(!t||!t.visible||n(t,r))return null;if(t.interactiveChildren&&t.children){const a=t.children;for(let o=a.length-1;o>=0;o--){const h=a[o],l=this.hitTestRecursive(h,i||h.interactive,r,s,n);if(l){if(l.length>0&&!l[l.length-1].parent)continue;return(l.length>0||t.interactive)&&l.push(t),l}}}return i&&s(t,r)?t.interactive?[t]:[]:null}hitPruneFn(t,i){var r;if(t.hitArea&&(t.worldTransform.applyInverse(i,vs),!t.hitArea.contains(vs.x,vs.y)))return!0;if(t._mask){const s=t._mask.isMaskData?t._mask.maskObject:t._mask;if(s&&!((r=s.containsPoint)!=null&&r.call(s,i)))return!0}return!1}hitTestFn(t,i){return t.hitArea?!0:t.containsPoint?t.containsPoint(i):!1}notifyTarget(t,i){var n,a;i=i??t.type;const r=`on${i}`;(a=(n=t.currentTarget)[r])==null||a.call(n,t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${i}capture`:i;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,i)}mapPointerDown(t){if(!(t instanceof zt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerdown"),i.pointerType==="touch")this.dispatchEvent(i,"touchstart");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const s=i.button===2;this.dispatchEvent(i,s?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)}mapPointerMove(t){var o,h;if(!(t instanceof zt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.createPointerEvent(t),r=i.pointerType==="mouse"||i.pointerType==="pen",s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.overTargets);if(((o=s.overTargets)==null?void 0:o.length)>0&&n!==i.target){const l=t.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(t,l,n);if(this.dispatchEvent(c,"pointerout"),r&&this.dispatchEvent(c,"mouseout"),!i.composedPath().includes(n)){const u=this.createPointerEvent(t,"pointerleave",n);for(u.eventPhase=u.AT_TARGET;u.target&&!i.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(c)}if(n!==i.target){const l=t.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(i,l);this.dispatchEvent(c,"pointerover"),r&&this.dispatchEvent(c,"mouseover");let u=n==null?void 0:n.parent;for(;u&&u!==this.rootTarget.parent&&u!==i.target;)u=u.parent;if(!u||u===this.rootTarget.parent){const f=this.clonePointerEvent(i,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==n&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const a=this.moveOnAll?"all":"dispatchEvent";this[a](i,"pointermove"),this.all(i,"globalpointermove"),i.pointerType==="touch"&&(this[a](i,"touchmove"),this.all(i,"globaltouchmove")),r&&(this[a](i,"mousemove"),this.all(i,"globalmousemove"),this.cursor=(h=i.target)==null?void 0:h.cursor),s.overTargets=i.composedPath(),this.freeEvent(i)}mapPointerOver(t){var a;if(!(t instanceof zt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(t.pointerId),r=this.createPointerEvent(t),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(a=r.target)==null?void 0:a.cursor);const n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;i.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof zt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(t.pointerId);if(i.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",s=this.findMountedTarget(i.overTargets),n=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");const a=this.createPointerEvent(t,"pointerleave",s);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),r&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;i.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof zt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const o=r.button===2;this.dispatchEvent(r,o?"rightup":"mouseup")}const s=this.trackingData(t.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[t.button]);let a=n;if(n&&!r.composedPath().includes(n)){let o=n;for(;o&&!r.composedPath().includes(o);){if(r.currentTarget=o,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.notifyTarget(r,h?"rightupoutside":"mouseupoutside")}o=o.parent}delete s.pressTargetsByButton[t.button],a=o}if(a){const o=this.clonePointerEvent(r,"click");o.target=a,o.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:i});const h=s.clicksByButton[t.button];h.target===o.target&&i-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=o.target,h.timeStamp=i,o.detail=h.clickCount,o.pointerType==="mouse"?this.dispatchEvent(o,"click"):o.pointerType==="touch"&&this.dispatchEvent(o,"tap"),this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof zt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(t.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof en)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const i=this.createWheelEvent(t);this.dispatchEvent(i),this.freeEvent(i)}findMountedTarget(t){if(!t)return null;let i=t[0];for(let r=1;r<t.length&&t[r].parent===i;r++)i=t[r];return i}createPointerEvent(t,i,r){const s=this.allocateEvent(zt);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=r??this.hitTest(s.global.x,s.global.y),typeof i=="string"&&(s.type=i),s}createWheelEvent(t){const i=this.allocateEvent(en);return this.copyWheelData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.nativeEvent=t.nativeEvent,i.originalEvent=t,i.target=this.hitTest(i.global.x,i.global.y),i}clonePointerEvent(t,i){const r=this.allocateEvent(zt);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=i??r.type,r}copyWheelData(t,i){i.deltaMode=t.deltaMode,i.deltaX=t.deltaX,i.deltaY=t.deltaY,i.deltaZ=t.deltaZ}copyPointerData(t,i){t instanceof zt&&i instanceof zt&&(i.pointerId=t.pointerId,i.width=t.width,i.height=t.height,i.isPrimary=t.isPrimary,i.pointerType=t.pointerType,i.pressure=t.pressure,i.tangentialPressure=t.tangentialPressure,i.tiltX=t.tiltX,i.tiltY=t.tiltY,i.twist=t.twist)}copyMouseData(t,i){t instanceof Dr&&i instanceof Dr&&(i.altKey=t.altKey,i.button=t.button,i.buttons=t.buttons,i.client.copyFrom(t.client),i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.movement.copyFrom(t.movement),i.screen.copyFrom(t.screen),i.global.copyFrom(t.global))}copyData(t,i){i.isTrusted=t.isTrusted,i.srcElement=t.srcElement,i.timeStamp=performance.now(),i.type=t.type,i.detail=t.detail,i.view=t.view,i.which=t.which,i.layer.copyFrom(t.layer),i.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const i=this.eventPool.get(t).pop()||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=null,i.target=null,i}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),this.eventPool.get(i).push(t)}notifyListeners(t,i){const r=t.currentTarget._events[i];if(r)if("fn"in r)r.fn.call(r.context,t);else for(let s=0,n=r.length;s<n&&!t.propagationImmediatelyStopped;s++)r[s].fn.call(r[s].context,t)}}const fp=1,pp={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Qo{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new dp(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new zt(null),this.rootWheelEvent=new en(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let i=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(i=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":i&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":i&&Object.assign(this.domElement.style,r);break}else i&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const i=this.normalizeToPointerData(t);this.autoPreventDefault&&i[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,s=i.length;r<s;r++){const n=i[r],a=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const i=this.normalizeToPointerData(t);for(let r=0,s=i.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,i[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let i=t.target;t.composedPath&&t.composedPath().length>0&&(i=t.composedPath()[0]);const r=i!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let n=0,a=s.length;n<a;n++){const o=this.bootstrapEvent(this.rootPointerEvent,s[n]);o.type+=r,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const i=this.normalizeToPointerData(t);for(let r=0,s=i.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,i[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const i=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(i)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,i,r){let s;this.domElement.parentElement?s=this.domElement.getBoundingClientRect():s={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;t.x=(i-s.left)*(this.domElement.width/s.width)*n,t.y=(r-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(t){const i=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,s=t.changedTouches.length;r<s;r++){const n=t.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,i.push(n)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=fp),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,i.push(r)}else i.push(t);return i}normalizeWheelEvent(t){const i=this.rootWheelEvent;return this.transferMouseData(i,t),i.deltaX=t.deltaX,i.deltaY=t.deltaY,i.deltaZ=t.deltaZ,i.deltaMode=t.deltaMode,this.mapPositionToPoint(i.screen,t.clientX,t.clientY),i.global.copyFrom(i.screen),i.offset.copyFrom(i.screen),i.nativeEvent=t,i.type=t.type,i}bootstrapEvent(t,i){return t.originalEvent=null,t.nativeEvent=i,t.pointerId=i.pointerId,t.width=i.width,t.height=i.height,t.isPrimary=i.isPrimary,t.pointerType=i.pointerType,t.pressure=i.pressure,t.tangentialPressure=i.tangentialPressure,t.tiltX=i.tiltX,t.tiltY=i.tiltY,t.twist=i.twist,this.transferMouseData(t,i),this.mapPositionToPoint(t.screen,i.clientX,i.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=i.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=pp[t.type]||t.type),t}transferMouseData(t,i){t.isTrusted=i.isTrusted,t.srcElement=i.srcElement,t.timeStamp=performance.now(),t.type=i.type,t.altKey=i.altKey,t.button=i.button,t.buttons=i.buttons,t.client.x=i.clientX,t.client.y=i.clientY,t.ctrlKey=i.ctrlKey,t.metaKey=i.metaKey,t.movement.x=i.movementX,t.movement.y=i.movementY,t.page.x=i.pageX,t.page.y=i.pageY,t.relatedTarget=null,t.shiftKey=i.shiftKey}}Qo.extension={name:"events",type:[B.RendererSystem,B.CanvasRendererSystem]};G.add(Qo);const mp={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(e,t,i){const r=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,s=typeof t=="function"?void 0:t;e=r?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.on(e,t,s)},removeEventListener(e,t,i){const r=typeof i=="boolean"&&i||typeof i=="object"&&i.capture,s=typeof t=="function"?void 0:t;e=r?`${e}capture`:e,t=typeof t=="function"?t:t.handleEvent,this.off(e,t,s)},dispatchEvent(e){if(!(e instanceof zi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};ct.mixin(mp);const gp={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ct.mixin(gp);const vp=9,sr=100,yp=0,_p=0,ga=2,va=1,xp=-1e3,bp=-1e3,Ep=2;class th{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(pe.tablet||pe.phone)&&this.createTouchHook();const i=document.createElement("div");i.style.width=`${sr}px`,i.style.height=`${sr}px`,i.style.position="absolute",i.style.top=`${yp}px`,i.style.left=`${_p}px`,i.style.zIndex=ga.toString(),this.div=i,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${va}px`,t.style.height=`${va}px`,t.style.position="absolute",t.style.top=`${xp}px`,t.style.left=`${bp}px`,t.style.zIndex=Ep.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const i=t.children;if(i)for(let r=0;r<i.length;r++)this.updateAccessibleObjects(i[r])}update(){const t=performance.now();if(pe.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:i,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:h}=this.renderer,l=s/a*h,c=n/o*h;let u=this.div;u.style.left=`${i}px`,u.style.top=`${r}px`,u.style.width=`${a}px`,u.style.height=`${o}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,ri(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(u.style.left=`${(m.tx+p.x*m.a)*l}px`,u.style.top=`${(m.ty+p.y*m.d)*c}px`,u.style.width=`${p.width*m.a*l}px`,u.style.height=`${p.height*m.d*c}px`):(p=f.getBounds(),this.capHitArea(p),u.style.left=`${p.x*l}px`,u.style.top=`${p.y*c}px`,u.style.width=`${p.width*l}px`,u.style.height=`${p.height*c}px`,u.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:i,height:r}=this.renderer;t.x+t.width>i&&(t.width=i-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let i=this.pool.pop();i||(i=document.createElement("button"),i.style.width=`${sr}px`,i.style.height=`${sr}px`,i.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",i.style.position="absolute",i.style.zIndex=ga.toString(),i.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?i.setAttribute("aria-live","off"):i.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?i.setAttribute("aria-relevant","additions"):i.setAttribute("aria-relevant","text"),i.addEventListener("click",this._onClick.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),i.addEventListener("focusout",this._onFocusOut.bind(this))),i.style.pointerEvents=t.accessiblePointerEvents,i.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?i.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(i.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&i.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(i),t._accessibleActive=!0,t._accessibleDiv=i,i.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,i){const{displayObject:r}=t.target,s=this.renderer.events.rootBoundary,n=Object.assign(new zi(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,i.forEach(a=>s.dispatchEvent(n,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===vp&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}th.extension={name:"accessibility",type:[B.RendererPlugin,B.CanvasRendererPlugin]};G.add(th);const rn=class{constructor(e){this.stage=new Gt,e=Object.assign({forceCanvas:!1},e),this.renderer=Nf(e),rn._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const i=rn._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let Cn=rn;Cn._plugins=[];G.handleByList(B.Application,Cn._plugins);class eh{static init(t){Object.defineProperty(this,"resizeTo",{set(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let i,r;if(this._resizeTo===globalThis.window)i=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;i=s,r=n}this.renderer.resize(i,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}eh.extension=B.Application;G.add(eh);const ya={loader:B.LoadParser,resolver:B.ResolveParser,cache:B.CacheParser,detection:B.DetectionParser};G.handle(B.Asset,e=>{const t=e.ref;Object.entries(ya).filter(([i])=>!!t[i]).forEach(([i,r])=>G.add(Object.assign(t[i],{extension:t[i].extension??r})))},e=>{const t=e.ref;Object.keys(ya).filter(i=>!!t[i]).forEach(i=>G.remove(t[i]))});class Tp{constructor(t,i=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=i}add(t){t.forEach(i=>{this._assetList.push(i)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],i=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<i;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function ih(e,t){if(Array.isArray(t)){for(const i of t)if(e.startsWith(`data:${i}`))return!0;return!1}return e.startsWith(`data:${t}`)}function Yr(e,t){const i=e.split("?")[0],r=Ct.extname(i).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const me=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(i=>typeof i=="string"?t(i):i):e),sn=(e,t)=>{const i=t.split("?")[1];return i&&(e+=`?${i}`),e};function rh(e,t,i,r,s){const n=t[i];for(let a=0;a<n.length;a++){const o=n[a];i<t.length-1?rh(e.replace(r[i],o),t,i+1,r,s):s.push(e.replace(r[i],o))}}function wp(e){const t=/\{(.*?)\}/g,i=e.match(t),r=[];if(i){const s=[];i.forEach(n=>{const a=n.substring(1,n.length-1).split(",");s.push(a)}),rh(e,s,0,i,r)}else r.push(e);return r}const Br=e=>!Array.isArray(e);class Sp{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const i=this._cache.get(t);return i||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),i}set(t,i){const r=me(t);let s;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.test(i)){s=h.getCacheableAssets(r,i);break}}s||(s={},r.forEach(o=>{s[o]=i}));const n=Object.keys(s),a={cacheKeys:n,keys:r};if(r.forEach(o=>{this._cacheMap.set(o,a)}),n.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==i&&console.warn("[Cache] already has key:",o),this._cache.set(o,s[o])}),i instanceof k){const o=i;r.forEach(h=>{o.baseTexture!==k.EMPTY.baseTexture&&z.addToCache(o.baseTexture,h),k.addToCache(o,h)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const i=this._cacheMap.get(t);i.cacheKeys.forEach(s=>{this._cache.delete(s)}),i.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}}const vi=new Sp;class Ap{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,i){const r={promise:null,parser:null};return r.promise=(async()=>{var n,a;let s=null;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.load&&((n=h.test)!=null&&n.call(h,t,i,this))){s=await h.load(t,i,this),r.parser=h;break}}if(!r.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];h.parse&&h.parse&&await((a=h.testParse)==null?void 0:a.call(h,s,i,this))&&(s=await h.parse(s,i,this)||s,r.parser=h)}return s})(),r}async load(t,i){let r=0;const s={},n=Br(t),a=me(t,l=>({src:l})),o=a.length,h=a.map(async l=>{const c=Ct.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),s[l.src]=await this.promiseCache[c].promise,i&&i(++r/o)}catch(u){throw delete this.promiseCache[c],delete s[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?s[a[0].src]:s}async unload(t){const r=me(t,s=>({src:s})).map(async s=>{var o,h;const n=Ct.toAbsolute(s.src),a=this.promiseCache[n];if(a){const l=await a.promise;(h=(o=a.parser)==null?void 0:o.unload)==null||h.call(o,l,s,this),delete this.promiseCache[n]}});await Promise.all(r)}get parsers(){return this._parsers}}var ce=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(ce||{});const Cp={extension:{type:B.LoadParser,priority:ce.Low},test(e){return Ct.extname(e).toLowerCase()===".json"},async load(e){return await(await N.ADAPTER.fetch(e)).json()}};G.add(Cp);const Ip={extension:{type:B.LoadParser,priority:ce.Low},test(e){return Ct.extname(e).toLowerCase()===".txt"},async load(e){return await(await N.ADAPTER.fetch(e)).text()}};G.add(Ip);const Rp=["normal","bold","100","200","300","400","500","600","700","800","900"],Pp=[".ttf",".otf",".woff",".woff2"],Mp=["font/ttf","font/otf","font/woff","font/woff2"];function Dp(e){const t=Ct.extname(e);return Ct.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}const Bp={extension:{type:B.LoadParser,priority:ce.Low},test(e){return ih(e,Mp)||Yr(e,Pp)},async load(e,t){var r,s,n;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const i=N.ADAPTER.getFontFaceSet();if(i){const a=[],o=((r=t.data)==null?void 0:r.family)??Dp(e),h=((n=(s=t.data)==null?void 0:s.weights)==null?void 0:n.filter(c=>Rp.includes(c)))??["normal"],l=t.data??{};for(let c=0;c<h.length;c++){const u=h[c],d=new FontFace(o,`url(${encodeURI(e)})`,{...l,weight:u});await d.load(),i.add(d),a.push(d)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>N.ADAPTER.getFontFaceSet().delete(t))}};G.add(Bp);let _a=0,ys;const Fp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",Np={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Fp}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Op={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let _s;class Lp{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const i=URL.createObjectURL(new Blob([Np.code],{type:"application/javascript"})),r=new Worker(i);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(i),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){ys===void 0&&(ys=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<ys&&(_s||(_s=URL.createObjectURL(new Blob([Op.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(_s),t.addEventListener("message",i=>{this.complete(i.data),this.returnWorker(i.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,i){await this._initWorkers();const r=new Promise((s,n)=>{this.queue.push({id:t,arguments:i,resolve:s,reject:n})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const i=this.queue.pop(),r=i.id;this.resolveHash[_a]={resolve:i.resolve,reject:i.reject},t.postMessage({data:i.arguments,uuid:_a++,id:r})}}const xa=new Lp;function qr(e,t,i){const r=new k(e);return r.baseTexture.on("dispose",()=>{delete t.promiseCache[i]}),r}const Up=[".jpeg",".jpg",".png",".webp",".avif"],kp=["image/jpeg","image/png","image/webp","image/avif"];async function Gp(e){const t=await N.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const i=await t.blob();return await createImageBitmap(i)}const Li={extension:{type:B.LoadParser,priority:ce.High},config:{preferWorkers:!0},test(e){return ih(e,kp)||Yr(e,Up)},async load(e,t,i){let r=null;globalThis.createImageBitmap?this.config.preferWorkers&&await xa.isImageBitmapSupported()?r=await xa.loadImageBitmap(e):r=await Gp(e):r=await new Promise(n=>{r=new Image,r.crossOrigin="anonymous",r.src=e,r.complete?n(r):r.onload=()=>{n(r)}});const s=new z(r,{resolution:Te(e),...t.data});return s.resource.src=e,qr(s,i,e)},unload(e){e.destroy(!0)}};G.add(Li);const Hp={extension:{type:B.LoadParser,priority:ce.High},test(e){return Ct.extname(e).toLowerCase()===".svg"},async testParse(e){return Oi.test(e)},async parse(e,t,i){var a,o,h;const r=new Oi(e,(a=t==null?void 0:t.data)==null?void 0:a.resourceOptions),s=new z(r,{resolution:Te(e),...t==null?void 0:t.data});s.resource.src=e;const n=qr(s,i,e);return(h=(o=t==null?void 0:t.data)==null?void 0:o.resourceOptions)!=null&&h.autoLoad||await r.load(),n},async load(e,t){return(await N.ADAPTER.fetch(e)).text()},unload:Li.unload};G.add(Hp);class Xp{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,i)=>`${t}${this._bundleIdConnector}${i}`,this._extractAssetIdFromBundle=(t,i)=>i.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(i=>{this._preferredOrder.push(i),i.priority||(i.priority=Object.keys(i.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const i=t;this._defaultSearchParams=Object.keys(i).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(i[r])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(i=>{this.addBundle(i.name,i.assets)})}addBundle(t,i){const r=[];Array.isArray(i)?i.forEach(s=>{if(typeof s.name=="string"){const n=this._createBundleAssetId(t,s.name);r.push(n),this.add([s.name,n],s.srcs,s.data)}else{const n=s.name.map(a=>this._createBundleAssetId(t,a));n.forEach(a=>{r.push(a)}),this.add([...s.name,...n],s.srcs)}}):Object.keys(i).forEach(s=>{r.push(this._createBundleAssetId(t,s)),this.add([s,this._createBundleAssetId(t,s)],i[s])}),this._bundles[t]=r}add(t,i,r){const s=me(t);s.forEach(a=>{this._assetMap[a]&&console.warn(`[Resolver] already has key: ${a} overwriting`)}),Array.isArray(i)||(typeof i=="string"?i=wp(i):i=[i]);const n=i.map(a=>{let o=a;if(typeof a=="string"){let h=!1;for(let l=0;l<this._parsers.length;l++){const c=this._parsers[l];if(c.test(a)){o=c.parse(a),h=!0;break}}h||(o={src:a})}return o.format||(o.format=o.src.split(".").pop()),o.alias||(o.alias=s),(this._basePath||this._rootPath)&&(o.src=Ct.toAbsolute(o.src,this._basePath,this._rootPath)),o.src=this._appendDefaultSearchParams(o.src),o.data=o.data??r,o});s.forEach(a=>{this._assetMap[a]=n})}resolveBundle(t){const i=Br(t);t=me(t);const r={};return t.forEach(s=>{const n=this._bundles[s];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(s,h)]=l}r[s]=o}}),i?r[t[0]]:r}resolveUrl(t){const i=this.resolve(t);if(typeof t!="string"){const r={};for(const s in i)r[s]=i[s].src;return r}return i.src}resolve(t){const i=Br(t);t=me(t);const r={};return t.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s];const a=this._getPreferredOrder(n),o=n[0];a==null||a.priority.forEach(h=>{a.params[h].forEach(l=>{const c=n.filter(u=>u[h]?u[h]===l:!1);c.length&&(n=c)})}),this._resolverHash[s]=n[0]??o}else{let n=s;(this._basePath||this._rootPath)&&(n=Ct.toAbsolute(n,this._basePath,this._rootPath)),n=this._appendDefaultSearchParams(n),this._resolverHash[s]={src:n}}r[s]=this._resolverHash[s]}),i?r[t[0]]:r}_getPreferredOrder(t){for(let i=0;i<t.length;i++){const r=t[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const i=/\?/.test(t)?"&":"?";return`${t}${i}${this._defaultSearchParams}`}}class jp{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Xp,this.loader=new Ap,this.cache=vi,this._backgroundLoader=new Tp(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,a,o;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const i=((n=t.texturePreference)==null?void 0:n.resolution)??1,r=typeof i=="number"?[i]:i;let s=[];if((a=t.texturePreference)!=null&&a.format){const h=(o=t.texturePreference)==null?void 0:o.format;s=typeof h=="string"?[h]:h;for(const l of this._detections)await l.test()||(s=await l.remove(s))}else for(const h of this._detections)await h.test()&&(s=await h.add(s));this.resolver.prefer({params:{format:s,resolution:r}})}add(t,i,r){this.resolver.add(t,i,r)}async load(t,i){this._initialized||await this.init();const r=Br(t),s=me(t).map(o=>typeof o!="string"?(this.resolver.add(o.src,o),o.src):o),n=this.resolver.resolve(s),a=await this._mapLoadToResolve(n,i);return r?a[s[0]]:a}addBundle(t,i){this.resolver.addBundle(t,i)}async loadBundle(t,i){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const s=this.resolver.resolveBundle(t),n={},a=Object.keys(s);let o=0,h=0;const l=()=>{i==null||i(++o/h)},c=a.map(u=>{const d=s[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{n[u]=f})});return await Promise.all(c),r?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const i=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(i))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const i=this.resolver.resolveBundle(t);Object.values(i).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return vi.get(t);const i={};for(let r=0;r<t.length;r++)i[r]=vi.get(t[r]);return i}async _mapLoadToResolve(t,i){const r=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(r,i);this._backgroundLoader.active=!0;const a={};return r.forEach((o,h)=>{const l=n[o.src],c=[o.src];o.alias&&c.push(...o.alias),a[s[h]]=l,vi.set(c,l)}),a}async unload(t){this._initialized||await this.init();const i=me(t).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(i);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=me(t);const i=this.resolver.resolveBundle(t),r=Object.keys(i).map(s=>this._unloadFromResolved(i[s]));await Promise.all(r)}async _unloadFromResolved(t){const i=Object.values(t);i.forEach(r=>{vi.remove(r.src)}),await this.loader.unload(i)}get detections(){return this._detections}get preferWorkers(){return Li.config.preferWorkers}set preferWorkers(t){Li.config.preferWorkers=t}}const nr=new jp;G.handleByList(B.LoadParser,nr.loader.parsers).handleByList(B.ResolveParser,nr.resolver.parsers).handleByList(B.CacheParser,nr.cache.parsers).handleByList(B.DetectionParser,nr.detections);const zp={extension:B.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof k),getCacheableAssets:(e,t)=>{const i={};return e.forEach(r=>{t.forEach((s,n)=>{i[r+(n===0?"":n+1)]=s})}),i}};G.add(zp);const Vp={extension:{type:B.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await N.ADAPTER.fetch(e).then(i=>i.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};G.add(Vp);const $p={extension:{type:B.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await N.ADAPTER.fetch(e).then(i=>i.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};G.add($p);const ba=["png","jpg","jpeg"],Wp={extension:{type:B.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...ba],remove:async e=>e.filter(t=>!ba.includes(t))};G.add(Wp);const Yp={extension:B.ResolveParser,test:Li.test,parse:e=>{var t;return{resolution:parseFloat(((t=N.RETINA_PREFIX.exec(e))==null?void 0:t[1])??"1"),format:e.split(".").pop(),src:e}}};G.add(Yp);var Lt=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(Lt||{});const Fr={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};let de,Ke;function Ea(){Ke={s3tc:de.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:de.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:de.getExtension("WEBGL_compressed_texture_etc"),etc1:de.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:de.getExtension("WEBGL_compressed_texture_pvrtc")||de.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:de.getExtension("WEBGL_compressed_texture_atc"),astc:de.getExtension("WEBGL_compressed_texture_astc")}}const qp={extension:{type:B.DetectionParser,priority:2},test:async()=>{const t=N.ADAPTER.createCanvas().getContext("webgl");return t?(de=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{Ke||Ea();const t=[];for(const i in Ke)Ke[i]&&t.push(i);return[...t,...e]},remove:async e=>(Ke||Ea(),e.filter(t=>!(t in Ke)))};G.add(qp);class Kp extends ji{constructor(t,i={width:1,height:1,autoLoad:!0}){let r,s;typeof t=="string"?(r=t,s=new Uint8Array):(r=null,s=t),super(s,i),this.origin=r,this.buffer=s?new js(s):null,this.origin&&i.autoLoad!==!1&&this.load(),s!=null&&s.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const r=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(r),this.buffer=new js(r),this.loaded=!0,this.onBlobLoaded(r),this.update(),this}}class Ne extends Kp{constructor(t,i){super(t,i),this.format=i.format,this.levels=i.levels||1,this._width=i.width,this._height=i.height,this._extension=Ne._formatToExtension(this.format),(i.levelBuffers||this.buffer)&&(this._levelBuffers=i.levelBuffers||Ne._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,i,r){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,o=this.levels;a<o;a++){const{levelID:h,levelWidth:l,levelHeight:c,levelBuffer:u}=this._levelBuffers[a];s.compressedTexImage2D(s.TEXTURE_2D,h,this.format,l,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Ne._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,i,r,s,n,a,o){const h=new Array(r);let l=t.byteOffset,c=a,u=o,d=c+s-1&~(s-1),f=u+n-1&~(n-1),p=d*f*Fr[i];for(let m=0;m<r;m++)h[m]={levelID:m,levelWidth:r>1?c:d,levelHeight:r>1?u:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),f=u+n-1&~(n-1),p=d*f*Fr[i];return h}}const xs=4,ar=124,Zp=32,Ta=20,Jp=542327876,or={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Qp={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},hr={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},tm=1,em=2,im=4,rm=64,sm=512,nm=131072,am=827611204,om=861165636,hm=894720068,lm=808540228,cm=4,um={[am]:Lt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[om]:Lt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[hm]:Lt.COMPRESSED_RGBA_S3TC_DXT5_EXT},dm={[70]:Lt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Lt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Lt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Lt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Lt.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Lt.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Lt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Lt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Lt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function fm(e){const t=new Uint32Array(e);if(t[0]!==Jp)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(e,0,ar/Uint32Array.BYTES_PER_ELEMENT),s=r[or.HEIGHT],n=r[or.WIDTH],a=r[or.MIPMAP_COUNT],o=new Uint32Array(e,or.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Zp/Uint32Array.BYTES_PER_ELEMENT),h=o[tm];if(h&im){const l=o[Qp.FOURCC];if(l!==lm){const v=um[l],x=xs+ar,T=new Uint8Array(e,x);return[new Ne(T,{format:v,width:n,height:s,levels:a})]}const c=xs+ar,u=new Uint32Array(t.buffer,c,Ta/Uint32Array.BYTES_PER_ELEMENT),d=u[hr.DXGI_FORMAT],f=u[hr.RESOURCE_DIMENSION],p=u[hr.MISC_FLAG],m=u[hr.ARRAY_SIZE],g=dm[d];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===cm)throw new Error("DDSParser does not support cubemap textures");if(f===6)throw new Error("DDSParser does not supported 3D texture data");const y=new Array,_=xs+ar+Ta;if(m===1)y.push(new Uint8Array(e,_));else{const v=Fr[g];let x=0,T=n,C=s;for(let w=0;w<a;w++){const M=Math.max(1,T+3&-4),F=Math.max(1,C+3&-4),b=M*F*v;x+=b,T=T>>>1,C=C>>>1}let A=_;for(let w=0;w<m;w++)y.push(new Uint8Array(e,A,x)),A+=x}return y.map(v=>new Ne(v,{format:g,width:n,height:s,levels:a}))}throw h&rm?new Error("DDSParser does not support uncompressed texture data."):h&sm?new Error("DDSParser does not supported YUV uncompressed texture data."):h&nm?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&em?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const wa=[171,75,84,88,32,49,49,187,13,10,26,10],pm=67305985,Xt={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},nn=64,Sa={[H.UNSIGNED_BYTE]:1,[H.UNSIGNED_SHORT]:2,[H.INT]:4,[H.UNSIGNED_INT]:4,[H.FLOAT]:4,[H.HALF_FLOAT]:8},mm={[P.RGBA]:4,[P.RGB]:3,[P.RG]:2,[P.RED]:1,[P.LUMINANCE]:1,[P.LUMINANCE_ALPHA]:2,[P.ALPHA]:1},gm={[H.UNSIGNED_SHORT_4_4_4_4]:2,[H.UNSIGNED_SHORT_5_5_5_1]:2,[H.UNSIGNED_SHORT_5_6_5]:2};function vm(e,t,i=!1){const r=new DataView(t);if(!ym(e,r))return null;const s=r.getUint32(Xt.ENDIANNESS,!0)===pm,n=r.getUint32(Xt.GL_TYPE,s),a=r.getUint32(Xt.GL_FORMAT,s),o=r.getUint32(Xt.GL_INTERNAL_FORMAT,s),h=r.getUint32(Xt.PIXEL_WIDTH,s),l=r.getUint32(Xt.PIXEL_HEIGHT,s)||1,c=r.getUint32(Xt.PIXEL_DEPTH,s)||1,u=r.getUint32(Xt.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=r.getUint32(Xt.NUMBER_OF_FACES,s),f=r.getUint32(Xt.NUMBER_OF_MIPMAP_LEVELS,s),p=r.getUint32(Xt.BYTES_OF_KEY_VALUE_DATA,s);if(l===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,y=h+3&-4,_=l+3&-4,v=new Array(u);let x=h*l;n===0&&(x=y*_);let T;if(n!==0?Sa[n]?T=Sa[n]*mm[a]:T=gm[n]:T=Fr[o],T===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=i?xm(r,p,s):null;let w=x*T,M=h,F=l,b=y,R=_,S=nn+p;for(let E=0;E<f;E++){const j=r.getUint32(S,s);let $=S+4;for(let D=0;D<u;D++){let Z=v[D];Z||(Z=v[D]=new Array(f)),Z[E]={levelID:E,levelWidth:f>1||n!==0?M:b,levelHeight:f>1||n!==0?F:R,levelBuffer:new Uint8Array(t,$,w)},$+=w}S+=j+4,S=S%4!==0?S+4-S%4:S,M=M>>1||1,F=F>>1||1,b=M+m-1&~(m-1),R=F+g-1&~(g-1),w=b*R*T}return n!==0?{uncompressed:v.map(E=>{let j=E[0].levelBuffer,$=!1;return n===H.FLOAT?j=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):n===H.UNSIGNED_INT?($=!0,j=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):n===H.INT&&($=!0,j=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new ji(j,{width:E[0].levelWidth,height:E[0].levelHeight}),type:n,format:$?_m(a):a}}),kvData:C}:{compressed:v.map(E=>new Ne(null,{format:o,width:h,height:l,levels:f,levelBuffers:E})),kvData:C}}function ym(e,t){for(let i=0;i<wa.length;i++)if(t.getUint8(i)!==wa[i])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function _m(e){switch(e){case P.RGBA:return P.RGBA_INTEGER;case P.RGB:return P.RGB_INTEGER;case P.RG:return P.RG_INTEGER;case P.RED:return P.RED_INTEGER;default:return e}}function xm(e,t,i){const r=new Map;let s=0;for(;s<t;){const n=e.getUint32(nn+s,i),a=nn+s+4,o=3-(n+3)%4;if(n===0||n>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&e.getUint8(a+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(e.buffer,a,h)),c=new DataView(e.buffer,a+h+1,n-h-1);r.set(l,c),s+=4+n+o}return r}const bm={extension:{type:B.LoadParser,priority:ce.High},test(e){return Yr(e,".dds")},async load(e,t,i){const s=await(await N.ADAPTER.fetch(e)).arrayBuffer(),a=fm(s).map(o=>{const h=new z(o,{mipmap:le.OFF,alphaMode:Qt.NO_PREMULTIPLIED_ALPHA,resolution:Te(e),...t.data});return qr(h,i,e)});return a.length===1?a[0]:a},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};G.add(bm);const Em={extension:{type:B.LoadParser,priority:ce.High},test(e){return Yr(e,".ktx")},async load(e,t,i){const s=await(await N.ADAPTER.fetch(e)).arrayBuffer(),{compressed:n,uncompressed:a,kvData:o}=vm(e,s),h=n??a,l={mipmap:le.OFF,alphaMode:Qt.NO_PREMULTIPLIED_ALPHA,resolution:Te(e),...t.data},c=h.map(u=>{h===a&&Object.assign(l,{type:u.type,format:u.format});const d=new z(u,l);return d.ktxKeyValueData=o,qr(d,i,e)});return c.length===1?c[0]:c},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};G.add(Em);const Tm={extension:B.ResolveParser,test:e=>{const i=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(i)},parse:e=>{var r,s;if(e.split("?")[0].split(".").pop()==="ktx"){const n=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(n.some(a=>e.endsWith(a)))return{resolution:parseFloat(((r=N.RETINA_PREFIX.exec(e))==null?void 0:r[1])??"1"),format:n.find(a=>e.endsWith(a)),src:e}}return{resolution:parseFloat(((s=N.RETINA_PREFIX.exec(e))==null?void 0:s[1])??"1"),format:e.split(".").pop(),src:e}}};G.add(Tm);const Aa=new Y,Ca=4,an=class{constructor(e){this.renderer=e}async image(e,t,i){const r=new Image;return r.src=await this.base64(e,t,i),r}async base64(e,t,i){const r=this.canvas(e);if(r.toDataURL!==void 0)return r.toDataURL(t,i);if(r.convertToBlob!==void 0){const s=await r.convertToBlob({type:t,quality:i});return await new Promise(n=>{const a=new FileReader;a.onload=()=>n(a.result),a.readAsDataURL(s)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(e,t){const i=this.renderer;let r,s=!1,n,a=!1;e&&(e instanceof Ae?n=e:(n=this.renderer.generateTexture(e),a=!0)),n?(r=n.baseTexture.resolution,t=t??n.frame,s=!1,i.renderTexture.bind(n)):(r=i.resolution,t||(t=Aa,t.width=i.width,t.height=i.height),s=!0,i.renderTexture.bind(null));const o=Math.round(t.width*r),h=Math.round(t.height*r);let l=new ea(o,h,1);const c=new Uint8Array(Ca*o*h),u=i.gl;u.readPixels(Math.round(t.x*r),Math.round(t.y*r),o,h,u.RGBA,u.UNSIGNED_BYTE,c);const d=l.context.getImageData(0,0,o,h);if(an.arrayPostDivide(c,d.data),l.context.putImageData(d,0,0),s){const f=new ea(l.width,l.height,1);f.context.scale(1,-1),f.context.drawImage(l.canvas,0,-h),l.destroy(),l=f}return a&&n.destroy(!0),l.canvas}pixels(e,t){const i=this.renderer;let r,s,n=!1;e&&(e instanceof Ae?s=e:(s=this.renderer.generateTexture(e),n=!0)),s?(r=s.baseTexture.resolution,t=t??s.frame,i.renderTexture.bind(s)):(r=i.resolution,t||(t=Aa,t.width=i.width,t.height=i.height),i.renderTexture.bind(null));const a=Math.round(t.width*r),o=Math.round(t.height*r),h=new Uint8Array(Ca*a*o),l=i.gl;return l.readPixels(Math.round(t.x*r),Math.round(t.y*r),a,o,l.RGBA,l.UNSIGNED_BYTE,h),n&&s.destroy(!0),an.arrayPostDivide(h,h),h}destroy(){this.renderer=null}static arrayPostDivide(e,t){for(let i=0;i<e.length;i+=4){const r=t[i+3]=e[i+3];r!==0?(t[i]=Math.round(Math.min(e[i]*255/r,255)),t[i+1]=Math.round(Math.min(e[i+1]*255/r,255)),t[i+2]=Math.round(Math.min(e[i+2]*255/r,255))):(t[i]=e[i],t[i+1]=e[i+1],t[i+2]=e[i+2])}}};let sh=an;sh.extension={name:"extract",type:B.RendererSystem};G.add(sh);const Nr={build(e){const t=e.points;let i,r,s,n,a,o;if(e.type===St.CIRC){const p=e.shape;i=p.x,r=p.y,a=o=p.radius,s=n=0}else if(e.type===St.ELIP){const p=e.shape;i=p.x,r=p.y,a=p.width,o=p.height,s=n=0}else{const p=e.shape,m=p.width/2,g=p.height/2;i=p.x+m,r=p.y+g,a=o=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-a,n=g-o}if(!(a>=0&&o>=0&&s>=0&&n>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(a+o)),l=h*8+(s?4:0)+(n?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=i+s,t[1]=t[3]=r+n,t[2]=t[4]=i-s,t[5]=t[7]=r-n;return}let c=0,u=h*4+(s?2:0)+2,d=u,f=l;{const p=s+a,m=n,g=i+p,y=i-p,_=r+m;if(t[c++]=g,t[c++]=_,t[--u]=_,t[--u]=y,n){const v=r-m;t[d++]=y,t[d++]=v,t[--f]=v,t[--f]=g}}for(let p=1;p<h;p++){const m=Math.PI/2*(p/h),g=s+Math.cos(m)*a,y=n+Math.sin(m)*o,_=i+g,v=i-g,x=r+y,T=r-y;t[c++]=_,t[c++]=x,t[--u]=x,t[--u]=v,t[d++]=v,t[d++]=T,t[--f]=T,t[--f]=_}{const p=s,m=n+o,g=i+p,y=i-p,_=r+m,v=r-m;t[c++]=g,t[c++]=_,t[--f]=v,t[--f]=g,s&&(t[c++]=y,t[c++]=_,t[--f]=v,t[--f]=y)}},triangulate(e,t){const i=e.points,r=t.points,s=t.indices;if(i.length===0)return;let n=r.length/2;const a=n;let o,h;if(e.type!==St.RREC){const c=e.shape;o=c.x,h=c.y}else{const c=e.shape;o=c.x+c.width/2,h=c.y+c.height/2}const l=e.matrix;r.push(e.matrix?l.a*o+l.c*h+l.tx:o,e.matrix?l.b*o+l.d*h+l.ty:h),n++,r.push(i[0],i[1]);for(let c=2;c<i.length;c+=2)r.push(i[c],i[c+1]),s.push(n++,a,n);s.push(a+1,a,n)}};function Ia(e,t=!1){const i=e.length;if(i<6)return;let r=0;for(let s=0,n=e[i-2],a=e[i-1];s<i;s+=2){const o=e[s],h=e[s+1];r+=(o-n)*(h+a),n=o,a=h}if(!t&&r>0||t&&r<=0){const s=i/2;for(let n=s+s%2;n<i;n+=2){const a=i-n-2,o=i-n-1,h=n,l=n+1;[e[a],e[h]]=[e[h],e[a]],[e[o],e[l]]=[e[l],e[o]]}}}const nh={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let i=e.points;const r=e.holes,s=t.points,n=t.indices;if(i.length>=6){Ia(i,!1);const a=[];for(let l=0;l<r.length;l++){const c=r[l];Ia(c.points,!0),a.push(i.length/2),i=i.concat(c.points)}const o=Ar(i,a,2);if(!o)return;const h=s.length/2;for(let l=0;l<o.length;l+=3)n.push(o[l]+h),n.push(o[l+1]+h),n.push(o[l+2]+h);for(let l=0;l<i.length;l++)s.push(i[l])}}},wm={build(e){const t=e.shape,i=t.x,r=t.y,s=t.width,n=t.height,a=e.points;a.length=0,s>=0&&n>=0&&a.push(i,r,i+s,r,i+s,r+n,i,r+n)},triangulate(e,t){const i=e.points,r=t.points;if(i.length===0)return;const s=r.length/2;r.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},Sm={build(e){Nr.build(e)},triangulate(e,t){Nr.triangulate(e,t)}};var ye=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(ye||{}),Fe=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Fe||{});const oi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let i=Math.ceil(e/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class Ra{static curveTo(t,i,r,s,n,a){const o=a[a.length-2],l=a[a.length-1]-i,c=o-t,u=s-i,d=r-t,f=Math.abs(l*d-c*u);if(f<1e-8||n===0)return(a[a.length-2]!==t||a[a.length-1]!==i)&&a.push(t,i),null;const p=l*l+c*c,m=u*u+d*d,g=l*u+c*d,y=n*Math.sqrt(p)/f,_=n*Math.sqrt(m)/f,v=y*g/p,x=_*g/m,T=y*d+_*c,C=y*u+_*l,A=c*(_+v),w=l*(_+v),M=d*(y+x),F=u*(y+x),b=Math.atan2(w-C,A-T),R=Math.atan2(F-C,M-T);return{cx:T+t,cy:C+i,radius:n,startAngle:b,endAngle:R,anticlockwise:c*u>d*l}}static arc(t,i,r,s,n,a,o,h,l){const c=o-a,u=oi._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Pr)*40),d=c/(u*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=u-1,y=g%1/g;for(let _=0;_<=g;++_){const v=_+y*_,x=d+a+f*v,T=Math.cos(x),C=-Math.sin(x);l.push((p*T+m*C)*n+r,(p*-C+m*T)*n+s)}}}class Am{constructor(){this.reset()}begin(t,i,r){this.reset(),this.style=t,this.start=i,this.attribStart=r}end(t,i){this.attribSize=i-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class In{static curveLength(t,i,r,s,n,a,o,h){let c=0,u=0,d=0,f=0,p=0,m=0,g=0,y=0,_=0,v=0,x=0,T=t,C=i;for(let A=1;A<=10;++A)u=A/10,d=u*u,f=d*u,p=1-u,m=p*p,g=m*p,y=g*t+3*m*u*r+3*p*d*n+f*o,_=g*i+3*m*u*s+3*p*d*a+f*h,v=T-y,x=C-_,T=y,C=_,c+=Math.sqrt(v*v+x*x);return c}static curveTo(t,i,r,s,n,a,o){const h=o[o.length-2],l=o[o.length-1];o.length-=2;const c=oi._segmentsCount(In.curveLength(h,l,t,i,r,s,n,a));let u=0,d=0,f=0,p=0,m=0;o.push(h,l);for(let g=1,y=0;g<=c;++g)y=g/c,u=1-y,d=u*u,f=d*u,p=y*y,m=p*y,o.push(f*h+3*d*y*t+3*u*p*r+m*n,f*l+3*d*y*i+3*u*p*s+m*a)}}function Pa(e,t,i,r,s,n,a,o){const h=e-i*s,l=t-r*s,c=e+i*n,u=t+r*n;let d,f;a?(d=r,f=-i):(d=-r,f=i);const p=h+d,m=l+f,g=c+d,y=u+f;return o.push(p,m),o.push(g,y),2}function Ie(e,t,i,r,s,n,a,o){const h=i-e,l=r-t;let c=Math.atan2(h,l),u=Math.atan2(s-e,n-t);o&&c<u?c+=Math.PI*2:!o&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(h*h+l*l),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(d+=y,o){a.push(e,t),a.push(i,r);for(let _=1,v=d;_<g;_++,v+=y)a.push(e,t),a.push(e+Math.sin(v)*m,t+Math.cos(v)*m);a.push(e,t),a.push(s,n)}else{a.push(i,r),a.push(e,t);for(let _=1,v=d;_<g;_++,v+=y)a.push(e+Math.sin(v)*m,t+Math.cos(v)*m),a.push(e,t);a.push(s,n),a.push(e,t)}return g*2}function Cm(e,t){const i=e.shape;let r=e.points||i.points.slice();const s=t.closePointEps;if(r.length===0)return;const n=e.lineStyle,a=new q(r[0],r[1]),o=new q(r[r.length-2],r[r.length-1]),h=i.type!==St.POLY||i.closeStroke,l=Math.abs(a.x-o.x)<s&&Math.abs(a.y-o.y)<s;if(h){r=r.slice(),l&&(r.pop(),r.pop(),o.set(r[r.length-2],r[r.length-1]));const D=(a.x+o.x)*.5,Z=(o.y+a.y)*.5;r.unshift(D,Z),r.push(D,Z)}const c=t.points,u=r.length/2;let d=r.length;const f=c.length/2,p=n.width/2,m=p*p,g=n.miterLimit*n.miterLimit;let y=r[0],_=r[1],v=r[2],x=r[3],T=0,C=0,A=-(_-x),w=y-v,M=0,F=0,b=Math.sqrt(A*A+w*w);A/=b,w/=b,A*=p,w*=p;const R=n.alignment,S=(1-R)*2,E=R*2;h||(n.cap===Fe.ROUND?d+=Ie(y-A*(S-E)*.5,_-w*(S-E)*.5,y-A*S,_-w*S,y+A*E,_+w*E,c,!0)+2:n.cap===Fe.SQUARE&&(d+=Pa(y,_,A,w,S,E,!0,c))),c.push(y-A*S,_-w*S),c.push(y+A*E,_+w*E);for(let D=1;D<u-1;++D){y=r[(D-1)*2],_=r[(D-1)*2+1],v=r[D*2],x=r[D*2+1],T=r[(D+1)*2],C=r[(D+1)*2+1],A=-(_-x),w=y-v,b=Math.sqrt(A*A+w*w),A/=b,w/=b,A*=p,w*=p,M=-(x-C),F=v-T,b=Math.sqrt(M*M+F*F),M/=b,F/=b,M*=p,F*=p;const Z=v-y,Q=_-x,I=v-T,L=C-x,W=Z*I+Q*L,J=Q*I-L*Z,V=J<0;if(Math.abs(J)<.001*Math.abs(W)){c.push(v-A*S,x-w*S),c.push(v+A*E,x+w*E),W>=0&&(n.join===ye.ROUND?d+=Ie(v,x,v-A*S,x-w*S,v-M*S,x-F*S,c,!1)+4:d+=2,c.push(v-M*E,x-F*E),c.push(v+M*S,x+F*S));continue}const rt=(-A+y)*(-w+x)-(-A+v)*(-w+_),pt=(-M+T)*(-F+x)-(-M+v)*(-F+C),bt=(Z*pt-I*rt)/J,It=(L*rt-Q*pt)/J,Bt=(bt-v)*(bt-v)+(It-x)*(It-x),Et=v+(bt-v)*S,st=x+(It-x)*S,mt=v-(bt-v)*E,vt=x-(It-x)*E,te=Math.min(Z*Z+Q*Q,I*I+L*L),ee=V?S:E,ui=te+ee*ee*m;Bt<=ui?n.join===ye.BEVEL||Bt/m>g?(V?(c.push(Et,st),c.push(v+A*E,x+w*E),c.push(Et,st),c.push(v+M*E,x+F*E)):(c.push(v-A*S,x-w*S),c.push(mt,vt),c.push(v-M*S,x-F*S),c.push(mt,vt)),d+=2):n.join===ye.ROUND?V?(c.push(Et,st),c.push(v+A*E,x+w*E),d+=Ie(v,x,v+A*E,x+w*E,v+M*E,x+F*E,c,!0)+4,c.push(Et,st),c.push(v+M*E,x+F*E)):(c.push(v-A*S,x-w*S),c.push(mt,vt),d+=Ie(v,x,v-A*S,x-w*S,v-M*S,x-F*S,c,!1)+4,c.push(v-M*S,x-F*S),c.push(mt,vt)):(c.push(Et,st),c.push(mt,vt)):(c.push(v-A*S,x-w*S),c.push(v+A*E,x+w*E),n.join===ye.ROUND?V?d+=Ie(v,x,v+A*E,x+w*E,v+M*E,x+F*E,c,!0)+2:d+=Ie(v,x,v-A*S,x-w*S,v-M*S,x-F*S,c,!1)+2:n.join===ye.MITER&&Bt/m<=g&&(V?(c.push(mt,vt),c.push(mt,vt)):(c.push(Et,st),c.push(Et,st)),d+=2),c.push(v-M*S,x-F*S),c.push(v+M*E,x+F*E),d+=2)}y=r[(u-2)*2],_=r[(u-2)*2+1],v=r[(u-1)*2],x=r[(u-1)*2+1],A=-(_-x),w=y-v,b=Math.sqrt(A*A+w*w),A/=b,w/=b,A*=p,w*=p,c.push(v-A*S,x-w*S),c.push(v+A*E,x+w*E),h||(n.cap===Fe.ROUND?d+=Ie(v-A*(S-E)*.5,x-w*(S-E)*.5,v-A*S,x-w*S,v+A*E,x+w*E,c,!1)+2:n.cap===Fe.SQUARE&&(d+=Pa(v,x,A,w,S,E,!1,c)));const j=t.indices,$=oi.epsilon*oi.epsilon;for(let D=f;D<d+f-2;++D)y=c[D*2],_=c[D*2+1],v=c[(D+1)*2],x=c[(D+1)*2+1],T=c[(D+2)*2],C=c[(D+2)*2+1],!(Math.abs(y*(x-C)+v*(C-_)+T*(_-x))<$)&&j.push(D,D+1,D+2)}function Im(e,t){let i=0;const r=e.shape,s=e.points||r.points,n=r.type!==St.POLY||r.closeStroke;if(s.length===0)return;const a=t.points,o=t.indices,h=s.length/2,l=a.length/2;let c=l;for(a.push(s[0],s[1]),i=1;i<h;i++)a.push(s[i*2],s[i*2+1]),o.push(c,c+1),c++;n&&o.push(c,l)}function Ma(e,t){e.lineStyle.native?Im(e,t):Cm(e,t)}class Rn{static curveLength(t,i,r,s,n,a){const o=t-2*r+n,h=i-2*s+a,l=2*r-2*t,c=2*s-2*i,u=4*(o*o+h*h),d=4*(o*l+h*c),f=l*l+c*c,p=2*Math.sqrt(u+d+f),m=Math.sqrt(u),g=2*u*m,y=2*Math.sqrt(f),_=d/m;return(g*p+m*d*(p-y)+(4*f*u-d*d)*Math.log((2*m+_+p)/(_+y)))/(4*g)}static curveTo(t,i,r,s,n){const a=n[n.length-2],o=n[n.length-1],h=oi._segmentsCount(Rn.curveLength(a,o,t,i,r,s));let l=0,c=0;for(let u=1;u<=h;++u){const d=u/h;l=a+(t-a)*d,c=o+(i-o)*d,n.push(l+(t+(r-t)*d-l)*d,c+(i+(s-i)*d-c)*d)}}}const bs={[St.POLY]:nh,[St.CIRC]:Nr,[St.ELIP]:Nr,[St.RECT]:wm,[St.RREC]:Sm},Da=[],lr=[];class Or{constructor(t,i=null,r=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=i,this.matrix=s,this.type=t.type}clone(){return new Or(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ze=new q,ah=class extends lo{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Mr,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),lr.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Da.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,r=null){const s=new Or(e,t,i,r);return this.graphicsData.push(s),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new Or(e,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const r=t[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(e,ze):ze.copyFrom(e),r.shape.contains(ze.x,ze.y))){let s=!1;if(r.holes){for(let n=0;n<r.holes.length;n++)if(r.holes[n].shape.contains(ze.x,ze.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,r=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],r=i.style);for(let o=this.shapeIndex;o<t.length;o++){this.shapeIndex++;const h=t[o],l=h.fillStyle,c=h.lineStyle;bs[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(l.visible||c.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const f=d===0?l:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=be.REPEAT,d===0?this.processFill(h):this.processLine(h);const y=this.points.length/2-g;y!==0&&(i&&!this._compareStyles(r,f)&&(i.end(m,g),i=null),i||(i=Da.pop()||new Am,i.begin(f,m,g),this.batches.push(i),r=f),this.addUvs(this.points,e,f.texture,g,y,f.matrix))}}const s=this.indices.length,n=this.points.length/2;if(i&&i.end(s,n),this.batches.length===0){this.batchable=!0;return}const a=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],r=i.fillStyle,s=i.lineStyle;if(r&&!r.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const r=e[t];for(let s=0;s<r.size;s++){const n=r.start+s;this.indicesUint16[n]=this.indicesUint16[n]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<ah.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++z._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),lr.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let r=lr.pop();r||(r=new Vs,r.texArray=new Ws),r.texArray.count=0,r.start=0,r.size=0,r.type=ae.TRIANGLES;let s=0,n=null,a=0,o=!1,h=ae.TRIANGLES,l=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;o!==!!f.native&&(o=!!f.native,h=o?ae.LINES:ae.TRIANGLES,n=null,s=d,e++),n!==p&&(n=p,p._batchEnabled!==e&&(s===d&&(e++,s=0,r.size>0&&(r=lr.pop(),r||(r=new Vs,r.texArray=new Ws),this.drawCalls.push(r)),r.start=l,r.size=0,r.texArray.count=0,r.type=h),p.touched=1,p._batchEnabled=e,p._batchLocation=s,p.wrapMode=be.REPEAT,r.texArray.elements[r.texArray.count++]=p,s++)),r.size+=u.size,l+=u.size,a=p._batchLocation,this.addColors(t,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(i,a,u.attribSize,u.attribStart)}z._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,r=this.textureIds,s=new ArrayBuffer(e.length*3*4),n=new Float32Array(s),a=new Uint32Array(s);let o=0;for(let h=0;h<e.length/2;h++)n[o++]=e[h*2],n[o++]=e[h*2+1],n[o++]=t[h*2],n[o++]=t[h*2+1],a[o++]=i[h],n[o++]=r[h];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?nh.triangulate(e,this):bs[e.type].triangulate(e,this)}processLine(e){Ma(e,this);for(let t=0;t<e.holes.length;t++)Ma(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];bs[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const r=e[i*2],s=e[i*2+1];e[i*2]=t.a*r+t.c*s+t.tx,e[i*2+1]=t.b*r+t.d*s+t.ty}}addColors(e,t,i,r,s=0){const n=(t>>16)+(t&65280)+((t&255)<<16),a=bn(n,i);e.length=Math.max(e.length,s+r);for(let o=0;o<r;o++)e[s+o]=a}addTextureIds(e,t,i,r=0){e.length=Math.max(e.length,r+i);for(let s=0;s<i;s++)e[r+s]=t}addUvs(e,t,i,r,s,n=null){let a=0;const o=t.length,h=i.frame;for(;a<s;){let c=e[(r+a)*2],u=e[(r+a)*2+1];if(n){const d=n.a*c+n.c*u+n.tx;u=n.b*c+n.d*u+n.ty,c=d}a++,t.push(c/h.width,u/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(t,i,o,s)}adjustUvs(e,t,i,r){const s=t.baseTexture,n=1e-6,a=i+r*2,o=t.frame,h=o.width/s.width,l=o.height/s.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(e[i]+n),f=Math.floor(e[i+1]+n);for(let p=i+2;p<a;p+=2)d=Math.min(d,Math.floor(e[p]+n)),f=Math.min(f,Math.floor(e[p+1]+n));c-=d,u-=f;for(let p=i;p<a;p+=2)e[p]=(e[p]+c)*h,e[p+1]=(e[p+1]+u)*l}};let oh=ah;oh.BATCHABLE_SIZE=100;class Kr{constructor(){this.color=16777215,this.alpha=1,this.texture=k.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Kr;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=k.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Pn extends Kr{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Fe.BUTT,this.join=ye.MITER,this.miterLimit=10}clone(){const t=new Pn;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Rm=new Float32Array(3),Es={},br=class extends Gt{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Kr,this._lineStyle=new Pn,this._matrix=null,this._holeMode=!1,this.state=He.for2d(),this._geometry=e||new oh,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=X.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new br(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(e){this._tint=e}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i=1,r=.5,s=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:r,native:s}),this.lineTextureStyle(e)}lineTextureStyle(e){e=Object.assign({width:0,texture:k.WHITE,color:e!=null&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Fe.BUTT,join:ye.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();const t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new si,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new si,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,r=i[i.length-2],s=i[i.length-1];return(r!==e||s!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,r){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),Rn.curveTo(e,t,i,r,s),this}bezierCurveTo(e,t,i,r,s,n){return this._initCurve(),In.curveTo(e,t,i,r,s,n,this.currentPath.points),this}arcTo(e,t,i,r,s){this._initCurve(e,t);const n=this.currentPath.points,a=Ra.curveTo(e,t,i,r,s,n);if(a){const{cx:o,cy:h,radius:l,startAngle:c,endAngle:u,anticlockwise:d}=a;this.arc(o,h,l,c,u,d)}return this}arc(e,t,i,r,s,n=!1){if(r===s)return this;if(!n&&s<=r?s+=Pr:n&&r<=s&&(r+=Pr),s-r===0)return this;const o=e+Math.cos(r)*i,h=t+Math.sin(r)*i,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-o),d=Math.abs(c[c.length-1]-h);u<l&&d<l||c.push(o,h)}else this.moveTo(o,h),c=this.currentPath.points;return Ra.arc(o,h,e,t,i,r,s,n,c),this}beginFill(e=0,t=1){return this.beginTextureFill({texture:k.WHITE,color:e,alpha:t})}beginTextureFill(e){e=Object.assign({texture:k.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();const t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,r){return this.drawShape(new Y(e,t,i,r))}drawRoundedRect(e,t,i,r,s){return this.drawShape(new wn(e,t,i,r,s))}drawCircle(e,t,i){return this.drawShape(new En(e,t,i))}drawEllipse(e,t,i,r){return this.drawShape(new Tn(e,t,i,r))}drawPolygon(...e){let t,i=!0;const r=e[0];r.points?(i=r.closeStroke,t=r.points):Array.isArray(e[0])?t=e[0]:t=e;const s=new si(t);return s.closeStroke=i,this.drawShape(s),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===St.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let r=0;r<i;r++){const s=e.batches[r],n=s.style.color,a=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),o=new Float32Array(e.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),h=new Uint16Array(e.indicesUint16.buffer,s.start*2,s.size),l={vertexData:a,blendMode:t,indices:h,uvs:o,_batchRGB:Fi(n),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=l}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,e.plugins[this.pluginName].render(r)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,r=this.tint,s=this.worldAlpha,n=t.uniforms,a=i.drawCalls;n.translationMatrix=this.transform.worldTransform,n.tint[0]=(r>>16&255)/255*s,n.tint[1]=(r>>8&255)/255*s,n.tint[2]=(r&255)/255*s,n.tint[3]=s,e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let o=0,h=a.length;o<h;o++)this._renderDrawCallDirect(e,i.drawCalls[o])}_renderDrawCallDirect(e,t){const{texArray:i,type:r,size:s,start:n}=t,a=i.count;for(let o=0;o<a;o++)e.texture.bind(i.elements[o],o);e.geometry.draw(r,s,n)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!Es[i]){const{maxTextures:r}=e.plugins[i],s=new Int32Array(r);for(let o=0;o<r;o++)s[o]=o;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new nt,default:Jt.from({uSamplers:s},!0)},a=e.plugins[i]._shader.program;Es[i]=new he(a,n)}t=Es[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:r,maxY:s}=e.bounds;this._bounds.addFrame(this.transform,t,i,r,s)}containsPoint(e){return this.worldTransform.applyInverse(e,br._TEMP_POINT),this._geometry.containsPoint(br._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const e=Fi(this.tint,Rm);for(let t=0;t<this.batches.length;t++){const i=this.batches[t],r=i._batchRGB,s=e[0]*r[0]*255,n=e[1]*r[1]*255,a=e[2]*r[2]*255,o=(s<<16)+(n<<8)+(a|0);i._tintRGB=(o>>16)+(o&65280)+((o&255)<<16)}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,r=t.b,s=t.c,n=t.d,a=t.tx,o=t.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let u=0;u<h.length;u+=2){const d=h[u],f=h[u+1];l[c++]=i*d+s*f+a,l[c++]=n*f+r*d+o}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let Zr=br;Zr.curves=oi;Zr._TEMP_POINT=new q;class Pm{constructor(t,i){this.uvBuffer=t,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}}const Ts=new q,Ba=new si,hh=class extends Gt{constructor(e,t,i,r=ae.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||He.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=N.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ae.TRIANGLES&&t.length<hh.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const r=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[r]),e.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],i=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==i.length&&(this.vertexData=new Float32Array(i.length));const s=this.transform.worldTransform,n=s.a,a=s.b,o=s.c,h=s.d,l=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=i[d*2],p=i[d*2+1];u[d*2]=n*f+o*p+l,u[d*2+1]=a*f+h*p+c}if(this._roundPixels){const d=N.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=r}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new Pm(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,Ts);const t=this.geometry.getBuffer("aVertexPosition").data,i=Ba.points,r=this.geometry.getIndex().data,s=r.length,n=this.drawMode===4?3:1;for(let a=0;a+2<s;a+=n){const o=r[a]*2,h=r[a+1]*2,l=r[a+2]*2;if(i[0]=t[o],i[1]=t[o+1],i[2]=t[h],i[3]=t[h+1],i[4]=t[l],i[5]=t[l+1],Ba.contains(Ts.x,Ts.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let on=hh;on.BATCHABLE_SIZE=100;class Mm extends we{constructor(t,i,r){super();const s=new ft(t),n=new ft(i,!0),a=new ft(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,H.FLOAT).addAttribute("aTextureCoord",n,2,!1,H.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Dm=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Bm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Fa extends he{constructor(t,i){const r={uSampler:t,alpha:1,uTextureMatrix:nt.IDENTITY,uColor:new Float32Array([1,1,1,1])};i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i),i.uniforms&&Object.assign(r,i.uniforms),super(i.program||qt.from(Bm,Dm),r),this._colorDirty=!1,this.uvMatrix=new Io(t),this.batchable=i.program===void 0,this.pluginName=i.pluginName,this.tint=i.tint,this.alpha=i.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;so(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Na{constructor(t,i,r){this.geometry=new we,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<t.length;++s){let n=t[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||H.FLOAT,offset:n.offset},i[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let i=0;this.indexBuffer=new ft(Td(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=i,i+=o.size,this.dynamicStride+=o.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new ft(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=s,s+=o.size,this.staticStride+=o.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new ft(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===H.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===H.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(t,i,r){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(t,i,r,n.type===H.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,i,r){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(t,i,r,n.type===H.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Fm=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Nm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class lh extends Wr{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new nt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:H.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=he.from(Nm,Fm,{}),this.state=He.for2d()}render(t){const i=t.children,r=t._maxSize,s=t._batchSize,n=this.renderer;let a=i.length;if(a===0)return;a>r&&!t.autoResize&&(a=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const h=i[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=ro(t.blendMode,l),n.state.set(this.state);const c=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Ed(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,l),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<a;f+=s,p+=1){let m=a-f;m>s&&(m=s),p>=o.length&&o.push(this._generateOneMoreBuffer(t));const g=o[p];g.uploadDynamic(i,f,m);const y=t._bufferUpdateIDs[p]||0;d=d||g._updateID<y,d&&(g._updateID=t._updateID,g.uploadStatic(i,f,m)),n.geometry.bind(g.geometry),c.drawElements(c.TRIANGLES,m*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const i=[],r=t._maxSize,s=t._batchSize,n=t._properties;for(let a=0;a<r;a+=s)i.push(new Na(this.properties,n,s));return i}_generateOneMoreBuffer(t){const i=t._batchSize,r=t._properties;return new Na(this.properties,r,i)}uploadVertices(t,i,r,s,n,a){let o=0,h=0,l=0,c=0;for(let u=0;u<r;++u){const d=t[i+u],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,y=f.orig;g?(h=g.x-d.anchor.x*y.width,o=h+g.width,c=g.y-d.anchor.y*y.height,l=c+g.height):(o=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),c=y.height*-d.anchor.y),s[a]=h*p,s[a+1]=c*m,s[a+n]=o*p,s[a+n+1]=c*m,s[a+n*2]=o*p,s[a+n*2+1]=l*m,s[a+n*3]=h*p,s[a+n*3+1]=l*m,a+=n*4}}uploadPosition(t,i,r,s,n,a){for(let o=0;o<r;o++){const h=t[i+o].position;s[a]=h.x,s[a+1]=h.y,s[a+n]=h.x,s[a+n+1]=h.y,s[a+n*2]=h.x,s[a+n*2+1]=h.y,s[a+n*3]=h.x,s[a+n*3+1]=h.y,a+=n*4}}uploadRotation(t,i,r,s,n,a){for(let o=0;o<r;o++){const h=t[i+o].rotation;s[a]=h,s[a+n]=h,s[a+n*2]=h,s[a+n*3]=h,a+=n*4}}uploadUvs(t,i,r,s,n,a){for(let o=0;o<r;++o){const h=t[i+o]._texture._uvs;h?(s[a]=h.x0,s[a+1]=h.y0,s[a+n]=h.x1,s[a+n+1]=h.y1,s[a+n*2]=h.x2,s[a+n*2+1]=h.y2,s[a+n*3]=h.x3,s[a+n*3+1]=h.y3,a+=n*4):(s[a]=0,s[a+1]=0,s[a+n]=0,s[a+n+1]=0,s[a+n*2]=0,s[a+n*2+1]=0,s[a+n*3]=0,s[a+n*3+1]=0,a+=n*4)}}uploadTint(t,i,r,s,n,a){for(let o=0;o<r;++o){const h=t[i+o],l=h._texture.baseTexture.alphaMode>0,c=h.alpha,u=c<1&&l?bn(h._tintRGB,c):h._tintRGB+(c*255<<24);s[a]=u,s[a+n]=u,s[a+n*2]=u,s[a+n*3]=u,a+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}lh.extension={name:"particle",type:B.RendererPlugin};G.add(lh);var Jr=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Jr||{});const cr={willReadFrequently:!0},O=class{static get experimentalLetterSpacingSupported(){let e=O._experimentalLetterSpacingSupported;if(e!==void 0){const t=N.ADAPTER.getCanvasRenderingContext2D().prototype;e=O._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,r,s,n,a,o,h){this.text=e,this.style=t,this.width=i,this.height=r,this.lines=s,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(e,t,i,r=O._canvas){i=i??t.wordWrap;const s=t.toFontString(),n=O.measureFont(s);n.fontSize===0&&(n.fontSize=t.fontSize,n.ascent=t.fontSize);const a=r.getContext("2d",cr);a.font=s;const h=(i?O.wordWrap(e,t,r):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let p=0;p<h.length;p++){const m=O._measureText(h[p],t.letterSpacing,a);l[p]=m,c=Math.max(c,m)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||n.fontSize+t.strokeThickness;let f=Math.max(d,n.fontSize+t.strokeThickness*2)+(h.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new O(e,t,u,f,h,l,d+t.leading,c,n)}static _measureText(e,t,i){let r=!1;O.experimentalLetterSpacingSupported&&(O.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let s=i.measureText(e).width;return s>0&&(r?s-=t:s+=(O.graphemeSegmenter(e).length-1)*t),s}static wordWrap(e,t,i=O._canvas){const r=i.getContext("2d",cr);let s=0,n="",a="";const o=Object.create(null),{letterSpacing:h,whiteSpace:l}=t,c=O.collapseSpaces(l),u=O.collapseNewlines(l);let d=!c;const f=t.wordWrapWidth+h,p=O.tokenize(e);for(let m=0;m<p.length;m++){let g=p[m];if(O.isNewline(g)){if(!u){a+=O.addLine(n),d=!c,n="",s=0;continue}g=" "}if(c){const _=O.isBreakingSpace(g),v=O.isBreakingSpace(n[n.length-1]);if(_&&v)continue}const y=O.getFromCache(g,h,o,r);if(y>f)if(n!==""&&(a+=O.addLine(n),n="",s=0),O.canBreakWords(g,t.breakWords)){const _=O.wordWrapSplit(g);for(let v=0;v<_.length;v++){let x=_[v],T=x,C=1;for(;_[v+C];){const w=_[v+C];if(!O.canBreakChars(T,w,g,v,t.breakWords))x+=w;else break;T=w,C++}v+=C-1;const A=O.getFromCache(x,h,o,r);A+s>f&&(a+=O.addLine(n),d=!1,n="",s=0),n+=x,s+=A}}else{n.length>0&&(a+=O.addLine(n),n="",s=0);const _=m===p.length-1;a+=O.addLine(g,!_),d=!1,n="",s=0}else y+s>f&&(d=!1,a+=O.addLine(n),n="",s=0),(n.length>0||!O.isBreakingSpace(g)||d)&&(n+=g,s+=y)}return a+=O.addLine(n,!1),a}static addLine(e,t=!0){return e=O.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,r){let s=i[e];return typeof s!="number"&&(s=O._measureText(e,t,r)+t,i[e]=s),s}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!O.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:O._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:O._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let r=0;r<e.length;r++){const s=e[r],n=e[r+1];if(O.isBreakingSpace(s,n)||O.isNewline(s)){i!==""&&(t.push(i),i=""),t.push(s);continue}i+=s}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,r,s){return!0}static wordWrapSplit(e){return O.graphemeSegmenter(e)}static measureFont(e){if(O._fonts[e])return O._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=O._canvas,r=O._context;r.font=e;const s=O.METRICS_STRING+O.BASELINE_SYMBOL,n=Math.ceil(r.measureText(s).width);let a=Math.ceil(r.measureText(O.BASELINE_SYMBOL).width);const o=Math.ceil(O.HEIGHT_MULTIPLIER*a);if(a=a*O.BASELINE_MULTIPLIER|0,n===0||o===0)return O._fonts[e]=t,t;i.width=n,i.height=o,r.fillStyle="#f00",r.fillRect(0,0,n,o),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(s,0,a);const h=r.getImageData(0,0,n,o).data,l=h.length,c=n*4;let u=0,d=0,f=!1;for(u=0;u<a;++u){for(let p=0;p<c;p+=4)if(h[d+p]!==255){f=!0;break}if(!f)d+=c;else break}for(t.ascent=a-u,d=l-c,f=!1,u=o;u>a;--u){for(let p=0;p<c;p+=4)if(h[d+p]!==255){f=!0;break}if(!f)d-=c;else break}return t.descent=u-a,t.fontSize=t.ascent+t.descent,O._fonts[e]=t,t}static clearMetrics(e=""){e?delete O._fonts[e]:O._fonts={}}static get _canvas(){if(!O.__canvas){let e;try{const t=new OffscreenCanvas(0,0),i=t.getContext("2d",cr);if(i!=null&&i.measureText)return O.__canvas=t,t;e=N.ADAPTER.createCanvas()}catch{e=N.ADAPTER.createCanvas()}e.width=e.height=10,O.__canvas=e}return O.__canvas}static get _context(){return O.__context||(O.__context=O._canvas.getContext("2d",cr)),O.__context}};let wt=O;wt.METRICS_STRING="|q";wt.BASELINE_SYMBOL="M";wt.BASELINE_MULTIPLIER=1.4;wt.HEIGHT_MULTIPLIER=2;wt.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(i=>i.segment)}return e=>[...e]})();wt.experimentalLetterSpacing=!1;wt._fonts={};wt._newlines=[10,13];wt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const Om=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ti=class{constructor(e){this.styleID=0,this.reset(),Ss(this,e,e)}clone(){const e={};return Ss(e,this,Ti.defaultStyle),new Ti(e)}reset(){Ss(this,Ti.defaultStyle,Ti.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=ws(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=ws(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){Lm(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=ws(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let r=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!Om.includes(r)&&(r=`"${r}"`),t[i]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let ke=Ti;ke.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Jr.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Oa(e){return typeof e=="number"?eo(e):(typeof e=="string"&&e.startsWith("0x")&&(e=e.replace("0x","#")),e)}function ws(e){if(Array.isArray(e)){for(let t=0;t<e.length;++t)e[t]=Oa(e[t]);return e}else return Oa(e)}function Lm(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function Ss(e,t,i){for(const r in i)Array.isArray(t[r])?e[r]=t[r].slice():e[r]=t[r]}const Um={texture:!0,children:!1,baseTexture:!0},hn=class extends Ee{constructor(e,t,i){let r=!1;i||(i=N.ADAPTER.createCanvas(),r=!0),i.width=3,i.height=3;const s=k.from(i);s.orig=new Y,s.trim=new Y,super(s),this._ownCanvas=r,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=hn.defaultResolution??N.RESOLUTION,this._autoResolution=hn.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return wt.experimentalLetterSpacing}static set experimentalLetterSpacing(e){K("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),wt.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,r=wt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=r.width,n=r.height,a=r.lines,o=r.lineHeight,h=r.lineWidths,l=r.maxLineWidth,c=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let u,d;const f=t.dropShadow?2:1;for(let p=0;p<f;++p){const m=t.dropShadow&&p===0,g=m?Math.ceil(Math.max(1,n)+t.padding*2):0,y=g*this._resolution;if(m){i.fillStyle="black",i.strokeStyle="black";const v=t.dropShadowColor,x=Fi(typeof v=="number"?v:xn(v)),T=t.dropShadowBlur*this._resolution,C=t.dropShadowDistance*this._resolution;i.shadowColor=`rgba(${x[0]*255},${x[1]*255},${x[2]*255},${t.dropShadowAlpha})`,i.shadowBlur=T,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*C,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*C+y}else i.fillStyle=this._generateFillStyle(t,a,r),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let _=(o-c.fontSize)/2;o-c.fontSize<0&&(_=0);for(let v=0;v<a.length;v++)u=t.strokeThickness/2,d=t.strokeThickness/2+v*o+c.ascent+_,t.align==="right"?u+=l-h[v]:t.align==="center"&&(u+=(l-h[v])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[v],u+t.padding,d+t.padding-g,!0),t.fill&&this.drawLetterSpacing(a[v],u+t.padding,d+t.padding-g)}this.updateTexture()}drawLetterSpacing(e,t,i,r=!1){const n=this._style.letterSpacing;let a=!1;if(wt.experimentalLetterSpacingSupported&&(wt.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||a){r?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let o=t;const h=wt.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let u=0;u<h.length;++u){const d=h[u];r?this.context.strokeText(d,o,i):this.context.fillText(d,o,i);let f="";for(let p=u+1;p<h.length;++p)f+=h[p];c=this.context.measureText(f).width,o+=l-c+n,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const n=Ad(e);n.data&&(e.width=n.width,e.height=n.height,this.context.putImageData(n.data,0,0))}const t=this._texture,i=this._style,r=i.trim?0:i.padding,s=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),s.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const r=e.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let s;const n=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,o=this.canvas.width/this._resolution-n-a*2,h=this.canvas.height/this._resolution-n-a*2,l=r.slice(),c=e.fillGradientStops.slice();if(!c.length){const u=l.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(l.unshift(r[0]),c.unshift(0),l.push(r[r.length-1]),c.push(1),e.fillGradientType===Jr.LINEAR_VERTICAL){s=this.context.createLinearGradient(o/2,a,o/2,h+a);const u=i.fontProperties.fontSize+e.strokeThickness;for(let d=0;d<t.length;d++){const f=i.lineHeight*(d-1)+u,p=i.lineHeight*d;let m=p;d>0&&f>p&&(m=(p+f)/2);const g=p+u,y=i.lineHeight*(d+1);let _=g;d+1<t.length&&y<g&&(_=(g+y)/2);const v=(_-m)/h;for(let x=0;x<l.length;x++){let T=0;typeof c[x]=="number"?T=c[x]:T=x/l.length;let C=Math.min(1,Math.max(0,m/h+T*v));C=Number(C.toFixed(5)),s.addColorStop(C,l[x])}}}else{s=this.context.createLinearGradient(a,h/2,o+a,h/2);const u=l.length+1;let d=1;for(let f=0;f<l.length;f++){let p;typeof c[f]=="number"?p=c[f]:p=d/u,s.addColorStop(p,l[f]),d++}}return s}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Um,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Je(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Je(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof ke?this._style=e:this._style=new ke(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let Mn=hn;Mn.defaultAutoResolution=!0;class km{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Gm(e,t){var r;let i=!1;if((r=e==null?void 0:e._textures)!=null&&r.length){for(let s=0;s<e._textures.length;s++)if(e._textures[s]instanceof k){const n=e._textures[s].baseTexture;t.includes(n)||(t.push(n),i=!0)}}return i}function Hm(e,t){if(e.baseTexture instanceof z){const i=e.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function Xm(e,t){if(e._texture&&e._texture instanceof k){const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function jm(e,t){return t instanceof Mn?(t.updateText(!0),!0):!1}function zm(e,t){if(t instanceof ke){const i=t.toFontString();return wt.measureFont(i),!0}return!1}function Vm(e,t){if(e instanceof Mn){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function $m(e,t){return e instanceof ke?(t.includes(e)||t.push(e),!0):!1}const ch=class{constructor(e){this.limiter=new km(ch.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Vm),this.registerFindHook($m),this.registerFindHook(Gm),this.registerFindHook(Hm),this.registerFindHook(Xm),this.registerUploadHook(jm),this.registerUploadHook(zm)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Nt.system.addOnce(this.tick,this,ai.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Nt.system.addOnce(this.tick,this,ai.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Gt)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Nt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Lr=ch;Lr.uploadsPerFrame=4;Object.defineProperties(N,{UPLOADS_PER_FRAME:{get(){return Lr.uploadsPerFrame},set(e){K("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Lr.uploadsPerFrame=e}}});function uh(e,t){return t instanceof z?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function Wm(e,t){if(!(t instanceof Zr))return!1;const{geometry:i}=t;t.finishPoly(),i.updateBatches();const{batches:r}=i;for(let s=0;s<r.length;s++){const{texture:n}=r[s].style;n&&uh(e,n.baseTexture)}return i.batchable||e.geometry.bind(i,t._resolveDirectShader(e)),!0}function Ym(e,t){return e instanceof Zr?(t.push(e),!0):!1}class dh extends Lr{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Ym),this.registerUploadHook(uh),this.registerUploadHook(Wm)}}dh.extension={name:"prepare",type:B.RendererSystem};G.add(dh);var qm=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Km=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Zm=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,La=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Jm=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const ur=new nt;class fh extends Wr{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new wo,this.state=He.for2d()}contextChange(){const t=this.renderer,i={globals:t.globalUniforms};this.simpleShader=he.from(La,Jm,i),this.shader=t.context.webGLVersion>1?he.from(Km,qm,i):he.from(La,Zm,i)}render(t){const i=this.renderer,r=this.quad;let s=r.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-a,s[2]=s[4]=1-n,s[5]=s[7]=1-a,r.invalidate();const o=t._texture,h=o.baseTexture,l=h.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=h.isPowerOfTwo&&o.frame.width===h.width&&o.frame.height===h.height;d&&(h._glTextures[i.CONTEXT_UID]?d=h.wrapMode!==be.CLAMP:h.wrapMode===be.CLAMP&&(h.wrapMode=be.REPEAT));const f=d?this.simpleShader:this.shader,p=o.width,m=o.height,g=t._width,y=t._height;ur.set(c.a*p/g,c.b*p/y,c.c*m/g,c.d*m/y,c.tx/g,c.ty/y),ur.invert(),d?ur.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=ur.toArray(!0),f.uniforms.uColor=so(t.tint,t.worldAlpha,f.uniforms.uColor,l),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,i.shader.bind(f),i.geometry.bind(r),this.state.blendMode=ro(t.blendMode,l),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}fh.extension={name:"tilingSprite",type:B.RendererPlugin};G.add(fh);const wi=class{constructor(e,t,i=null){this.linkedSheets=[],this._texture=e instanceof k?e:null,this.baseTexture=e instanceof z?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const r=this.baseTexture.resource;this.resolution=this._updateResolution(i||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=Te(e,null);return i===null&&(i=parseFloat(t??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=wi.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=wi.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const r=this._frameKeys[t],s=this._frames[r],n=s.frame;if(n){let a=null,o=null;const h=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,l=new Y(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);s.rotated?a=new Y(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):a=new Y(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(o=new Y(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[r]=new k(this.baseTexture,a,l,o,s.rotated?2:0,s.anchor),k.addToCache(this.textures[r],r)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const r=e[t][i];this.animations[t].push(this.textures[r])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*wi.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*wi.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let ln=wi;ln.BATCH_SIZE=1e3;const Qm=["jpg","png","jpeg","avif","webp"];function ph(e,t,i){const r={};if(e.forEach(s=>{r[s]=t}),Object.keys(t.textures).forEach(s=>{r[s]=t.textures[s]}),!i){const s=Ct.dirname(e[0]);t.linkedSheets.forEach((n,a)=>{const o=ph([`${s}/${t.data.meta.related_multi_packs[a]}`],n,!0);Object.assign(r,o)})}return r}const tg={extension:B.Asset,cache:{test:e=>e instanceof ln,getCacheableAssets:(e,t)=>ph(e,t,!1)},resolver:{test:e=>{const i=e.split("?")[0].split("."),r=i.pop(),s=i.pop();return r==="json"&&Qm.includes(s)},parse:e=>{var i;const t=e.split(".");return{resolution:parseFloat(((i=N.RETINA_PREFIX.exec(e))==null?void 0:i[1])??"1"),format:t[t.length-2],src:e}}},loader:{extension:{type:B.LoadParser,priority:ce.Normal},async testParse(e,t){return Ct.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,i){var l,c;let r=Ct.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let s=r+e.meta.image;s=sn(s,t.src);const a=(await i.load([s]))[s],o=new ln(a.baseTexture,e,t.src);await o.parse();const h=(l=e==null?void 0:e.meta)==null?void 0:l.related_multi_packs;if(Array.isArray(h)){const u=[];for(const f of h){if(typeof f!="string")continue;let p=r+f;(c=t.data)!=null&&c.ignoreMultiPack||(p=sn(p,t.src),u.push(i.load({src:p,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);o.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[o].concat(o.linkedSheets.filter(p=>p!==f))})}return o},unload(e){e.destroy(!0)}}};G.add(tg);class Ur{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Er{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const i=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in i){const a=i[n].match(/^[a-z]+/gm)[0],o=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in o){const c=o[l].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[u]=p}r[a].push(h)}const s=new Ur;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class cn{static test(t){const i=t;return"getElementsByTagName"in i&&i.getElementsByTagName("page").length&&i.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const i=new Ur,r=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<r.length;l++)i.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(let l=0;l<s.length;l++)i.common.push({lineHeight:parseInt(s[l].getAttribute("lineHeight"),10)});for(let l=0;l<n.length;l++)i.page.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});for(let l=0;l<a.length;l++){const c=a[l];i.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let l=0;l<o.length;l++)i.kerning.push({first:parseInt(o[l].getAttribute("first"),10),second:parseInt(o[l].getAttribute("second"),10),amount:parseInt(o[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)i.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return i}}class un{static test(t){return typeof t=="string"&&t.includes("<font>")?cn.test(N.ADAPTER.parseXML(t)):!1}static parse(t){return cn.parse(N.ADAPTER.parseXML(t))}}const As=[Er,cn,un];function eg(e){for(let t=0;t<As.length;t++)if(As[t].test(e))return As[t];return null}function ig(e,t,i,r,s,n){const a=i.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=e.width/r-h-l*2,u=e.height/r-h-l*2,d=a.slice(),f=i.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),i.fillGradientType===Jr.LINEAR_VERTICAL){o=t.createLinearGradient(c/2,l,c/2,u+l);let p=0;const g=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let y=0;y<s.length;y++){const _=n.lineHeight*y;for(let v=0;v<d.length;v++){let x=0;typeof f[v]=="number"?x=f[v]:x=v/d.length;const T=_/u+x*g;let C=Math.max(p,T);C=Math.min(C,1),o.addColorStop(C,d[v]),p=C}}}else{o=t.createLinearGradient(l,u/2,c+l,u/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let y;typeof f[g]=="number"?y=f[g]:y=m/p,o.addColorStop(y,d[g]),m++}}return o}function rg(e,t,i,r,s,n,a){const o=i.text,h=i.fontProperties;t.translate(r,s),t.scale(n,n);const l=a.strokeThickness/2,c=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=ig(e,t,a,n,[o],i),t.strokeStyle=a.stroke,a.dropShadow){const u=a.dropShadowColor,d=Fi(typeof u=="number"?u:xn(u)),f=a.dropShadowBlur*n,p=a.dropShadowDistance*n;t.shadowColor=`rgba(${d[0]*255},${d[1]*255},${d[2]*255},${a.dropShadowAlpha})`,t.shadowBlur=f,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(o,l,c+i.lineHeight-h.descent),a.fill&&t.fillText(o,l,c+i.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Tr(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function mh(e){return Array.from?Array.from(e):e.split("")}function sg(e){typeof e=="string"&&(e=[e]);const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),a=s[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,h=a;o<=h;o++)t.push(String.fromCharCode(o))}else t.push(...mh(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const Vt=class{constructor(e,t,i){var l;const[r]=e.info,[s]=e.common,[n]=e.page,[a]=e.distanceField,o=Te(n.file),h={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=s.lineHeight/o,this.chars={},this.pageTextures=h;for(let c=0;c<e.page.length;c++){const{id:u,file:d}=e.page[c];h[u]=t instanceof Array?t[c]:t[d],a!=null&&a.fieldType&&a.fieldType!=="none"&&(h[u].baseTexture.alphaMode=Qt.NO_PREMULTIPLIED_ALPHA,h[u].baseTexture.mipmap=le.OFF)}for(let c=0;c<e.char.length;c++){const{id:u,page:d}=e.char[c];let{x:f,y:p,width:m,height:g,xoffset:y,yoffset:_,xadvance:v}=e.char[c];f/=o,p/=o,m/=o,g/=o,y/=o,_/=o,v/=o;const x=new Y(f+h[d].frame.x/o,p+h[d].frame.y/o,m,g);this.chars[u]={xOffset:y,yOffset:_,xAdvance:v,kerning:{},texture:new k(h[d].baseTexture,x),page:d}}for(let c=0;c<e.kerning.length;c++){let{first:u,second:d,amount:f}=e.kerning[c];u/=o,d/=o,f/=o,this.chars[d]&&(this.chars[d].kerning[u]=f)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((l=a==null?void 0:a.fieldType)==null?void 0:l.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let r;if(e instanceof Ur)r=e;else{const n=eg(e);if(!n)throw new Error("Unrecognized data format for font.");r=n.parse(e)}t instanceof k&&(t=[t]);const s=new Vt(r,t,i);return Vt.available[s.font]=s,s}static uninstall(e){const t=Vt.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete Vt.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:s,resolution:n,textureWidth:a,textureHeight:o,...h}=Object.assign({},Vt.defaultOptions,i),l=sg(r),c=t instanceof ke?t:new ke(t),u=a,d=new Ur;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f=0,p=0,m,g,y,_=0;const v=[];for(let T=0;T<l.length;T++){m||(m=N.ADAPTER.createCanvas(),m.width=a,m.height=o,g=m.getContext("2d"),y=new z(m,{resolution:n,...h}),v.push(new k(y)),d.page.push({id:v.length-1,file:""}));const C=l[T],A=wt.measureText(C,c,!1,m),w=A.width,M=Math.ceil(A.height),F=Math.ceil((c.fontStyle==="italic"?2:1)*w);if(p>=o-M*n){if(p===0)throw new Error(`[BitmapFont] textureHeight ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${C}')`);--T,m=null,g=null,y=null,p=0,f=0,_=0;continue}if(_=Math.max(M+A.fontProperties.descent,_),F*n+f>=u){if(f===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${C}')`);--T,p+=_*n,p=Math.ceil(p),f=0,_=0;continue}rg(m,g,A,f,p,n,c);const b=Tr(A.text);d.char.push({id:b,page:v.length-1,x:f/n,y:p/n,width:F,height:M,xoffset:0,yoffset:0,xadvance:w-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(F+2*s)*n,f=Math.ceil(f)}for(let T=0,C=l.length;T<C;T++){const A=l[T];for(let w=0;w<C;w++){const M=l[w],F=g.measureText(A).width,b=g.measureText(M).width,S=g.measureText(A+M).width-(F+b);S&&d.kerning.push({first:Tr(A),second:Tr(M),amount:S})}}const x=new Vt(d,v,!0);return Vt.available[e]!==void 0&&Vt.uninstall(e),Vt.available[e]=x,x}};let Ft=Vt;Ft.ALPHA=[["a","z"],["A","Z"]," "];Ft.NUMERIC=[["0","9"]];Ft.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Ft.ASCII=[[" ","~"]];Ft.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Vt.ALPHANUMERIC};Ft.available={};var ng=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,ag=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Ua=[],ka=[],Ga=[],gh=class extends Gt{constructor(e,t={}){super(),this._tint=16777215;const{align:i,tint:r,maxWidth:s,letterSpacing:n,fontName:a,fontSize:o}=Object.assign({},gh.styleDefaults,t);if(!Ft.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tint=r,this._font=void 0,this._fontName=a,this._fontSize=o,this.text=e,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new _e(()=>{this.dirty=!0},this,0,0),this._roundPixels=N.ROUND_PIXELS,this.dirty=!0,this._resolution=N.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var F;const e=Ft.available[this._fontName],t=this.fontSize,i=t/e.size,r=new q,s=[],n=[],a=[],o=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",h=mh(o),l=this._maxWidth*e.size/t,c=e.distanceFieldType==="none"?Ua:ka;let u=null,d=0,f=0,p=0,m=-1,g=0,y=0,_=0,v=0;for(let b=0;b<h.length;b++){const R=h[b],S=Tr(R);if(/(?:\s)/.test(R)&&(m=b,g=d,v++),R==="\r"||R===`
`){n.push(d),a.push(-1),f=Math.max(f,d),++p,++y,r.x=0,r.y+=e.lineHeight,u=null,v=0;continue}const E=e.chars[S];if(!E)continue;u&&E.kerning[u]&&(r.x+=E.kerning[u]);const j=Ga.pop()||{texture:k.EMPTY,line:0,charCode:0,prevSpaces:0,position:new q};j.texture=E.texture,j.line=p,j.charCode=S,j.position.x=Math.round(r.x+E.xOffset+this._letterSpacing/2),j.position.y=Math.round(r.y+E.yOffset),j.prevSpaces=v,s.push(j),d=j.position.x+Math.max(E.xAdvance-E.xOffset,E.texture.orig.width),r.x+=E.xAdvance+this._letterSpacing,_=Math.max(_,E.yOffset+E.texture.height),u=S,m!==-1&&l>0&&r.x>l&&(++y,ri(s,1+m-y,1+b-m),b=m,m=-1,n.push(g),a.push(s.length>0?s[s.length-1].prevSpaces:0),f=Math.max(f,g),p++,r.x=0,r.y+=e.lineHeight,u=null,v=0)}const x=h[h.length-1];x!=="\r"&&x!==`
`&&(/(?:\s)/.test(x)&&(d=g),n.push(d),f=Math.max(f,d),a.push(-1));const T=[];for(let b=0;b<=p;b++){let R=0;this._align==="right"?R=f-n[b]:this._align==="center"?R=(f-n[b])/2:this._align==="justify"&&(R=a[b]<0?0:(f-n[b])/a[b]),T.push(R)}const C=s.length,A={},w=[],M=this._activePagesMeshData;c.push(...M);for(let b=0;b<C;b++){const R=s[b].texture,S=R.baseTexture.uid;if(!A[S]){let E=c.pop();if(!E){const $=new Mm;let D,Z;e.distanceFieldType==="none"?(D=new Fa(k.EMPTY),Z=X.NORMAL):(D=new Fa(k.EMPTY,{program:qt.from(ag,ng),uniforms:{uFWidth:0}}),Z=X.NORMAL_NPM);const Q=new on($,D);Q.blendMode=Z,E={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Q,vertices:null,uvs:null,indices:null}}E.index=0,E.indexCount=0,E.vertexCount=0,E.uvsCount=0,E.total=0;const{_textureCache:j}=this;j[S]=j[S]||new k(R.baseTexture),E.mesh.texture=j[S],E.mesh.tint=this._tint,w.push(E),A[S]=E}A[S].total++}for(let b=0;b<M.length;b++)w.includes(M[b])||this.removeChild(M[b].mesh);for(let b=0;b<w.length;b++)w[b].mesh.parent!==this&&this.addChild(w[b].mesh);this._activePagesMeshData=w;for(const b in A){const R=A[b],S=R.total;if(!(((F=R.indices)==null?void 0:F.length)>6*S)||R.vertices.length<on.BATCHABLE_SIZE*2)R.vertices=new Float32Array(4*2*S),R.uvs=new Float32Array(4*2*S),R.indices=new Uint16Array(6*S);else{const E=R.total,j=R.vertices;for(let $=E*4*2;$<j.length;$++)j[$]=0}R.mesh.size=6*S}for(let b=0;b<C;b++){const R=s[b];let S=R.position.x+T[R.line]*(this._align==="justify"?R.prevSpaces:1);this._roundPixels&&(S=Math.round(S));const E=S*i,j=R.position.y*i,$=R.texture,D=A[$.baseTexture.uid],Z=$.frame,Q=$._uvs,I=D.index++;D.indices[I*6+0]=0+I*4,D.indices[I*6+1]=1+I*4,D.indices[I*6+2]=2+I*4,D.indices[I*6+3]=0+I*4,D.indices[I*6+4]=2+I*4,D.indices[I*6+5]=3+I*4,D.vertices[I*8+0]=E,D.vertices[I*8+1]=j,D.vertices[I*8+2]=E+Z.width*i,D.vertices[I*8+3]=j,D.vertices[I*8+4]=E+Z.width*i,D.vertices[I*8+5]=j+Z.height*i,D.vertices[I*8+6]=E,D.vertices[I*8+7]=j+Z.height*i,D.uvs[I*8+0]=Q.x0,D.uvs[I*8+1]=Q.y0,D.uvs[I*8+2]=Q.x1,D.uvs[I*8+3]=Q.y1,D.uvs[I*8+4]=Q.x2,D.uvs[I*8+5]=Q.y2,D.uvs[I*8+6]=Q.x3,D.uvs[I*8+7]=Q.y3}this._textWidth=f*i,this._textHeight=(r.y+e.lineHeight)*i;for(const b in A){const R=A[b];if(this.anchor.x!==0||this.anchor.y!==0){let $=0;const D=this._textWidth*this.anchor.x,Z=this._textHeight*this.anchor.y;for(let Q=0;Q<R.total;Q++)R.vertices[$++]-=D,R.vertices[$++]-=Z,R.vertices[$++]-=D,R.vertices[$++]-=Z,R.vertices[$++]-=D,R.vertices[$++]-=Z,R.vertices[$++]-=D,R.vertices[$++]-=Z}this._maxLineHeight=_*i;const S=R.mesh.geometry.getBuffer("aVertexPosition"),E=R.mesh.geometry.getBuffer("aTextureCoord"),j=R.mesh.geometry.getIndex();S.data=R.vertices,E.data=R.uvs,j.data=R.indices,S.update(),E.update(),j.update()}for(let b=0;b<s.length;b++)Ga.push(s[b]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:r}=Ft.available[this._fontName];if(i!=="none"){const{a:s,b:n,c:a,d:o}=this.worldTransform,h=Math.sqrt(s*s+n*n),l=Math.sqrt(a*a+o*o),c=(Math.abs(h)+Math.abs(l))/2,u=this.fontSize/r,d=e._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Ft.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(e){if(this._tint!==e){this._tint=e;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Ft.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Ft.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,r=Ft.available[this._fontName].distanceFieldType==="none"?Ua:ka;r.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>t[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=k.EMPTY});for(const s in t)t[s].destroy(),delete t[s];this._font=null,this._textureCache=null,super.destroy(e)}};let og=gh;og.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const hg=[".xml",".fnt"],lg={extension:{type:B.LoadParser,priority:ce.Normal},test(e){return hg.includes(Ct.extname(e).toLowerCase())},async testParse(e){return Er.test(e)||un.test(e)},async parse(e,t,i){const r=Er.test(e)?Er.parse(e):un.parse(e),{src:s}=t,{page:n}=r,a=[];for(let l=0;l<n.length;++l){const c=n[l].file;let u=Ct.join(Ct.dirname(s),c);u=sn(u,s),a.push(u)}const o=await i.load(a),h=a.map(l=>o[l]);return Ft.install(r,h,!0)},async load(e,t){return(await N.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};G.add(lg);var Ut={},yi={},dr,cg=new Uint8Array(16);function vh(){if(!dr&&(dr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!dr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return dr(cg)}const ug=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Qr(e){return typeof e=="string"&&ug.test(e)}var Tt=[];for(var Cs=0;Cs<256;++Cs)Tt.push((Cs+256).toString(16).substr(1));function ts(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(Tt[e[t+0]]+Tt[e[t+1]]+Tt[e[t+2]]+Tt[e[t+3]]+"-"+Tt[e[t+4]]+Tt[e[t+5]]+"-"+Tt[e[t+6]]+Tt[e[t+7]]+"-"+Tt[e[t+8]]+Tt[e[t+9]]+"-"+Tt[e[t+10]]+Tt[e[t+11]]+Tt[e[t+12]]+Tt[e[t+13]]+Tt[e[t+14]]+Tt[e[t+15]]).toLowerCase();if(!Qr(i))throw TypeError("Stringified UUID is invalid");return i}var Ha,Is,Rs=0,Ps=0;function dg(e,t,i){var r=t&&i||0,s=t||new Array(16);e=e||{};var n=e.node||Ha,a=e.clockseq!==void 0?e.clockseq:Is;if(n==null||a==null){var o=e.random||(e.rng||vh)();n==null&&(n=Ha=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),a==null&&(a=Is=(o[6]<<8|o[7])&16383)}var h=e.msecs!==void 0?e.msecs:Date.now(),l=e.nsecs!==void 0?e.nsecs:Ps+1,c=h-Rs+(l-Ps)/1e4;if(c<0&&e.clockseq===void 0&&(a=a+1&16383),(c<0||h>Rs)&&e.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Rs=h,Ps=l,Is=a,h+=122192928e5;var u=((h&268435455)*1e4+l)%4294967296;s[r++]=u>>>24&255,s[r++]=u>>>16&255,s[r++]=u>>>8&255,s[r++]=u&255;var d=h/4294967296*1e4&268435455;s[r++]=d>>>8&255,s[r++]=d&255,s[r++]=d>>>24&15|16,s[r++]=d>>>16&255,s[r++]=a>>>8|128,s[r++]=a&255;for(var f=0;f<6;++f)s[r+f]=n[f];return t||ts(s)}function yh(e){if(!Qr(e))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=t&255,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=t&255,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=t&255,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=t&255,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=t&255,i}function fg(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}var pg="6ba7b810-9dad-11d1-80b4-00c04fd430c8",mg="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function _h(e,t,i){function r(s,n,a,o){if(typeof s=="string"&&(s=fg(s)),typeof n=="string"&&(n=yh(n)),n.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var h=new Uint8Array(16+s.length);if(h.set(n),h.set(s,n.length),h=i(h),h[6]=h[6]&15|t,h[8]=h[8]&63|128,a){o=o||0;for(var l=0;l<16;++l)a[o+l]=h[l];return a}return ts(h)}try{r.name=e}catch{}return r.DNS=pg,r.URL=mg,r}function gg(e){if(typeof e=="string"){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return vg(yg(_g(e),e.length*8))}function vg(e){for(var t=[],i=e.length*32,r="0123456789abcdef",s=0;s<i;s+=8){var n=e[s>>5]>>>s%32&255,a=parseInt(r.charAt(n>>>4&15)+r.charAt(n&15),16);t.push(a)}return t}function xh(e){return(e+64>>>9<<4)+14+1}function yg(e,t){e[t>>5]|=128<<t%32,e[xh(t)-1]=t;for(var i=1732584193,r=-271733879,s=-1732584194,n=271733878,a=0;a<e.length;a+=16){var o=i,h=r,l=s,c=n;i=Rt(i,r,s,n,e[a],7,-680876936),n=Rt(n,i,r,s,e[a+1],12,-389564586),s=Rt(s,n,i,r,e[a+2],17,606105819),r=Rt(r,s,n,i,e[a+3],22,-1044525330),i=Rt(i,r,s,n,e[a+4],7,-176418897),n=Rt(n,i,r,s,e[a+5],12,1200080426),s=Rt(s,n,i,r,e[a+6],17,-1473231341),r=Rt(r,s,n,i,e[a+7],22,-45705983),i=Rt(i,r,s,n,e[a+8],7,1770035416),n=Rt(n,i,r,s,e[a+9],12,-1958414417),s=Rt(s,n,i,r,e[a+10],17,-42063),r=Rt(r,s,n,i,e[a+11],22,-1990404162),i=Rt(i,r,s,n,e[a+12],7,1804603682),n=Rt(n,i,r,s,e[a+13],12,-40341101),s=Rt(s,n,i,r,e[a+14],17,-1502002290),r=Rt(r,s,n,i,e[a+15],22,1236535329),i=Pt(i,r,s,n,e[a+1],5,-165796510),n=Pt(n,i,r,s,e[a+6],9,-1069501632),s=Pt(s,n,i,r,e[a+11],14,643717713),r=Pt(r,s,n,i,e[a],20,-373897302),i=Pt(i,r,s,n,e[a+5],5,-701558691),n=Pt(n,i,r,s,e[a+10],9,38016083),s=Pt(s,n,i,r,e[a+15],14,-660478335),r=Pt(r,s,n,i,e[a+4],20,-405537848),i=Pt(i,r,s,n,e[a+9],5,568446438),n=Pt(n,i,r,s,e[a+14],9,-1019803690),s=Pt(s,n,i,r,e[a+3],14,-187363961),r=Pt(r,s,n,i,e[a+8],20,1163531501),i=Pt(i,r,s,n,e[a+13],5,-1444681467),n=Pt(n,i,r,s,e[a+2],9,-51403784),s=Pt(s,n,i,r,e[a+7],14,1735328473),r=Pt(r,s,n,i,e[a+12],20,-1926607734),i=Mt(i,r,s,n,e[a+5],4,-378558),n=Mt(n,i,r,s,e[a+8],11,-2022574463),s=Mt(s,n,i,r,e[a+11],16,1839030562),r=Mt(r,s,n,i,e[a+14],23,-35309556),i=Mt(i,r,s,n,e[a+1],4,-1530992060),n=Mt(n,i,r,s,e[a+4],11,1272893353),s=Mt(s,n,i,r,e[a+7],16,-155497632),r=Mt(r,s,n,i,e[a+10],23,-1094730640),i=Mt(i,r,s,n,e[a+13],4,681279174),n=Mt(n,i,r,s,e[a],11,-358537222),s=Mt(s,n,i,r,e[a+3],16,-722521979),r=Mt(r,s,n,i,e[a+6],23,76029189),i=Mt(i,r,s,n,e[a+9],4,-640364487),n=Mt(n,i,r,s,e[a+12],11,-421815835),s=Mt(s,n,i,r,e[a+15],16,530742520),r=Mt(r,s,n,i,e[a+2],23,-995338651),i=Dt(i,r,s,n,e[a],6,-198630844),n=Dt(n,i,r,s,e[a+7],10,1126891415),s=Dt(s,n,i,r,e[a+14],15,-1416354905),r=Dt(r,s,n,i,e[a+5],21,-57434055),i=Dt(i,r,s,n,e[a+12],6,1700485571),n=Dt(n,i,r,s,e[a+3],10,-1894986606),s=Dt(s,n,i,r,e[a+10],15,-1051523),r=Dt(r,s,n,i,e[a+1],21,-2054922799),i=Dt(i,r,s,n,e[a+8],6,1873313359),n=Dt(n,i,r,s,e[a+15],10,-30611744),s=Dt(s,n,i,r,e[a+6],15,-1560198380),r=Dt(r,s,n,i,e[a+13],21,1309151649),i=Dt(i,r,s,n,e[a+4],6,-145523070),n=Dt(n,i,r,s,e[a+11],10,-1120210379),s=Dt(s,n,i,r,e[a+2],15,718787259),r=Dt(r,s,n,i,e[a+9],21,-343485551),i=xe(i,o),r=xe(r,h),s=xe(s,l),n=xe(n,c)}return[i,r,s,n]}function _g(e){if(e.length===0)return[];for(var t=e.length*8,i=new Uint32Array(xh(t)),r=0;r<t;r+=8)i[r>>5]|=(e[r/8]&255)<<r%32;return i}function xe(e,t){var i=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(i>>16);return r<<16|i&65535}function xg(e,t){return e<<t|e>>>32-t}function es(e,t,i,r,s,n){return xe(xg(xe(xe(t,e),xe(r,n)),s),i)}function Rt(e,t,i,r,s,n,a){return es(t&i|~t&r,e,t,s,n,a)}function Pt(e,t,i,r,s,n,a){return es(t&r|i&~r,e,t,s,n,a)}function Mt(e,t,i,r,s,n,a){return es(t^i^r,e,t,s,n,a)}function Dt(e,t,i,r,s,n,a){return es(i^(t|~r),e,t,s,n,a)}var bg=_h("v3",48,gg);const Eg=bg;function Tg(e,t,i){e=e||{};var r=e.random||(e.rng||vh)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){i=i||0;for(var s=0;s<16;++s)t[i+s]=r[s];return t}return ts(r)}function wg(e,t,i,r){switch(e){case 0:return t&i^~t&r;case 1:return t^i^r;case 2:return t&i^t&r^i&r;case 3:return t^i^r}}function Ms(e,t){return e<<t|e>>>32-t}function Sg(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){var r=unescape(encodeURIComponent(e));e=[];for(var s=0;s<r.length;++s)e.push(r.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=e.length/4+2,a=Math.ceil(n/16),o=new Array(a),h=0;h<a;++h){for(var l=new Uint32Array(16),c=0;c<16;++c)l[c]=e[h*64+c*4]<<24|e[h*64+c*4+1]<<16|e[h*64+c*4+2]<<8|e[h*64+c*4+3];o[h]=l}o[a-1][14]=(e.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(e.length-1)*8&4294967295;for(var u=0;u<a;++u){for(var d=new Uint32Array(80),f=0;f<16;++f)d[f]=o[u][f];for(var p=16;p<80;++p)d[p]=Ms(d[p-3]^d[p-8]^d[p-14]^d[p-16],1);for(var m=i[0],g=i[1],y=i[2],_=i[3],v=i[4],x=0;x<80;++x){var T=Math.floor(x/20),C=Ms(m,5)+wg(T,g,y,_)+v+t[T]+d[x]>>>0;v=_,_=y,y=Ms(g,30)>>>0,g=m,m=C}i[0]=i[0]+m>>>0,i[1]=i[1]+g>>>0,i[2]=i[2]+y>>>0,i[3]=i[3]+_>>>0,i[4]=i[4]+v>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}var Ag=_h("v5",80,Sg);const Cg=Ag,Ig="00000000-0000-0000-0000-000000000000";function Rg(e){if(!Qr(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}const Pg=Object.freeze(Object.defineProperty({__proto__:null,NIL:Ig,parse:yh,stringify:ts,v1:dg,v3:Eg,v4:Tg,v5:Cg,validate:Qr,version:Rg},Symbol.toStringTag,{value:"Module"})),Mg=$h(Pg);var _i={},xi={},Xa;function bh(){if(Xa)return xi;Xa=1;var e=_t&&_t.__values||function(s){var n=typeof Symbol=="function"&&Symbol.iterator,a=n&&s[n],o=0;if(a)return a.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&o>=s.length&&(s=void 0),{value:s&&s[o++],done:!s}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},t=_t&&_t.__read||function(s,n){var a=typeof Symbol=="function"&&s[Symbol.iterator];if(!a)return s;var o=a.call(s),h,l=[],c;try{for(;(n===void 0||n-- >0)&&!(h=o.next()).done;)l.push(h.value)}catch(u){c={error:u}}finally{try{h&&!h.done&&(a=o.return)&&a.call(o)}finally{if(c)throw c.error}}return l};Object.defineProperty(xi,"__esModule",{value:!0}),xi.SystemManager=void 0;var i=Dn(),r=function(){function s(){}return s.add=function(n){var a,o;if(s.systems.has(n))throw new Error("You're attempting to add the same system twice, please remove the duplicate add call.");var h=new n,l=function(m,g){var y=h.components.every(function(_){return g.has(_.name)});y&&h.add(m)};try{for(var c=e(i.EntityManager.entities.entries()),u=c.next();!u.done;u=c.next()){var d=t(u.value,2),f=d[0],p=d[1];l(f,p)}}catch(m){a={error:m}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}s.systems.set(n,h)},s.get=function(n){return s.systems.get(n)},s.getAll=function(){return s.systems},s.update=function(){var n,a;try{for(var o=e(s.systems.values()),h=o.next();!h.done;h=o.next()){var l=h.value;l.onUpdate()}}catch(c){n={error:c}}finally{try{h&&!h.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}},s.handleEntityComponentsChanged=function(n,a,o){var h,l;if(i.EntityManager.entities.has(n)){var c=i.EntityManager.entities.get(n);try{for(var u=e(s.systems.values()),d=u.next();!d.done;d=u.next()){var f=d.value,p=o==="removed"?!f.components.includes(a):f.components.every(function(m){return c.has(m.name)});f.has(n)?o==="removed"&&!p&&f.remove(n):o==="added"&&p&&f.add(n)}}catch(m){h={error:m}}finally{try{d&&!d.done&&(l=u.return)&&l.call(u)}finally{if(h)throw h.error}}}},s.systems=new Map,s}();return xi.SystemManager=r,xi}var ja;function Dn(){if(ja)return _i;ja=1;var e=_t&&_t.__read||function(n,a){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var h=o.call(n),l,c=[],u;try{for(;(a===void 0||a-- >0)&&!(l=h.next()).done;)c.push(l.value)}catch(d){u={error:d}}finally{try{l&&!l.done&&(o=h.return)&&o.call(h)}finally{if(u)throw u.error}}return c},t=_t&&_t.__spreadArray||function(n,a,o){if(o||arguments.length===2)for(var h=0,l=a.length,c;h<l;h++)(c||!(h in a))&&(c||(c=Array.prototype.slice.call(a,0,h)),c[h]=a[h]);return n.concat(c||Array.prototype.slice.call(a))};Object.defineProperty(_i,"__esModule",{value:!0}),_i.EntityManager=void 0;var i=bh(),r=Eh(),s=function(){function n(){}return n.removeComponentFromEntity=function(a,o){n.entities.has(a)&&(i.SystemManager.handleEntityComponentsChanged(a,o,"removed"),n.entities.get(a).delete(o.name))},n.entityHasComponent=function(a,o){return n.entities.has(a)?n.entities.get(a).has(o.name):!1},n.getComponentForEntity=function(a,o){return n.entities.has(a)&&n.entities.get(a).get(o.name)||null},n.entities=new Map,n.createEntity=function(){return new r.Entity},n.addComponentToEntity=function(a,o){for(var h=[],l=2;l<arguments.length;l++)h[l-2]=arguments[l];if(n.entities.has(a)||n.entities.set(a,new Map),n.entities.get(a).has(o.name))throw new Error("Entity already has this component.");n.entities.get(a).set(o.name,new(o.bind.apply(o,t([void 0],e(h),!1)))),i.SystemManager.handleEntityComponentsChanged(a,o,"added")},n.getAllEntitiesWithComponents=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var h=[];return n.entities.forEach(function(l,c){var u=a.some(function(d){return!l.has(d.name)});u||h.push(new r.Entity(c))}),h},n.destroyEntity=function(a){if(n.entities.has(a)){var o=new r.Entity(a);n.entities.get(a).forEach(function(h){o.removeComponent(h.constructor)}),n.entities.delete(a)}},n}();return _i.EntityManager=s,_i}var za;function Eh(){if(za)return yi;za=1;var e=_t&&_t.__read||function(n,a){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var h=o.call(n),l,c=[],u;try{for(;(a===void 0||a-- >0)&&!(l=h.next()).done;)c.push(l.value)}catch(d){u={error:d}}finally{try{l&&!l.done&&(o=h.return)&&o.call(h)}finally{if(u)throw u.error}}return c},t=_t&&_t.__spreadArray||function(n,a,o){if(o||arguments.length===2)for(var h=0,l=a.length,c;h<l;h++)(c||!(h in a))&&(c||(c=Array.prototype.slice.call(a,0,h)),c[h]=a[h]);return n.concat(c||Array.prototype.slice.call(a))};Object.defineProperty(yi,"__esModule",{value:!0}),yi.Entity=void 0;var i=Mg,r=Dn(),s=function(){function n(a){a===void 0&&(a=(0,i.v4)()),this.id=a}return n.prototype.addComponent=function(a){for(var o=[],h=1;h<arguments.length;h++)o[h-1]=arguments[h];return r.EntityManager.addComponentToEntity.apply(r.EntityManager,t([this.id,a],e(o),!1)),this},n.prototype.removeComponent=function(a){return r.EntityManager.removeComponentFromEntity(this.id,a),this},n.prototype.hasComponent=function(a){return r.EntityManager.entityHasComponent(this.id,a)},n.prototype.hasComponents=function(){for(var a=this,o=[],h=0;h<arguments.length;h++)o[h]=arguments[h];return o.every(function(l){return a.hasComponent(l)})},n.prototype.getComponent=function(a){return r.EntityManager.getComponentForEntity(this.id,a)},n.prototype.destroy=function(){r.EntityManager.destroyEntity(this.id)},n}();return yi.Entity=s,yi}var is={};Object.defineProperty(is,"__esModule",{value:!0});is.System=void 0;var Dg=function(){function e(){this.entities=new Set}return e.prototype.getEntities=function(){return this.entities},e.prototype.add=function(t){this.entities.add(t),this.onEntityAdded(t)},e.prototype.remove=function(t){this.entities.delete(t),this.onEntityRemoved(t)},e.prototype.has=function(t){return this.entities.has(t)},e.prototype.onEntityAdded=function(t){},e.prototype.onEntityRemoved=function(t){},e.prototype.onUpdate=function(){},e}();is.System=Dg;(function(e){var t=_t&&_t.__createBinding||(Object.create?function(r,s,n,a){a===void 0&&(a=n);var o=Object.getOwnPropertyDescriptor(s,n);(!o||("get"in o?!s.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return s[n]}}),Object.defineProperty(r,a,o)}:function(r,s,n,a){a===void 0&&(a=n),r[a]=s[n]}),i=_t&&_t.__exportStar||function(r,s){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(s,n)&&t(s,r,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(Eh(),e),i(Dn(),e),i(is,e),i(bh(),e)})(Ut);const ne={width:800,height:600};class Ui{constructor(t,i){ut(this,"_state");ut(this,"_highlightAlpha",1);ut(this,"_elapsedTime",0);ut(this,"_duration",1);ut(this,"mainSprite");ut(this,"highlightSprite");this.mainSprite=t,this.highlightSprite=i,this.highlightSprite.alpha=0}enterHighlight(){this._elapsedTime=0,this._highlightAlpha=1,this.highlightSprite.alpha=this._highlightAlpha}enterNormal(){this._highlightAlpha=1,this.highlightSprite.alpha=0}updateHighlight(t){this.updateAlpha(t)}setX(t){this.mainSprite.x=t,this.highlightSprite.x=t}setY(t){this.mainSprite.y=t,this.highlightSprite.y=t}get width(){return this.mainSprite.width}get height(){return this.mainSprite.height}get state(){return this._state}set state(t){this._state=t}get fadeComplete(){return this.highlightSprite.alpha<=0&&this._state.value==="Fading"}easeOutCubic(t){return--t*t*t+1}updateAlpha(t){this._elapsedTime+=t;const i=Math.min(this._elapsedTime/this._duration,1),r=1-this.easeOutCubic(i);this.highlightSprite.alpha=r}}class hi{constructor(t,i){ut(this,"x");ut(this,"y");this.x=t,this.y=i}}class kr{constructor(t){ut(this,"x");ut(this,"y");ut(this,"speed");this.x=1,this.y=1,this.speed=t}}class Th{}class Bg extends Ut.System{constructor(){super(...arguments);ut(this,"components",[hi,Ui])}onUpdate(){this.entities.forEach(i=>{const r=new Ut.Entity(i),s=r.getComponent(hi),n=r.getComponent(Ui);!s||!n||(n.setX(s.x),n.setY(s.y))})}}class Fg extends Ut.System{constructor(){super(...arguments);ut(this,"components",[hi,kr])}onUpdate(){this.entities.forEach(i=>{const r=new Ut.Entity(i),s=r.getComponent(hi),n=r.getComponent(kr);!s||!n||(s.x+=n.x*n.speed,s.y+=n.y*n.speed)})}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var U=function(){return U=Object.assign||function(t){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},U.apply(this,arguments)};function Bn(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i}function ht(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tt(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),s,n=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)n.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return n}function at(e,t,i){if(i||arguments.length===2)for(var r=0,s=t.length,n;r<s;r++)(n||!(r in t))&&(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}var it;(function(e){e.Start="xstate.start",e.Stop="xstate.stop",e.Raise="xstate.raise",e.Send="xstate.send",e.Cancel="xstate.cancel",e.NullEvent="",e.Assign="xstate.assign",e.After="xstate.after",e.DoneState="done.state",e.DoneInvoke="done.invoke",e.Log="xstate.log",e.Init="xstate.init",e.Invoke="xstate.invoke",e.ErrorExecution="error.execution",e.ErrorCommunication="error.communication",e.ErrorPlatform="error.platform",e.ErrorCustom="xstate.error",e.Update="xstate.update",e.Pure="xstate.pure",e.Choose="xstate.choose"})(it||(it={}));var li;(function(e){e.Parent="#_parent",e.Internal="#_internal"})(li||(li={}));var Va=it.Start,wh=it.Stop,ki=it.Raise,Gr=it.Send,Ng=it.Cancel,Og=it.NullEvent,Sh=it.Assign;it.After;it.DoneState;var Lg=it.Log,Ug=it.Init,dn=it.Invoke;it.ErrorExecution;it.ErrorPlatform;it.ErrorCustom;var kg=it.Update,Gg=it.Choose,Hg=it.Pure,Ah=".",$a={},fn="xstate.guard",Xg="",jg=!0,fr;function Fn(e,t,i){i===void 0&&(i=Ah);var r=Ii(e,i),s=Ii(t,i);return et(s)?et(r)?s===r:!1:et(r)?r in s:Object.keys(r).every(function(n){return n in s?Fn(r[n],s[n]):!1})}function Ch(e){try{return et(e)||typeof e=="number"?"".concat(e):e.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function pn(e,t){try{return Vi(e)?e:e.toString().split(t)}catch{throw new Error("'".concat(e,"' is not a valid state path."))}}function zg(e){return typeof e=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e}function Ii(e,t){if(zg(e))return e.value;if(Vi(e))return Hr(e);if(typeof e!="string")return e;var i=pn(e,t);return Hr(i)}function Hr(e){if(e.length===1)return e[0];for(var t={},i=t,r=0;r<e.length-1;r++)r===e.length-2?i[e[r]]=e[r+1]:(i[e[r]]={},i=i[e[r]]);return t}function Si(e,t){for(var i={},r=Object.keys(e),s=0;s<r.length;s++){var n=r[s];i[n]=t(e[n],n,e,s)}return i}function Wa(e,t,i){var r,s,n={};try{for(var a=ht(Object.keys(e)),o=a.next();!o.done;o=a.next()){var h=o.value,l=e[h];i(l)&&(n[h]=t(l,h,e))}}catch(c){r={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return n}var Vg=function(e){return function(t){var i,r,s=t;try{for(var n=ht(e),a=n.next();!a.done;a=n.next()){var o=a.value;s=s[o]}}catch(h){i={error:h}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return s}};function $g(e,t){return function(i){var r,s,n=i;try{for(var a=ht(e),o=a.next();!o.done;o=a.next()){var h=o.value;n=n[t][h]}}catch(l){r={error:l}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return n}}function wr(e){if(!e)return[[]];if(et(e))return[[e]];var t=dt(Object.keys(e).map(function(i){var r=e[i];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[i]]:wr(e[i]).map(function(s){return[i].concat(s)})}));return t}function dt(e){var t;return(t=[]).concat.apply(t,at([],tt(e),!1))}function Ih(e){return Vi(e)?e:[e]}function $t(e){return e===void 0?[]:Ih(e)}function Rh(e,t,i){var r,s;if(xt(e))return e(t,i.data);var n={};try{for(var a=ht(Object.keys(e)),o=a.next();!o.done;o=a.next()){var h=o.value,l=e[h];xt(l)?n[h]=l(t,i.data):n[h]=l}}catch(c){r={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}return n}function Wg(e){return/^(done|error)\./.test(e)}function Yg(e,t){var i,r,s=tt([[],[]],2),n=s[0],a=s[1];try{for(var o=ht(e),h=o.next();!h.done;h=o.next()){var l=h.value;t(l)?n.push(l):a.push(l)}}catch(c){i={error:c}}finally{try{h&&!h.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return[n,a]}function Ph(e,t){return Si(e.states,function(i,r){if(i){var s=(et(t)?void 0:t[r])||(i?i.current:void 0);if(s)return{current:s,states:Ph(i,s)}}})}function qg(e,t){return{current:t,states:Ph(e,t)}}function Ya(e,t,i,r){var s=e&&i.reduce(function(n,a){var o,h,l=a.assignment,c={state:r,action:a,_event:t},u={};if(xt(l))u=l(n,t.data,c);else try{for(var d=ht(Object.keys(l)),f=d.next();!f.done;f=d.next()){var p=f.value,m=l[p];u[p]=xt(m)?m(n,t.data,c):m}}catch(g){o={error:g}}finally{try{f&&!f.done&&(h=d.return)&&h.call(d)}finally{if(o)throw o.error}}return Object.assign({},n,u)},e);return s}var Kg=function(){};function Vi(e){return Array.isArray(e)}function xt(e){return typeof e=="function"}function et(e){return typeof e=="string"}function Mh(e,t){if(e)return et(e)?{type:fn,name:e,predicate:t?t[e]:void 0}:xt(e)?{type:fn,name:e.name,predicate:e}:e}var Dh=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();fr={},fr[Dh]=function(){return this},fr[Symbol.observable]=function(){return this};function Xr(e){return!!e&&"__xstatenode"in e}function Bh(e,t){return et(e)||typeof e=="number"?U({type:e},t):e}function Gi(e,t){if(!et(e)&&"$$type"in e&&e.$$type==="scxml")return e;var i=Bh(e);return U({name:i.type,data:i,$$type:"scxml",type:"external"},t)}function Ve(e,t){var i=Ih(t).map(function(r){return typeof r>"u"||typeof r=="string"||Xr(r)?{target:r,event:e}:U(U({},r),{event:e})});return i}function Zg(e){if(!(e===void 0||e===Xg))return $t(e)}function Fh(e,t,i,r,s){var n=e.options.guards,a={state:s,cond:t,_event:r};if(t.type===fn)return((n==null?void 0:n[t.name])||t.predicate)(i,r.data,a);var o=n==null?void 0:n[t.type];if(!o)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return o(i,r.data,a)}function Jg(e){return typeof e=="string"?{type:e}:e}function pr(e,t){return"".concat(e,":invocation[").concat(t,"]")}var mn=Gi({type:Ug});function qa(e,t){return t&&t[e]||void 0}function Hi(e,t){var i;if(et(e)||typeof e=="number"){var r=qa(e,t);xt(r)?i={type:e,exec:r}:r?i=r:i={type:e,exec:void 0}}else if(xt(e))i={type:e.name||e.toString(),exec:e};else{var r=qa(e.type,t);if(xt(r))i=U(U({},e),{exec:r});else if(r){var s=r.type||e.type;i=U(U(U({},r),e),{type:s})}else i=e}return i}var Be=function(e,t){if(!e)return[];var i=Vi(e)?e:[e];return i.map(function(r){return Hi(r,t)})};function Nn(e){var t=Hi(e);return U(U({id:et(e)?e:t.id},t),{type:t.type})}function Qg(e){return et(e)?{type:ki,event:e}:Nh(e,{to:li.Internal})}function tv(e){return{type:ki,_event:Gi(e.event)}}function Nh(e,t){return{to:t?t.to:void 0,type:Gr,event:xt(e)?e:Bh(e),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:xt(e)?e.name:Ch(e)}}function ev(e,t,i,r){var s={_event:i},n=Gi(xt(e.event)?e.event(t,i.data,s):e.event),a;if(et(e.delay)){var o=r&&r[e.delay];a=xt(o)?o(t,i.data,s):o}else a=xt(e.delay)?e.delay(t,i.data,s):e.delay;var h=xt(e.to)?e.to(t,i.data,s):e.to;return U(U({},e),{to:h,_event:n,event:n.data,delay:a})}var iv=function(e,t,i){return U(U({},e),{value:et(e.expr)?e.expr:e.expr(t,i.data,{_event:i})})},rv=function(e){return{type:Ng,sendId:e}};function sv(e){var t=Nn(e);return{type:it.Start,activity:t,exec:void 0}}function nv(e){var t=xt(e)?e:Nn(e);return{type:it.Stop,activity:t,exec:void 0}}function av(e,t,i){var r=xt(e.activity)?e.activity(t,i.data):e.activity,s=typeof r=="string"?{id:r}:r,n={type:it.Stop,activity:s};return n}function ov(e,t){var i=t?"#".concat(t):"";return"".concat(it.After,"(").concat(e,")").concat(i)}function mr(e,t){var i="".concat(it.DoneState,".").concat(e),r={type:i,data:t};return r.toString=function(){return i},r}function hv(e,t){var i="".concat(it.DoneInvoke,".").concat(e),r={type:i,data:t};return r.toString=function(){return i},r}function lv(e,t){var i="".concat(it.ErrorPlatform,".").concat(e),r={type:i,data:t};return r.toString=function(){return i},r}var cv=function(e){var t,i,r=[];try{for(var s=ht(e),n=s.next();!n.done;n=s.next())for(var a=n.value,o=0;o<a.actions.length;){if(a.actions[o].type===Sh){r.push(a.actions[o]),a.actions.splice(o,1);continue}o++}}catch(h){t={error:h}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return r};function gn(e,t,i,r,s,n,a){a===void 0&&(a=!1);var o=a?[]:cv(s),h=o.length?Ya(i,r,o,t):i,l=a?[i]:void 0,c=[];function u(p,m){var g;switch(m.type){case ki:return tv(m);case Gr:var y=ev(m,h,r,e.options.delays);return n&&y.to!==li.Internal&&(p==="entry"?c.push(y):n==null||n(y,h,r)),y;case Lg:{var _=iv(m,h,r);return n==null||n(_,h,r),_}case Gg:{var v=m,x=(g=v.conds.find(function(E){var j=Mh(E.cond,e.options.guards);return!j||Fh(e,j,h,r,n?void 0:t)}))===null||g===void 0?void 0:g.actions;if(!x)return[];var T=tt(gn(e,t,h,r,[{type:p,actions:Be($t(x),e.options.actions)}],n,a),2),C=T[0],A=T[1];return h=A,l==null||l.push(h),C}case Hg:{var x=m.get(h,r.data);if(!x)return[];var w=tt(gn(e,t,h,r,[{type:p,actions:Be($t(x),e.options.actions)}],n,a),2),M=w[0],F=w[1];return h=F,l==null||l.push(h),M}case wh:{var _=av(m,h,r);return n==null||n(_,i,r),_}case Sh:{h=Ya(h,r,[m],n?void 0:t),l==null||l.push(h);break}default:var b=Hi(m,e.options.actions),R=b.exec;if(n)n(b,h,r);else if(R&&l){var S=l.length-1;b=U(U({},b),{exec:function(E){for(var j=[],$=1;$<arguments.length;$++)j[$-1]=arguments[$];R.apply(void 0,at([l[S]],tt(j),!1))}})}return b}}function d(p){var m,g,y=[];try{for(var _=ht(p.actions),v=_.next();!v.done;v=_.next()){var x=v.value,T=u(p.type,x);T&&(y=y.concat(T))}}catch(C){m={error:C}}finally{try{v&&!v.done&&(g=_.return)&&g.call(_)}finally{if(m)throw m.error}}return c.forEach(function(C){n(C,h,r)}),c.length=0,y}var f=dt(s.map(d));return[f,h]}var uv=function(e,t){var i=t(e);return i};function Oh(e){var t;return t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}},t[Dh]=function(){return this},t}function dv(e,t,i,r){var s,n=Jg(e.src),a=(s=t==null?void 0:t.options.services)===null||s===void 0?void 0:s[n.type],o=e.data?Rh(e.data,i,r):void 0,h=a?fv(a,e.id,o):Oh(e.id);return h.meta=e,h}function fv(e,t,i){var r=Oh(t);if(r.deferred=!0,Xr(e)){var s=r.state=uv(void 0,function(){return(i?e.withContext(i):e).initialState});r.getSnapshot=function(){return s}}return r}var jr=function(e){return e.type==="atomic"||e.type==="final"};function Lh(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function Xi(e){return Lh(e).filter(function(t){return t.type!=="history"})}function Uh(e){var t=[e];return jr(e)?t:t.concat(dt(Xi(e).map(Uh)))}function Ai(e,t){var i,r,s,n,a,o,h,l,c=new Set(e),u=vn(c),d=new Set(t);try{for(var f=ht(d),p=f.next();!p.done;p=f.next())for(var m=p.value,g=m.parent;g&&!d.has(g);)d.add(g),g=g.parent}catch(M){i={error:M}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}var y=vn(d);try{for(var _=ht(d),v=_.next();!v.done;v=_.next()){var m=v.value;if(m.type==="compound"&&(!y.get(m)||!y.get(m).length))u.get(m)?u.get(m).forEach(function(F){return d.add(F)}):m.initialStateNodes.forEach(function(F){return d.add(F)});else if(m.type==="parallel")try{for(var x=(a=void 0,ht(Xi(m))),T=x.next();!T.done;T=x.next()){var C=T.value;d.has(C)||(d.add(C),u.get(C)?u.get(C).forEach(function(F){return d.add(F)}):C.initialStateNodes.forEach(function(F){return d.add(F)}))}}catch(F){a={error:F}}finally{try{T&&!T.done&&(o=x.return)&&o.call(x)}finally{if(a)throw a.error}}}}catch(M){s={error:M}}finally{try{v&&!v.done&&(n=_.return)&&n.call(_)}finally{if(s)throw s.error}}try{for(var A=ht(d),w=A.next();!w.done;w=A.next())for(var m=w.value,g=m.parent;g&&!d.has(g);)d.add(g),g=g.parent}catch(M){h={error:M}}finally{try{w&&!w.done&&(l=A.return)&&l.call(A)}finally{if(h)throw h.error}}return d}function kh(e,t){var i=t.get(e);if(!i)return{};if(e.type==="compound"){var r=i[0];if(r){if(jr(r))return r.key}else return{}}var s={};return i.forEach(function(n){s[n.key]=kh(n,t)}),s}function vn(e){var t,i,r=new Map;try{for(var s=ht(e),n=s.next();!n.done;n=s.next()){var a=n.value;r.has(a)||r.set(a,[]),a.parent&&(r.has(a.parent)||r.set(a.parent,[]),r.get(a.parent).push(a))}}catch(o){t={error:o}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return r}function pv(e,t){var i=Ai([e],t);return kh(e,vn(i))}function Ci(e,t){return Array.isArray(e)?e.some(function(i){return i===t}):e instanceof Set?e.has(t):!1}function mv(e){return at([],tt(new Set(dt(at([],tt(e.map(function(t){return t.ownEvents})),!1)))),!1)}function Sr(e,t){return t.type==="compound"?Xi(t).some(function(i){return i.type==="final"&&Ci(e,i)}):t.type==="parallel"?Xi(t).every(function(i){return Sr(e,i)}):!1}function gv(e){return e===void 0&&(e=[]),e.reduce(function(t,i){return i.meta!==void 0&&(t[i.id]=i.meta),t},{})}function Ka(e){return new Set(dt(e.map(function(t){return t.tags})))}function Gh(e,t){if(e===t)return!0;if(e===void 0||t===void 0)return!1;if(et(e)||et(t))return e===t;var i=Object.keys(e),r=Object.keys(t);return i.length===r.length&&i.every(function(s){return Gh(e[s],t[s])})}var ve=function(){function e(t){var i=this,r;this.actions=[],this.activities=$a,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||$a,this.meta=gv(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(r=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&r!==void 0?r:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return mv(i.configuration)}})}return e.from=function(t,i){if(t instanceof e)return t.context!==i?new e({value:t.value,context:i,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var r=mn;return new e({value:t,context:i,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,i){if(t instanceof e){if(!t.actions.length)return t;var r=mn;return new e({value:t.value,context:i,_event:r,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,i)},e.prototype.toStrings=function(t,i){var r=this;if(t===void 0&&(t=this.value),i===void 0&&(i="."),et(t))return[t];var s=Object.keys(t);return s.concat.apply(s,at([],tt(s.map(function(n){return r.toStrings(t[n],i).map(function(a){return n+i+a})})),!1))},e.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var i=t.tags;t.machine;var r=Bn(t,["configuration","transitions","tags","machine"]);return U(U({},r),{tags:Array.from(i)})},e.prototype.matches=function(t){return Fn(t,this.value)},e.prototype.hasTag=function(t){return this.tags.has(t)},e.prototype.can=function(t){var i;Kg(!!this.machine);var r=(i=this.machine)===null||i===void 0?void 0:i.getTransitionData(this,t);return!!(r!=null&&r.transitions.length)&&r.transitions.some(function(s){return s.target!==void 0||s.actions.length})},e}();function vv(e){if(typeof e=="string"){var t={type:e};return t.toString=function(){return e},t}return e}function gr(e){return U(U({type:dn},e),{toJSON:function(){e.onDone,e.onError;var t=Bn(e,["onDone","onError"]);return U(U({},t),{type:dn,src:vv(e.src)})}})}var vr="",yn="#",Ds="*",$e={},We=function(e){return e[0]===yn},yv=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},_v=function(){function e(t,i,r,s){r===void 0&&(r="context"in t?t.context:void 0);var n=this,a;this.config=t,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(yv(),i),this.parent=s==null?void 0:s.parent,this.key=this.config.key||(s==null?void 0:s.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:Ah),this.id=this.config.id||at([this.machine.key],tt(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(a=this.config.schema)!==null&&a!==void 0?a:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?Si(this.config.states,function(l,c){var u,d=new e(l,{},void 0,{parent:n,key:c});return Object.assign(n.idMap,U((u={},u[d.id]=d,u),d.idMap)),d}):$e;var o=0;function h(l){var c,u;l.order=o++;try{for(var d=ht(Lh(l)),f=d.next();!f.done;f=d.next()){var p=f.value;h(p)}}catch(m){c={error:m}}finally{try{f&&!f.done&&(u=d.return)&&u.call(d)}finally{if(c)throw c.error}}}h(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(l){var c=l.event;return c===vr}):vr in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=$t(this.config.entry||this.config.onEntry).map(function(l){return Hi(l)}),this.onExit=$t(this.config.exit||this.config.onExit).map(function(l){return Hi(l)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=$t(this.config.invoke).map(function(l,c){var u,d;if(Xr(l)){var f=pr(n.id,c);return n.machine.options.services=U((u={},u[f]=l,u),n.machine.options.services),gr({src:f,id:f})}else if(et(l.src)){var f=l.id||pr(n.id,c);return gr(U(U({},l),{id:f,src:l.src}))}else if(Xr(l.src)||xt(l.src)){var f=l.id||pr(n.id,c);return n.machine.options.services=U((d={},d[f]=l.src,d),n.machine.options.services),gr(U(U({id:f},l),{src:f}))}else{var p=l.src;return gr(U(U({id:pr(n.id,c)},l),{src:p}))}}),this.activities=$t(this.config.activities).concat(this.invoke).map(function(l){return Nn(l)}),this.transition=this.transition.bind(this),this.tags=$t(this.config.tags)}return e.prototype._init=function(){this.__cache.transitions||Uh(this).forEach(function(t){return t.on})},e.prototype.withConfig=function(t,i){var r=this.options,s=r.actions,n=r.activities,a=r.guards,o=r.services,h=r.delays;return new e(this.config,{actions:U(U({},s),t.actions),activities:U(U({},n),t.activities),guards:U(U({},a),t.guards),services:U(U({},o),t.services),delays:U(U({},h),t.delays)},i??this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return xt(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Si(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(i,r){return i[r.eventType]=i[r.eventType]||[],i[r.eventType].push(r),i},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var i=t===vr,r=this.transitions.filter(function(s){var n=s.eventType===t;return i?n:n||s.eventType===Ds});return this.__cache.candidates[t]=r,r},e.prototype.getDelayedTransitions=function(){var t=this,i=this.config.after;if(!i)return[];var r=function(n,a){var o=xt(n)?"".concat(t.id,":delay[").concat(a,"]"):n,h=ov(o,t.id);return t.onEntry.push(Nh(h,{delay:n})),t.onExit.push(rv(h)),h},s=Vi(i)?i.map(function(n,a){var o=r(n.delay,a);return U(U({},n),{event:o})}):dt(Object.keys(i).map(function(n,a){var o=i[n],h=et(o)?{target:o}:o,l=isNaN(+n)?n:+n,c=r(l,a);return $t(h).map(function(u){return U(U({},u),{event:c,delay:l})})}));return s.map(function(n){var a=n.delay;return U(U({},t.formatTransition(n)),{delay:a})})},e.prototype.getStateNodes=function(t){var i,r=this;if(!t)return[];var s=t instanceof ve?t.value:Ii(t,this.delimiter);if(et(s)){var n=this.getStateNode(s).initial;return n!==void 0?this.getStateNodes((i={},i[s]=n,i)):[this,this.states[s]]}var a=Object.keys(s),o=[this];return o.push.apply(o,at([],tt(dt(a.map(function(h){return r.getStateNode(h).getStateNodes(s[h])}))),!1)),o},e.prototype.handles=function(t){var i=Ch(t);return this.events.includes(i)},e.prototype.resolveState=function(t){var i=t instanceof ve?t:ve.create(t),r=Array.from(Ai([],this.getStateNodes(i.value)));return new ve(U(U({},i),{value:this.resolve(i.value),configuration:r,done:Sr(r,this),tags:Ka(r),machine:this.machine}))},e.prototype.transitionLeafNode=function(t,i,r){var s=this.getStateNode(t),n=s.next(i,r);return!n||!n.transitions.length?this.next(i,r):n},e.prototype.transitionCompoundNode=function(t,i,r){var s=Object.keys(t),n=this.getStateNode(s[0]),a=n._transition(t[s[0]],i,r);return!a||!a.transitions.length?this.next(i,r):a},e.prototype.transitionParallelNode=function(t,i,r){var s,n,a={};try{for(var o=ht(Object.keys(t)),h=o.next();!h.done;h=o.next()){var l=h.value,c=t[l];if(c){var u=this.getStateNode(l),d=u._transition(c,i,r);d&&(a[l]=d)}}}catch(y){s={error:y}}finally{try{h&&!h.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}var f=Object.keys(a).map(function(y){return a[y]}),p=dt(f.map(function(y){return y.transitions})),m=f.some(function(y){return y.transitions.length>0});if(!m)return this.next(i,r);var g=dt(Object.keys(a).map(function(y){return a[y].configuration}));return{transitions:p,exitSet:dt(f.map(function(y){return y.exitSet})),configuration:g,source:i,actions:dt(Object.keys(a).map(function(y){return a[y].actions}))}},e.prototype._transition=function(t,i,r){return et(t)?this.transitionLeafNode(t,i,r):Object.keys(t).length===1?this.transitionCompoundNode(t,i,r):this.transitionParallelNode(t,i,r)},e.prototype.getTransitionData=function(t,i){return this._transition(t.value,t,Gi(i))},e.prototype.next=function(t,i){var r,s,n=this,a=i.name,o=[],h=[],l;try{for(var c=ht(this.getCandidates(a)),u=c.next();!u.done;u=c.next()){var d=u.value,f=d.cond,p=d.in,m=t.context,g=p?et(p)&&We(p)?t.matches(Ii(this.getStateNodeById(p).path,this.delimiter)):Fn(Ii(p,this.delimiter),Vg(this.path.slice(0,-2))(t.value)):!0,y=!1;try{y=!f||Fh(this.machine,f,m,i,t)}catch(x){throw new Error("Unable to evaluate guard '".concat(f.name||f.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,`':
`).concat(x.message))}if(y&&g){d.target!==void 0&&(h=d.target),o.push.apply(o,at([],tt(d.actions),!1)),l=d;break}}}catch(x){r={error:x}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}if(l){if(!h.length)return{transitions:[l],exitSet:[],configuration:t.value?[this]:[],source:t,actions:o};var _=dt(h.map(function(x){return n.getRelativeStateNodes(x,t.historyValue)})),v=!!l.internal;return{transitions:[l],exitSet:v?[]:dt(h.map(function(x){return n.getPotentiallyReenteringNodes(x)})),configuration:_,source:t,actions:o}}},e.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var i=[],r=this,s=t;r&&r!==s;)i.push(r),r=r.parent;return r!==s?[]:(i.push(s),i)},e.prototype.getActions=function(t,i,r,s,n,a,o){var h,l,c,u,d=this,f=a?Ai([],this.getStateNodes(a.value)):[],p=new Set;try{for(var m=ht(Array.from(t).sort(function(b,R){return b.order-R.order})),g=m.next();!g.done;g=m.next()){var y=g.value;(!Ci(f,y)||Ci(r.exitSet,y)||y.parent&&p.has(y.parent))&&p.add(y)}}catch(b){h={error:b}}finally{try{g&&!g.done&&(l=m.return)&&l.call(m)}finally{if(h)throw h.error}}try{for(var _=ht(f),v=_.next();!v.done;v=_.next()){var y=v.value;(!Ci(t,y)||Ci(r.exitSet,y.parent))&&r.exitSet.push(y)}}catch(b){c={error:b}}finally{try{v&&!v.done&&(u=_.return)&&u.call(_)}finally{if(c)throw c.error}}r.exitSet.sort(function(b,R){return R.order-b.order});var x=Array.from(p).sort(function(b,R){return b.order-R.order}),T=new Set(r.exitSet),C=dt(x.map(function(b){var R=[];if(b.type!=="final")return R;var S=b.parent;if(!S.parent)return R;R.push(mr(b.id,b.doneData),mr(S.id,b.doneData?Rh(b.doneData,s,n):void 0));var E=S.parent;return E.type==="parallel"&&Xi(E).every(function(j){return Sr(r.configuration,j)})&&R.push(mr(E.id)),R})),A=x.map(function(b){var R=b.onEntry,S=b.activities.map(function(E){return sv(E)});return{type:"entry",actions:Be(o?at(at([],tt(R),!1),tt(S),!1):at(at([],tt(S),!1),tt(R),!1),d.machine.options.actions)}}).concat({type:"state_done",actions:C.map(Qg)}),w=Array.from(T).map(function(b){return{type:"exit",actions:Be(at(at([],tt(b.onExit),!1),tt(b.activities.map(function(R){return nv(R)})),!1),d.machine.options.actions)}}),M=w.concat({type:"transition",actions:Be(r.actions,this.machine.options.actions)}).concat(A);if(i){var F=Be(dt(at([],tt(t),!1).sort(function(b,R){return R.order-b.order}).map(function(b){return b.onExit})),this.machine.options.actions).filter(function(b){return b.type!==ki&&(b.type!==Gr||!!b.to&&b.to!==li.Internal)});return M.concat({type:"stop",actions:F})}return M},e.prototype.transition=function(t,i,r,s){t===void 0&&(t=this.initialState);var n=Gi(i),a;if(t instanceof ve)a=r===void 0?t:this.resolveState(ve.from(t,r));else{var o=et(t)?this.resolve(Hr(this.getResolvedPath(t))):this.resolve(t),h=r??this.machine.context;a=this.resolveState(ve.from(o,h))}if(this.strict&&!this.events.includes(n.name)&&!Wg(n.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(n.name,"'"));var l=this._transition(a.value,a,n)||{transitions:[],configuration:[],exitSet:[],source:a,actions:[]},c=Ai([],this.getStateNodes(a.value)),u=l.configuration.length?Ai(c,l.configuration):c;return l.configuration=at([],tt(u),!1),this.resolveTransition(l,a,a.context,s,n)},e.prototype.resolveRaisedTransition=function(t,i,r,s){var n,a=t.actions;return t=this.transition(t,i,void 0,s),t._event=r,t.event=r.data,(n=t.actions).unshift.apply(n,at([],tt(a),!1)),t},e.prototype.resolveTransition=function(t,i,r,s,n){var a,o,h,l,c=this;n===void 0&&(n=mn);var u=t.configuration,d=!i||t.transitions.length>0,f=d?t.configuration:i?i.configuration:[],p=Sr(f,this),m=d?pv(this.machine,u):void 0,g=i?i.historyValue?i.historyValue:t.source?this.machine.historyValue(i.value):void 0:void 0,y=this.getActions(new Set(f),p,t,r,n,i,s),_=i?U({},i.activities):{};try{for(var v=ht(y),x=v.next();!x.done;x=v.next()){var T=x.value;try{for(var C=(h=void 0,ht(T.actions)),A=C.next();!A.done;A=C.next()){var w=A.value;w.type===Va?_[w.activity.id||w.activity.type]=w:w.type===wh&&(_[w.activity.id||w.activity.type]=!1)}}catch(V){h={error:V}}finally{try{A&&!A.done&&(l=C.return)&&l.call(C)}finally{if(h)throw h.error}}}}catch(V){a={error:V}}finally{try{x&&!x.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}var M=tt(gn(this,i,r,n,y,s,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),F=M[0],b=M[1],R=tt(Yg(F,function(V){return V.type===ki||V.type===Gr&&V.to===li.Internal}),2),S=R[0],E=R[1],j=F.filter(function(V){var rt;return V.type===Va&&((rt=V.activity)===null||rt===void 0?void 0:rt.type)===dn}),$=j.reduce(function(V,rt){return V[rt.activity.id]=dv(rt.activity,c.machine,b,n),V},i?U({},i.children):{}),D=new ve({value:m||i.value,context:b,_event:n,_sessionid:i?i._sessionid:null,historyValue:m?g?qg(g,m):void 0:i?i.historyValue:void 0,history:!m||t.source?i:void 0,actions:m?E:[],activities:m?_:i?i.activities:{},events:[],configuration:f,transitions:t.transitions,children:$,done:p,tags:Ka(f),machine:this}),Z=r!==b;D.changed=n.name===kg||Z;var Q=D.history;Q&&delete Q.history;var I=!p&&(this._transient||u.some(function(V){return V._transient}));if(!d&&(!I||n.name===vr))return D;var L=D;if(!p)for(I&&(L=this.resolveRaisedTransition(L,{type:Og},n,s));S.length;){var W=S.shift();L=this.resolveRaisedTransition(L,W._event,n,s)}var J=L.changed||(Q?!!L.actions.length||Z||typeof Q.value!=typeof L.value||!Gh(L.value,Q.value):void 0);return L.changed=J,L.history=Q,L},e.prototype.getStateNode=function(t){if(We(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var i=this.states[t];if(!i)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return i},e.prototype.getStateNodeById=function(t){var i=We(t)?t.slice(yn.length):t;if(i===this.id)return this;var r=this.machine.idMap[i];if(!r)throw new Error("Child state node '#".concat(i,"' does not exist on machine '").concat(this.id,"'"));return r},e.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&We(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var i=pn(t,this.delimiter).slice(),r=this;i.length;){var s=i.shift();if(!s.length)break;r=r.getStateNode(s)}return r},e.prototype.resolve=function(t){var i,r=this;if(!t)return this.initialStateValue||$e;switch(this.type){case"parallel":return Si(this.initialStateValue,function(n,a){return n?r.getStateNode(a).resolve(t[a]||n):$e});case"compound":if(et(t)){var s=this.getStateNode(t);return s.type==="parallel"||s.type==="compound"?(i={},i[t]=s.initialStateValue,i):t}return Object.keys(t).length?Si(t,function(n,a){return n?r.getStateNode(a).resolve(n):$e}):this.initialStateValue||{};default:return t||$e}},e.prototype.getResolvedPath=function(t){if(We(t)){var i=this.machine.idMap[t.slice(yn.length)];if(!i)throw new Error("Unable to find state node '".concat(t,"'"));return i.path}return pn(t,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var i;if(this.type==="parallel")i=Wa(this.states,function(r){return r.initialStateValue||$e},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));i=jr(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else i={};return this.__cache.initialStateValue=i,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(t,i){this._init();var r=this.getStateNodes(t);return this.resolveTransition({configuration:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,i??this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;if(this.type==="history"){var i=this.config;et(i.target)?t=We(i.target)?Hr(this.machine.getStateNodeById(i.target).path.slice(this.path.length-1)):i.target:t=i.target}return t},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(t,i,r){return r===void 0&&(r=!0),r?t.type==="history"?t.resolveHistory(i):t.initialStateNodes:[t]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var t=this;if(jr(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var i=wr(this.initialStateValue);return dt(i.map(function(r){return t.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var i=tt(t),r=i[0],s=i.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var n=this.getStateNode(r);if(n.type==="history")return n.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(s)},e.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:Wa(this.states,function(i,r){if(!t)return i.historyValue();var s=et(t)?void 0:t[r];return i.historyValue(s||i.initialStateValue)},function(i){return!i.history})}},e.prototype.resolveHistory=function(t){var i=this;if(this.type!=="history")return[this];var r=this.parent;if(!t){var s=this.target;return s?dt(wr(s).map(function(a){return r.getFromRelativePath(a)})):r.initialStateNodes}var n=$g(r.path,"states")(t).current;return et(n)?[r.getStateNode(n)]:dt(wr(n).map(function(a){return i.history==="deep"?r.getFromRelativePath(a):[r.states[a[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var t=this,i=dt(Object.keys(this.states).map(function(r){return t.states[r].stateIds}));return[this.id].concat(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){var t,i,r,s;if(this.__cache.events)return this.__cache.events;var n=this.states,a=new Set(this.ownEvents);if(n)try{for(var o=ht(Object.keys(n)),h=o.next();!h.done;h=o.next()){var l=h.value,c=n[l];if(c.states)try{for(var u=(r=void 0,ht(c.events)),d=u.next();!d.done;d=u.next()){var f=d.value;a.add("".concat(f))}}catch(p){r={error:p}}finally{try{d&&!d.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}}}catch(p){t={error:p}}finally{try{h&&!h.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(i){return!(!i.target&&!i.actions.length&&i.internal)}).map(function(i){return i.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(t){var i=this;if(t!==void 0)return t.map(function(r){if(!et(r))return r;var s=r[0]===i.delimiter;if(s&&!i.parent)return i.getStateNodeByPath(r.slice(1));var n=s?i.key+r:r;if(i.parent)try{var a=i.parent.getStateNodeByPath(n);return a}catch(o){throw new Error("Invalid transition definition for state node '".concat(i.id,`':
`).concat(o.message))}else return i.getStateNodeByPath(n)})},e.prototype.formatTransition=function(t){var i=this,r=Zg(t.target),s="internal"in t?t.internal:r?r.some(function(h){return et(h)&&h[0]===i.delimiter}):!0,n=this.machine.options.guards,a=this.resolveTarget(r),o=U(U({},t),{actions:Be($t(t.actions)),cond:Mh(t.cond,n),target:a,source:this,internal:s,eventType:t.event,toJSON:function(){return U(U({},o),{target:o.target?o.target.map(function(h){return"#".concat(h.id)}):void 0,source:"#".concat(i.id)})}});return o},e.prototype.formatTransitions=function(){var t,i,r=this,s;if(!this.config.on)s=[];else if(Array.isArray(this.config.on))s=this.config.on;else{var n=this.config.on,a=Ds,o=n[a],h=o===void 0?[]:o,l=Bn(n,[typeof a=="symbol"?a:a+""]);s=dt(Object.keys(l).map(function(_){var v=Ve(_,l[_]);return v}).concat(Ve(Ds,h)))}var c=this.config.always?Ve("",this.config.always):[],u=this.config.onDone?Ve(String(mr(this.id)),this.config.onDone):[],d=dt(this.invoke.map(function(_){var v=[];return _.onDone&&v.push.apply(v,at([],tt(Ve(String(hv(_.id)),_.onDone)),!1)),_.onError&&v.push.apply(v,at([],tt(Ve(String(lv(_.id)),_.onError)),!1)),v})),f=this.after,p=dt(at(at(at(at([],tt(u),!1),tt(d),!1),tt(s),!1),tt(c),!1).map(function(_){return $t(_).map(function(v){return r.formatTransition(v)})}));try{for(var m=ht(f),g=m.next();!g.done;g=m.next()){var y=g.value;p.push(y)}}catch(_){t={error:_}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(t)throw t.error}}return p},e}(),Za=!1;function xv(e,t){return!jg&&!("predictableActionArguments"in e)&&!Za&&(Za=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new _v(e,t)}const ti=class{constructor(){ut(this,"_sounds");this._sounds={}}static get instance(){return ti._instance||(ti._instance=new ti),ti._instance}addSound(t,i){this._sounds[t]=new Audio(i)}playSound(t){this._sounds[t]&&this._sounds[t].play()}};let Ri=ti;ut(Ri,"_instance");class bv{constructor(){ut(this,"spriteStates");this.setupStateMachine()}setInitialState(t){t.state=this.spriteStates.initial}updateState(t,i){const r=this.spriteStates.transition(t.state,i.type);r.actions.forEach(s=>{s.exec(t)}),t.state=r}setupStateMachine(){this.spriteStates=xv({id:"sprite-state",initial:"Normal",states:{Normal:{entry:["enterNormal"],on:{HIGHLIGHT:"Highlighted"}},Highlighted:{entry:["enterHighlight"],on:{UNHIGHLIGHT:"Normal",FADE:"Fading"}},Fading:{on:{UNHIGHLIGHT:"Normal",HIGHLIGHT:"Highlighted"}}}},{actions:{enterHighlight:t=>{t.enterHighlight(),Ri.instance.playSound("tink"),setTimeout(()=>{this.updateState(t,{type:"FADE"})},0)},enterNormal:t=>{t.enterNormal()}}})}}class Ev extends Ut.System{constructor(){super();ut(this,"_stateMachine");ut(this,"_lastTime",0);ut(this,"components",[Th]);this._stateMachine=new bv}onEntityAdded(i){const s=new Ut.Entity(i).getComponent(Ui);s&&this._stateMachine.setInitialState(s)}onUpdate(){const i=Date.now();let r=0;this._lastTime!==0&&(r=(i-this._lastTime)/1e3),this.entities.forEach(s=>{const n=new Ut.Entity(s),a=n.getComponent(hi),o=n.getComponent(kr),h=n.getComponent(Ui);if(!a||!o||!h)return;const l=h.height/2,c=h.width/2;let u=!1;if(h.state.value==="Fading"&&r!==0&&h.updateHighlight(r),a.y-l<=0||a.y+l>=ne.height){const f=a.y+l-ne.height;f===0?o.y=-1:o.y=f/Math.abs(f)*-1,u=!0}if(a.x-c<=0||a.x+c>=ne.width){const f=a.x+c-ne.width;f===0?o.x=-1:o.x=f/Math.abs(f)*-1,u=!0}u?this._stateMachine.updateState(h,{type:"HIGHLIGHT"}):h.fadeComplete&&this._stateMachine.updateState(h,{type:"UNHIGHLIGHT"})}),this._lastTime=i}}class Tv{constructor(t){ut(this,"app");ut(this,"ball");Ri.instance.addSound("tink","assets/tink.wav"),this.app=new Cn({width:ne.width,height:ne.height,backgroundColor:0,resolution:window.devicePixelRatio||1});const i=document.getElementById(t);if(!i)throw new Error(`Container with id ${t} not found`);i.appendChild(this.app.view);const r=Ee.from("assets/templepattern.png");r.scale.set(1.5),r.anchor.set(.5),r.x=ne.width/2,r.y=ne.height/2,this.app.stage.addChild(r),this.makeBouncyBall(),this.setSystems(),this.app.ticker.add(()=>{Ut.SystemManager.update()})}makeBouncyBall(){const t=ne.width/2,i=ne.height/2,r=Ee.from("assets/mix.png");r.x=t,r.y=i,r.anchor.set(.5),r.scale.set(.5),this.app.stage.addChild(r);const s=Ee.from("assets/yellow.png");s.x=t,s.y=i,s.anchor.set(.5),s.scale.set(.5),this.app.stage.addChild(s),this.ball=Ut.EntityManager.createEntity(),this.ball.addComponent(Ui,r,s),this.ball.addComponent(hi,t,i),this.ball.addComponent(kr,5),this.ball.addComponent(Th)}setSystems(){Ut.SystemManager.add(Bg),Ut.SystemManager.add(Fg),Ut.SystemManager.add(Ev)}}new Tv("app");
